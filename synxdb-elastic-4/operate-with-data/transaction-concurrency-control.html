

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control Transactional Concurrency &mdash; SynxDB Elastic Documentation Preview documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=53dc447f" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f1f14d95"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=529101c1"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimize Performance" href="../optimize-performance/optimize-performance-index.html" />
    <link rel="prev" title="Work with Transactions" href="work-with-transactions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SynxDB Elastic Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../product-overview/product-index.html">Product Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy-guides/deploy-guides-index.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../load-data/load-data-index.html">Load Data</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="operate-with-data-index.html">Operate with Data</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="operate-with-db-objects/operate-with-db-objects-index.html">Operate with Database Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="choose-table-storage-models/choose-table-storage-models-index.html">Choose Table Storage Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-queries/sql-queries-index.html">Perform SQL Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced-data-analytics/advanced-data-analytics-index.html">Advanced Data Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="work-with-transactions.html">Work with Transactions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Control Transactional Concurrency</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mvcc-mechanism">MVCC mechanism</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lock-modes">Lock modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-deadlock-detector">Global Deadlock Detector</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../optimize-performance/optimize-performance-index.html">Optimize Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manage-system/manage-system-index.html">Manage System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security-and-permissions/set-security-and-permission-index.html">Configure Security and Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop-guides/develop-with-db-index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials-index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/references-index.html">Reference Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SynxDB Elastic Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="operate-with-data-index.html">Operate with Data</a></li>
      <li class="breadcrumb-item active">Control Transactional Concurrency</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="control-transactional-concurrency">
<h1>Control Transactional Concurrency<a class="headerlink" href="#control-transactional-concurrency" title="Link to this heading"></a></h1>
<p>This document introduces the transactional concurrency control in SynxDB Elastic, including:</p>
<ul class="simple">
<li><p><a class="reference external" href="#mvcc-mechanism">MVCC mechanism</a></p></li>
<li><p><a class="reference external" href="#lock-modes">Lock modes</a></p></li>
<li><p><a class="reference external" href="#global-deadlock-detector">Global Deadlock Detector</a></p></li>
</ul>
<section id="mvcc-mechanism">
<h2>MVCC mechanism<a class="headerlink" href="#mvcc-mechanism" title="Link to this heading"></a></h2>
<p>SynxDB Elastic and PostgreSQL do not use locks for concurrency control. Instead, they maintain data consistency through a multi-version model known as Multi-version Concurrency Control (MVCC). MVCC ensures transaction isolation for each database session, allowing each query transaction to see a consistent snapshot of data. This ensures that the data observed by a transaction remains consistent and unaffected by other concurrent transactions.</p>
<p>However, the specific data changes visible to a transaction are influenced by its isolation level. The default isolation level is “READ COMMITTED,” which means that a transaction can observe data changes made by other transactions that have already been committed. If the isolation level is set to “REPEATABLE READ,” then queries within that transaction will observe the data because it was at the beginning of the transaction and will not see changes made by other transactions in the interim. To specify the isolation level of a transaction, you can use the statement <code class="docutils literal notranslate"><span class="pre">BEGIN</span> <span class="pre">TRANSACTION</span> <span class="pre">ISOLATION</span> <span class="pre">LEVEL</span> <span class="pre">REPEATABLE</span> <span class="pre">READ</span></code> to start a transaction with the “REPEATABLE READ” isolation level.</p>
<p>Because MVCC does not use explicit locks for concurrency control, lock contention is minimized and SynxDB Elastic maintains reasonable performance in multi-user environments. Locks acquired for querying (reading) data do not conflict with locks acquired for writing data.</p>
</section>
<section id="lock-modes">
<h2>Lock modes<a class="headerlink" href="#lock-modes" title="Link to this heading"></a></h2>
<p>SynxDB Elastic provides multiple lock modes to control concurrent access to data in tables. Most SynxDB Elastic SQL commands automatically acquire the appropriate locks to ensure that referenced tables are not dropped or modified in incompatible ways while a command runs. For applications that cannot adapt easily to MVCC behavior, you can use the <code class="docutils literal notranslate"><span class="pre">LOCK</span></code> command to acquire explicit locks. However, proper use of MVCC generally provides better performance.</p>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>Lock mode</p></th>
<th class="head"><p>SQL commands</p></th>
<th class="head"><p>Conflicting lock modes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ACCESS SHARE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code></p></td>
<td><p>ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-odd"><td><p>ROW SHARE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SELECT...FOR</span> <span class="pre">lock_strength</span></code></p></td>
<td><p>EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-even"><td><p>ROW EXCLUSIVE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">COPY</span></code></p></td>
<td><p>SHARE, SHARE ROW EXCLUSIVE, EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-odd"><td><p>SHARE UPDATE EXCLUSIVE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ANALYZE</span></code></p></td>
<td><p>SHARE UPDATE EXCLUSIVE, SHARE, EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-even"><td><p>SHARE</p></td>
<td></td>
<td><p>ROW EXCLUSIVE, SHARE UPDATE EXCLUSIVE, SHARE ROW EXCLUSIVE, EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-odd"><td><p>SHARE ROW EXCLUSIVE</p></td>
<td><p>/</p></td>
<td><p>ROW EXCLUSIVE, SHARE UPDATE EXCLUSIVE, SHARE, SHARE ROW EXCLUSIVE, EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-even"><td><p>EXCLUSIVE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">SELECT...FOR</span> <span class="pre">lock_strength</span></code>, <code class="docutils literal notranslate"><span class="pre">REFRESH</span> <span class="pre">MATERIALIZED</span> <span class="pre">VIEW</span> <span class="pre">CONCURRENTLY</span></code></p></td>
<td><p>ROW SHARE, ROW EXCLUSIVE, SHARE UPDATE EXCLUSIVE, SHARE, SHARE ROW EXCLUSIVE, EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
<tr class="row-odd"><td><p>ACCESS EXCLUSIVE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code>, <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code>, <code class="docutils literal notranslate"><span class="pre">TRUNCATE</span></code>, <code class="docutils literal notranslate"><span class="pre">CLUSTER</span></code>, <code class="docutils literal notranslate"><span class="pre">REFRESH</span> <span class="pre">MATERIALIZED</span> <span class="pre">VIEW</span></code>（without <code class="docutils literal notranslate"><span class="pre">CONCURRENTLY</span></code>）, <code class="docutils literal notranslate"><span class="pre">VACUUM</span> <span class="pre">FULL</span></code></p></td>
<td><p>ACCESS SHARE, ROW SHARE, ROW EXCLUSIVE, SHARE, SHARE UPDATE EXCLUSIVE, SHARE ROW EXCLUSIVE, EXCLUSIVE, ACCESS EXCLUSIVE</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the Global Deadlock Detector is deactivated, and SynxDB Elastic acquires the more restrictive <code class="docutils literal notranslate"><span class="pre">EXCLUSIVE</span></code> lock (rather than <code class="docutils literal notranslate"><span class="pre">ROW</span> <span class="pre">EXCLUSIVE</span></code> in PostgreSQL) for <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>.</p>
<p>When the Global Deadlock Detector is enabled, the lock mode for some <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> and <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> operations on heap tables is <code class="docutils literal notranslate"><span class="pre">ROW</span> <span class="pre">EXCLUSIVE</span></code>. See <a class="reference external" href="#global-deadlock-detector">Global Deadlock Detector</a>.</p>
</div>
</section>
<section id="global-deadlock-detector">
<h2>Global Deadlock Detector<a class="headerlink" href="#global-deadlock-detector" title="Link to this heading"></a></h2>
<p>The SynxDB Elastic Global Deadlock Detector background worker process collects lock information on all segments and uses a directed algorithm to detect the existence of local and global deadlocks. This algorithm allows SynxDB Elastic to relax concurrent update and delete restrictions on heap tables. (SynxDB Elastic still employs table-level locking on AO/CO tables, restricting concurrent <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, and <code class="docutils literal notranslate"><span class="pre">SELECT...FOR</span> <span class="pre">lock_strength</span></code> operations.)</p>
<p>By default, the Global Deadlock Detector is deactivated and SynxDB Elastic runs the concurrent <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> operations on a heap table serially. You can activate these concurrent updates and have the Global Deadlock Detector determine when a deadlock exists by setting the parameter <code class="docutils literal notranslate"><span class="pre">gp_enable_global_deadlock_detector</span></code> in the <code class="docutils literal notranslate"><span class="pre">postgresql.conf</span></code> configuration file to <code class="docutils literal notranslate"><span class="pre">on</span></code> and then restarting the database.</p>
<p>When the Global Deadlock Detector is enabled, the background worker process is automatically started on the coordinator host when you start SynxDB Elastic. You configure the interval at which the Global Deadlock Detector collects and analyzes lock waiting data via the <code class="docutils literal notranslate"><span class="pre">gp_global_deadlock_detector_period</span></code> server configuration parameter in the <code class="docutils literal notranslate"><span class="pre">postgresql.conf</span></code> configuration file.</p>
<p>If the Global Deadlock Detector determines that deadlock exists, it
breaks the deadlock by cancelling one or more backend processes
associated with the youngest transaction(s) involved.</p>
<p>When the Global Deadlock Detector determines a deadlock exists for the following types of transactions, only one of the transactions will succeed. The other transactions will fail with an error indicating that concurrent updates to the same row is not allowed.</p>
<ul class="simple">
<li><p>Concurrent transactions on the same row of a heap table where the first transaction is an update operation and a later transaction runs an update or delete and the query plan contains a motion operator.</p></li>
<li><p>Concurrent update transactions on the same row of a hash table that are run by the GPORCA optimizer.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>SynxDB Elastic uses the interval specified in the <code class="docutils literal notranslate"><span class="pre">deadlock_timeout</span></code> server configuration parameter for local deadlock detection. Because the local and global deadlock detection algorithms differ, the cancelled process(es) may differ depending upon which detector (local or global) SynxDB Elastic triggers first.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">lock_timeout</span></code> server configuration parameter is turned on and set to a value smaller than <code class="docutils literal notranslate"><span class="pre">deadlock_timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">gp_global_deadlock_detector_period</span></code>, SynxDB Elastic will cancel a statement before it would ever trigger a deadlock check in that session.</p>
</div>
<p>To view lock waiting information for all segments, run the <code class="docutils literal notranslate"><span class="pre">gp_dist_wait_status()</span></code> user-defined function. You can use the output of this function to determine which transactions are waiting on locks, which transactions are holding locks, the lock types and mode, the waiter and holder session identifiers, and which segments are running the transactions. Sample output of the <code class="docutils literal notranslate"><span class="pre">gp_dist_wait_status()</span></code> function follows:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">gp_dist_wait_status</span><span class="p">();</span>

<span class="o">-</span><span class="p">[</span><span class="w"> </span><span class="n">RECORD</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="c1">----+--------------</span>
<span class="n">segid</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span>
<span class="n">waiter_dxid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">11</span>
<span class="n">holder_dxid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span>
<span class="n">holdTillEndXact</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">t</span>
<span class="n">waiter_lpid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">31249</span>
<span class="n">holder_lpid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">31458</span>
<span class="n">waiter_lockmode</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ShareLock</span>
<span class="n">waiter_locktype</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">transactionid</span>
<span class="n">waiter_sessionid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span>
<span class="n">holder_sessionid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9</span>
<span class="o">-</span><span class="p">[</span><span class="w"> </span><span class="n">RECORD</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">]</span><span class="c1">----+--------------</span>
<span class="n">segid</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span>
<span class="n">waiter_dxid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span>
<span class="n">holder_dxid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">11</span>
<span class="n">holdTillEndXact</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">t</span>
<span class="n">waiter_lpid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">31467</span>
<span class="n">holder_lpid</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">31250</span>
<span class="n">waiter_lockmode</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">ShareLock</span>
<span class="n">waiter_locktype</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">transactionid</span>
<span class="n">waiter_sessionid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">9</span>
<span class="n">holder_sessionid</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span>
</pre></div>
</div>
<p>When it cancels a transaction to break a deadlock, the Global Deadlock Detector reports the following error message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ERROR</span><span class="p">:</span>  <span class="n">canceling</span> <span class="n">statement</span> <span class="n">due</span> <span class="n">to</span> <span class="n">user</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;cancelled by global deadlock detector&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          


  <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      <a href="../optimize-performance/optimize-performance-index.html" class="btn btn-neutral float-right" title="Optimize Performance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      <a href="work-with-transactions.html" class="btn btn-neutral float-left" title="Work with Transactions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
  </div>

<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <p>&copy; 2025, Synx Data Labs, Inc. All rights reserved.</p>
      </div>
      <div class="footer-section">
        <p>SynxDB Elastic Documentation</p>
      </div>
    </div>
  </div>
</footer>

<style>
.footer {
  background-color: var(--bg-secondary);
  border-top: 1px solid var(--border);
  padding: 1.5rem 0;
  margin-top: 3rem;
}

.footer-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 2rem;
}

.footer-section p {
  margin: 0;
  color: var(--text-secondary);
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
}

@media (max-width: 768px) {
  .footer-content {
    flex-direction: column;
    gap: 0.5rem;
    text-align: center;
  }
}
</style>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>