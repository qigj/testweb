<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Loading Data - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="loading-data"><a class="header" href="#loading-data">Loading Data</a></h1>
<p>Description of the different ways to add data to SynxDB.</p>
<h2 id="insert-statement-with-column-values"><a class="header" href="#insert-statement-with-column-values"><a id="topic_tmf_t2t_bp"></a>INSERT Statement with Column Values</a></h2>
<p>A singleton <code>INSERT</code> statement with values adds a single row to a table. The row flows through the master and is distributed to a segment. This is the slowest method and is not suitable for loading large amounts of data.</p>
<h2 id="copy-statement"><a class="header" href="#copy-statement"><a id="topic_oqb_y2t_bp"></a>COPY Statement</a></h2>
<p>The PostgreSQL <code>COPY</code> statement copies data from an external file into a database table. It can insert multiple rows more efficiently than an <code>INSERT</code> statement, but the rows are still passed through the master. All of the data is copied in one command; it is not a parallel process.</p>
<p>Data input to the <code>COPY</code> command is from a file or the standard input. For example:</p>
<pre><code>COPY table FROM '/data/mydata.csv' WITH CSV HEADER;
</code></pre>
<p>Use <code>COPY</code> to add relatively small sets of data, for example dimension tables with up to ten thousand rows, or one-time data loads.</p>
<p>Use <code>COPY</code> when scripting a process that loads small amounts of data, less than 10 thousand rows.</p>
<p>Since COPY is a single command, there is no need to deactivate autocommit when you use this method to populate a table.</p>
<p>You can run multiple concurrent <code>COPY</code> commands to improve performance.</p>
<h2 id="external-tables"><a class="header" href="#external-tables"><a id="topic_kgp_z2t_bp"></a>External Tables</a></h2>
<p>External tables provide access to data in sources outside of SynxDB. They can be accessed with <code>SELECT</code> statements and are commonly used with the Extract, Load, Transform (ELT) pattern, a variant of the Extract, Transform, Load (ETL) pattern that takes advantage of SynxDB’s fast parallel data loading capability.</p>
<p>With ETL, data is extracted from its source, transformed outside of the database using external transformation tools, such as Informatica or Datastage, and then loaded into the database.</p>
<p>With ELT, SynxDB external tables provide access to data in external sources, which could be read-only files (for example, text, CSV, or XML files), Web servers, Hadoop file systems, executable OS programs, or the SynxDB <code>gpfdist</code> file server, described in the next section. External tables support SQL operations such as select, sort, and join so the data can be loaded and transformed simultaneously, or loaded into a <em>load table</em> and transformed in the database into target tables.</p>
<p>The external table is defined with a <code>CREATE EXTERNAL TABLE</code> statement, which has a <code>LOCATION</code> clause to define the location of the data and a <code>FORMAT</code> clause to define the formatting of the source data so that the system can parse the input data. Files use the <code>file://</code> protocol, and must reside on a segment host in a location accessible by the SynxDB superuser. The data can be spread out among the segment hosts with no more than one file per primary segment on each host. The number of files listed in the <code>LOCATION</code> clause is the number of segments that will read the external table in parallel.</p>
<h2 id="external-tables-with-gpfdist"><a class="header" href="#external-tables-with-gpfdist"><a id="topic_x2l_bft_bp"></a>External Tables with Gpfdist</a></h2>
<p>The fastest way to load large fact tables is to use external tables with <code>gpfdist</code>. <code>gpfdist</code> is a file server program using an HTTP protocol that serves external data files to SynxDB segments in parallel. A <code>gpfdist</code> instance can serve 200 MB/second and many <code>gpfdist</code> processes can run simultaneously, each serving up a portion of the data to be loaded. When you begin the load using a statement such as <code>INSERT INTO &lt;table&gt; SELECT * FROM &lt;external_table&gt;</code>, the <code>INSERT</code> statement is parsed by the master and distributed to the primary segments. The segments connect to the <code>gpfdist</code> servers and retrieve the data in parallel, parse and validate the data, calculate a hash from the distribution key data and, based on the hash key, send the row to its destination segment. By default, each <code>gpfdist</code> instance will accept up to 64 connections from segments. With many segments and <code>gpfdist</code> servers participating in the load, data can be loaded at very high rates.</p>
<p>Primary segments access external files in parallel when using <code>gpfdist</code> up to the value of <code>gp_external_max_segs</code>. When optimizing <code>gpfdist</code> performance, maximize the parallelism as the number of segments increase. Spread the data evenly across as many ETL nodes as possible. Split very large data files into equal parts and spread the data across as many file systems as possible.</p>
<p>Run two <code>gpfdist</code> instances per file system. <code>gpfdist</code> tends to be CPU bound on the segment nodes when loading. But if, for example, there are eight racks of segment nodes, there is lot of available CPU on the segments to drive more <code>gpfdist</code> processes. Run <code>gpfdist</code> on as many interfaces as possible. Be aware of bonded NICs and be sure to start enough <code>gpfdist</code> instances to work them.</p>
<p>It is important to keep the work even across all these resources. The load is as fast as the slowest node. Skew in the load file layout will cause the overall load to bottleneck on that resource.</p>
<p>The <code>gp_external_max_segs</code> configuration parameter controls the number of segments each <code>gpfdist</code> process serves. The default is 64. You can set a different value in the <code>postgresql.conf</code> configuration file on the master. Always keep <code>gp_external_max_segs</code> and the number of <code>gpfdist</code> processes an even factor; that is, the <code>gp_external_max_segs</code> value should be a multiple of the number of <code>gpfdist</code> processes. For example, if there are 12 segments and 4 <code>gpfdist</code> processes, the planner round robins the segment connections as follows:</p>
<pre><code class="language-screen">Segment 1  - gpfdist 1 
Segment 2  - gpfdist 2 
Segment 3  - gpfdist 3 
Segment 4  - gpfdist 4 
Segment 5  - gpfdist 1 
Segment 6  - gpfdist 2 
Segment 7  - gpfdist 3 
Segment 8  - gpfdist 4 
Segment 9  - gpfdist 1 
Segment 10 - gpfdist 2 
Segment 11 - gpfdist 3 
Segment 12 - gpfdist 4
</code></pre>
<p>Drop indexes before loading into existing tables and re-create the index after loading. Creating an index on pre-existing data is faster than updating it incrementally as each row is loaded.</p>
<p>Run <code>ANALYZE</code> on the table after loading. Deactivate automatic statistics collection during loading by setting <code>gp_autostats_mode</code> to <code>NONE</code>. Run <code>VACUUM</code> after load errors to recover space.</p>
<p>Performing small, high frequency data loads into heavily partitioned column-oriented tables can have a high impact on the system because of the number of physical files accessed per time interval.</p>
<h2 id="gpload"><a class="header" href="#gpload"><a id="topic_xyt_cft_bp"></a>Gpload</a></h2>
<p><code>gpload</code> is a data loading utility that acts as an interface to the SynxDB external table parallel loading feature.</p>
<p>Beware of using <code>gpload</code> as it can cause catalog bloat by creating and dropping external tables. Use <code>gpfdist</code> instead, since it provides the best performance.</p>
<p><code>gpload</code> runs a load using a specification defined in a YAML-formatted control file. It performs the following operations:</p>
<ul>
<li>Invokes <code>gpfdist</code> processes</li>
<li>Creates a temporary external table definition based on the source data defined</li>
<li>Runs an <code>INSERT</code>, <code>UPDATE</code>, or <code>MERGE</code> operation to load the source data into the target table in the database</li>
<li>Drops the temporary external table</li>
<li>Cleans up <code>gpfdist</code> processes</li>
</ul>
<p>The load is accomplished in a single transaction.</p>
<h2 id="best-practices"><a class="header" href="#best-practices"><a id="topic_ryr_2ft_bp"></a>Best Practices</a></h2>
<ul>
<li>
<p>Drop any indexes on an existing table before loading data and recreate the indexes after loading. Newly creating an index is faster than updating an index incrementally as each row is loaded.</p>
</li>
<li>
<p>Deactivate automatic statistics collection during loading by setting the <code>gp_autostats_mode</code> configuration parameter to <code>NONE</code>.</p>
</li>
<li>
<p>External tables are not intended for frequent or ad hoc access.</p>
</li>
<li>
<p>When using <code>gpfdist</code>, maximize network bandwidth by running one <code>gpfdist</code> instance for each NIC on the ETL server. Divide the source data evenly between the <code>gpfdist</code> instances.</p>
</li>
<li>
<p>When using <code>gpload</code>, run as many simultaneous <code>gpload</code> instances as resources allow. Take advantage of the CPU, memory, and networking resources available to increase the amount of data that can be transferred from ETL servers to the SynxDB.</p>
</li>
<li>
<p>Use the <code>SEGMENT REJECT LIMIT</code> clause of the <code>COPY</code> statement to set a limit for the number or percentage of rows that can have errors before the <code>COPY FROM</code> command is cancelled. The reject limit is per segment; when any one segment exceeds the limit, the command is cancelled and no rows are added. Use the <code>LOG ERRORS</code> clause to save error rows. If a row has errors in the formatting—for example missing or extra values, or incorrect data types—SynxDB stores the error information and row internally. Use the <code>gp_read_error_log()</code> built-in SQL function to access this stored information.</p>
</li>
<li>
<p>If the load has errors, run <code>VACUUM</code> on the table to recover space.</p>
</li>
<li>
<p>After you load data into a table, run <code>VACUUM</code> on heap tables, including system catalogs, and <code>ANALYZE</code> on all tables. It is not necessary to run <code>VACUUM</code> on append-optimized tables. If the table is partitioned, you can vacuum and analyze just the partitions affected by the data load. These steps clean up any rows from prematurely ended loads, deletes, or updates and update statistics for the table.</p>
</li>
<li>
<p>Recheck for segment skew in the table after loading a large amount of data. You can use a query like the following to check for skew:</p>
<pre><code class="language-language-sql">SELECT gp_segment_id, count(*) 
FROM schema.table 
GROUP BY gp_segment_id ORDER BY 2;
</code></pre>
</li>
<li>
<p>By default, <code>gpfdist</code> assumes a maximum record size of 32K. To load data records larger than 32K, you must increase the maximum row size parameter by specifying the <code>-m &lt;*bytes*&gt;</code> option on the <code>gpfdist</code> command line. If you use <code>gpload</code>, set the <code>MAX_LINE_LENGTH</code> parameter in the <code>gpload</code> control file.</p>
<blockquote>
<p><strong>Note</strong> Integrations with Informatica Power Exchange are currently limited to the default 32K record length.</p>
</blockquote>
</li>
</ul>
<h3 id="additional-information"><a class="header" href="#additional-information"><a id="addinfo"></a>Additional Information</a></h3>
<p>See the <em>SynxDB Reference Guide</em> for detailed instructions for loading data using <code>gpfdist</code> and <code>gpload</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../best_practices/logfiles.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../best_practices/heap_tables.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../best_practices/logfiles.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../best_practices/heap_tables.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
