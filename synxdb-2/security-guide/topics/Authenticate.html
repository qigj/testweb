<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuring Client Authentication - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="configuring-client-authentication"><a class="header" href="#configuring-client-authentication">Configuring Client Authentication</a></h1>
<p>Describes the available methods for authenticating SynxDB clients.</p>
<p>When a SynxDB system is first initialized, the system contains one predefined superuser role. This role will have the same name as the operating system user who initialized the SynxDB system. This role is referred to as gpadmin. By default, the system is configured to only allow local connections to the database from the gpadmin role. If you want to allow any other roles to connect, or if you want to allow connections from remote hosts, you have to configure SynxDB to allow such connections. This section explains how to configure client connections and authentication to SynxDB.</p>
<ul>
<li><a href="#topic_ln1_ptd_jr">Allowing Connections to SynxDB</a></li>
<li><a href="#topic_xwr_rvd_jr">Editing the pg_hba.conf File</a></li>
<li><a href="#topic_nyh_gwd_jr">Authentication Methods</a></li>
<li><a href="#topic_hwn_bk2_jr">Limiting Concurrent Connections</a></li>
<li><a href="#topic_ibc_nl2_jr">Encrypting Client/Server Connections</a></li>
</ul>
<h2 id="allowing-connections-to-synxdb"><a class="header" href="#allowing-connections-to-synxdb"><a id="topic_ln1_ptd_jr"></a>Allowing Connections to SynxDB</a></h2>
<p>Client access and authentication is controlled by a configuration file named <code>pg_hba.conf</code> (the standard PostgreSQL host-based authentication file). For detailed information about this file, see <a href="https://www.postgresql.org/docs/9.4/auth-pg-hba-conf.html">The pg_hba.conf File</a> in the PostgreSQL documentation.</p>
<p>In SynxDB, the <code>pg_hba.conf</code> file of the master instance controls client access and authentication to your SynxDB system. The segments also have <code>pg_hba.conf</code> files, but these are already correctly configured to only allow client connections from the master host. The segments never accept outside client connections, so there is no need to alter the <code>pg_hba.conf</code> file on segments.</p>
<p>The general format of the <code>pg_hba.conf</code> file is a set of records, one per line. Blank lines are ignored, as is any text after a # comment character. A record is made up of a number of fields which are separated by spaces and/or tabs. Fields can contain white space if the field value is quoted. Records cannot be continued across lines.</p>
<p>A record can have one of seven formats:</p>
<pre><code>local      &lt;database&gt;  &lt;user&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
host       &lt;database&gt;  &lt;user&gt;  &lt;address&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
hostssl    &lt;database&gt;  &lt;user&gt;  &lt;address&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
hostnossl  &lt;database&gt;  &lt;user&gt;  &lt;address&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
host       &lt;database&gt;  &lt;user&gt;  &lt;IP-address&gt;  &lt;IP-mask&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
hostssl    &lt;database&gt;  &lt;user&gt;  &lt;IP-address&gt;  &lt;IP-mask&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
hostnossl  &lt;database&gt;  &lt;user&gt;  &lt;IP-address&gt;  &lt;IP-mask&gt;  &lt;auth-method&gt;  [&lt;auth-options&gt;]
</code></pre>
<p>The meaning of the <code>pg_hba.conf</code> fields is as follows:</p>
<p><code>local</code>
:   Matches connection attempts using UNIX-domain sockets. Without a record of this type, UNIX-domain socket connections are disallowed.</p>
<p><code>host</code>
:   Matches connection attempts made using TCP/IP. Remote TCP/IP connections will not be possible unless the server is started with an appropriate value for the <code>listen_addresses</code> server configuration parameter. SynxDB by default allows connections from all hosts (<code>'*'</code>).</p>
<p><code>hostssl</code>
:   Matches connection attempts made using TCP/IP, but only when the connection is made with SSL encryption. SSL must be enabled at server start time by setting the <code>ssl</code> configuration parameter to on. Requires SSL authentication be configured in <code>postgresql.conf</code>. See <a href="#ssl_postgresql">Configuring postgresql.conf for SSL Authentication</a>.</p>
<p><code>hostnossl</code>
:   Matches connection attempts made over TCP/IP that do not use SSL.</p>
<p><code>database</code>
:   Specifies which database names this record matches. The value <code>all</code> specifies that it matches all databases. Multiple database names can be supplied by separating them with commas. A separate file containing database names can be specified by preceding the file name with <code>@</code>.</p>
<p><code>user</code>
:   Specifies which database role names this record matches. The value <code>all</code> specifies that it matches all roles. If the specified role is a group and you want all members of that group to be included, precede the role name with a <code>+</code>. Multiple role names can be supplied by separating them with commas. A separate file containing role names can be specified by preceding the file name with <code>@</code>.</p>
<p><code>address</code>
:   Specifies the client machine addresses that this record matches. This field can contain either a host name, an IP address range, or one of the special key words mentioned below.</p>
<p>:   An IP address range is specified using standard numeric notation for the range’s starting address, then a slash (<code>/</code>) and a CIDR mask length. The mask length indicates the number of high-order bits of the client IP address that must match. Bits to the right of this should be zero in the given IP address. There must not be any white space between the IP address, the <code>/</code>, and the CIDR mask length.</p>
<p>:   Typical examples of an IPv4 address range specified this way are <code>172.20.143.89/32</code> for a single host, or <code>172.20.143.0/24</code> for a small network, or <code>10.6.0.0/16</code> for a larger one. An IPv6 address range might look like <code>::1/128</code> for a single host (in this case the IPv6 loopback address) or <code>fe80::7a31:c1ff:0000:0000/96</code> for a small network. <code>0.0.0.0/0</code> represents all IPv4 addresses, and <code>::0/0</code> represents all IPv6 addresses. To specify a single host, use a mask length of 32 for IPv4 or 128 for IPv6. In a network address, do not omit trailing zeroes.</p>
<p>:   An entry given in IPv4 format will match only IPv4 connections, and an entry given in IPv6 format will match only IPv6 connections, even if the represented address is in the IPv4-in-IPv6 range.</p>
<p>:   &gt; <strong>Note</strong> Entries in IPv6 format will be rejected if the host system C library does not have support for IPv6 addresses.</p>
<p>:   You can also write <code>all</code> to match any IP address, <code>samehost</code> to match any of the server’s own IP addresses, or <code>samenet</code> to match any address in any subnet to which the server is directly connected.</p>
<p>:   If a host name is specified (an address that is not an IP address, IP range, or special key word is treated as a host name), that name is compared with the result of a reverse name resolution of the client IP address (for example, reverse DNS lookup, if DNS is used). Host name comparisons are case insensitive. If there is a match, then a forward name resolution (for example, forward DNS lookup) is performed on the host name to check whether any of the addresses it resolves to are equal to the client IP address. If both directions match, then the entry is considered to match.</p>
<p>:   The host name that is used in <code>pg_hba.conf</code> should be the one that address-to-name resolution of the client’s IP address returns, otherwise the line won’t be matched. Some host name databases allow associating an IP address with multiple host names, but the operating system will only return one host name when asked to resolve an IP address.</p>
<p>:   A host name specification that starts with a dot (.) matches a suffix of the actual host name. So <code>.example.com</code> would match <code>foo.example.com</code> (but not just <code>example.com</code>).</p>
<p>:   When host names are specified in <code>pg_hba.conf</code>, you should ensure that name resolution is reasonably fast. It can be advantageous to set up a local name resolution cache such as <code>nscd</code>. Also, you can enable the server configuration parameter <code>log_hostname</code> to see the client host name instead of the IP address in the log.</p>
<p><code>IP-address</code>
<code>IP-mask</code>
:   These two fields can be used as an alternative to the CIDR address notation. Instead of specifying the mask length, the actual mask is specified in a separate column. For example, <code>255.0.0.0</code> represents an IPv4 CIDR mask length of 8, and <code>255.255.255.255</code> represents a CIDR mask length of 32.</p>
<p><code>auth-method</code>
:   Specifies the authentication method to use when a connection matches this record. See <a href="#topic_nyh_gwd_jr">Authentication Methods</a> for options.</p>
<p><code>auth-options</code>
:   After the <code>auth-method</code> field, there can be field(s) of the form <code>name=value</code> that specify options for the authentication method. Details about which options are available for which authentication methods are described in <a href="#topic_nyh_gwd_jr">Authentication Methods</a>.</p>
<p>Files included by @ constructs are read as lists of names, which can be separated by either whitespace or commas. Comments are introduced by #, just as in <code>pg_hba.conf</code>, and nested @ constructs are allowed. Unless the file name following @ is an absolute path, it is taken to be relative to the directory containing the referencing file.</p>
<p>The <code>pg_hba.conf</code> records are examined sequentially for each connection attempt, so the order of the records is significant. Typically, earlier records will have tight connection match parameters and weaker authentication methods, while later records will have looser match parameters and stronger authentication methods. For example, you might wish to use <code>trust</code> authentication for local TCP/IP connections but require a password for remote TCP/IP connections. In this case a record specifying <code>trust</code> authentication for connections from 127.0.0.1 would appear before a record specifying <code>password</code> authentication for a wider range of allowed client IP addresses.</p>
<p>The <code>pg_hba.conf</code> file is read on start-up and when the main server process receives a SIGHUP signal. If you edit the file on an active system, you must reload the file using this command:</p>
<pre><code>$ gpstop -u
</code></pre>
<blockquote>
<p><strong>Caution</strong>  For a more secure system, remove records for remote connections that use <code>trust</code> authentication from the <code>pg_hba.conf</code> file. <code>trust</code> authentication grants any user who can connect to the server access to the database using any role they specify. You can safely replace <code>trust</code> authentication with <code>ident</code> authentication for local UNIX-socket connections. You can also use <code>ident</code> authentication for local and remote TCP clients, but the client host must be running an ident service and you must <code>trust</code> the integrity of that machine.</p>
</blockquote>
<h2 id="editing-the-pg_hbaconf-file"><a class="header" href="#editing-the-pg_hbaconf-file"><a id="topic_xwr_rvd_jr"></a>Editing the pg_hba.conf File</a></h2>
<p>Initially, the <code>pg_hba.conf</code> file is set up with generous permissions for the gpadmin user and no database access for other SynxDB roles. You will need to edit the <code>pg_hba.conf</code> file to enable users’ access to databases and to secure the gpadmin user. Consider removing entries that have <code>trust</code> authentication, since they allow anyone with access to the server to connect with any role they choose. For local (UNIX socket) connections, use <code>ident</code> authentication, which requires the operating system user to match the role specified. For local and remote TCP connections, <code>ident</code> authentication requires the client’s host to run an indent service. You could install an ident service on the master host and then use <code>ident</code> authentication for local TCP connections, for example <code>127.0.0.1/28</code>. Using <code>ident</code> authentication for remote TCP connections is less secure because it requires you to trust the integrity of the ident service on the client’s host.</p>
<p>This example shows how to edit the <code>pg_hba.conf</code> file on the master host to allow remote client access to all databases from all roles using encrypted password authentication.</p>
<p>To edit <code>pg_hba.conf</code>:</p>
<ol>
<li>
<p>Open the file <code>$MASTER_DATA_DIRECTORY/pg_hba.conf</code> in a text editor.</p>
</li>
<li>
<p>Add a line to the file for each type of connection you want to allow. Records are read sequentially, so the order of the records is significant. Typically, earlier records will have tight connection match parameters and weaker authentication methods, while later records will have looser match parameters and stronger authentication methods. For example:</p>
<pre><code># allow the gpadmin user local access to all databases
# using ident authentication
local   all   gpadmin   ident         sameuser
host    all   gpadmin   127.0.0.1/32  ident
host    all   gpadmin   ::1/128       ident
# allow the 'dba' role access to any database from any
# host with IP address 192.168.x.x and use md5 encrypted
# passwords to authenticate the user
# Note that to use SHA-256 encryption, replace md5 with
# password in the line below
host    all   dba   192.168.0.0/32  md5
</code></pre>
</li>
</ol>
<h2 id="authentication-methods"><a class="header" href="#authentication-methods"><a id="topic_nyh_gwd_jr"></a>Authentication Methods</a></h2>
<ul>
<li><a href="#basic_auth">Basic Authentication</a></li>
<li><a href="#kerberos_auth">GSSAPI Authentication</a></li>
<li><a href="#ldap_auth">LDAP Authentication</a></li>
<li><a href="#topic_fzv_wb2_jr">SSL Client Authentication</a></li>
<li><a href="#topic_yxp_5h2_jr">PAM-Based Authentication</a></li>
<li><a href="#topic_ed4_d32_jr">Radius Authentication</a></li>
</ul>
<h3 id="basic-authentication"><a class="header" href="#basic-authentication"><a id="basic_auth"></a>Basic Authentication</a></h3>
<p>Trust
:   Allows the connection unconditionally, without the need for a password or any other authentication. This entry is required for the <code>gpadmin</code> role, and for SynxDB utilities (for example <code>gpinitsystem</code>, <code>gpstop</code>, or <code>gpstart</code> amongst others) that need to connect between nodes without prompting for input or a password.</p>
<p>:   &gt; <strong>Important</strong> For a more secure system, remove records for remote connections that use <code>trust</code> authentication from the <code>pg_hba.conf</code> file. <code>trust</code> authentication grants any user who can connect to the server access to the database using any role they specify. You can safely replace <code>trust</code> authentication with <code>ident</code> authentication for local UNIX-socket connections. You can also use <code>ident</code> authentication for local and remote TCP clients, but the client host must be running an ident service and you must <code>trust</code> the integrity of that machine.</p>
<p>Reject
:   Reject the connections with the matching parameters. You should typically use this to restrict access from specific hosts or insecure connections.</p>
<p>Ident
:   Authenticates based on the client’s operating system user name. This is secure for local socket connections. Using <code>ident</code> for TCP connections from remote hosts requires that the client’s host is running an ident service. The <code>ident</code> authentication method should only be used with remote hosts on a trusted, closed network.</p>
<p>scram-sha-256
:   Perform SCRAM-SHA-256 authentication as described in <a href="https://tools.ietf.org/html/rfc5802">RFC5802</a> to verify the user’s password. SCRAM-SHA-256 authentication is a challenge-response scheme that prevents password sniffing on untrusted connections. It is more secure than the <code>md5</code> method, but might not be supported by older clients.</p>
<p>md5
:   Perform SCRAM-SHA-256 or MD5 authentication to verify the user’s password. Allows falling back to a less secure challenge-response mechanism for those users with an MD5-hashed password. The fallback mechanism also prevents password sniffing, but provides no protection if an attacker manages to steal the password hash from the server, and it cannot be used when <code>db_user_namespace</code> is enabled. For all other users, <code>md5</code> works the same as <code>scram-sha-256</code>.</p>
<p>password
:   Require the client to supply an unencrypted password for authentication. Since the password is sent in clear text over the network, this authentication method should not be used on untrusted networks.</p>
<p>:   Plain <code>password</code> authentication sends the password in clear-text, and is therefore vulnerable to password sniffing attacks. It should always be avoided if possible. If the connection is protected by SSL encryption then <code>password</code> can be used safely, though. (SSL certificate authentication might be a better choice if one is depending on using SSL).</p>
<p>:   When using the SynxDB <code>SHA-256</code> password hashing algorithm, the <code>password</code> authentication method must be specifed, and SSL-secured client connections are recommended.</p>
<h4 id="basic-authentication-examples"><a class="header" href="#basic-authentication-examples"><a id="basic_auth_example"></a>Basic Authentication Examples</a></h4>
<p>The password-based authentication methods are <code>scram-sha-256</code>, <code>md5</code>, and <code>password</code>. These methods operate similarly except for the way that the password is sent across the connection.</p>
<p>Following are some sample <code>pg_hba.conf</code> basic authentication entries:</p>
<pre><code>hostnossl    all   all        0.0.0.0   reject
hostssl      all   testuser   0.0.0.0/0 md5
local        all   gpuser               ident
</code></pre>
<p>Or:</p>
<pre><code>local    all           gpadmin         ident 
host     all           gpadmin         localhost      trust 
host     all           gpadmin         mdw            trust 
local    replication   gpadmin         ident 
host     replication   gpadmin         samenet       trust 
host     all           all             0.0.0.0/0     md5
</code></pre>
<p>Or:</p>
<pre><code># Require SCRAM authentication for most users, but make an exception
# for user 'mike', who uses an older client that doesn't support SCRAM
# authentication.
#
host    all             mike            .example.com            md5
host    all             all             .example.com            scram-sha-256
</code></pre>
<h3 id="gssapi-authentication"><a class="header" href="#gssapi-authentication"><a id="kerberos_auth"></a>GSSAPI Authentication</a></h3>
<p>GSSAPI is an industry-standard protocol for secure authentication defined in RFC 2743. SynxDB supports GSSAPI with Kerberos authentication according to RFC 1964. GSSAPI provides automatic authentication (single sign-on) for systems that support it. The authentication itself is secure, but the data sent over the database connection will be sent unencrypted unless SSL is used.</p>
<p>The <code>gss</code> authentication method is only available for TCP/IP connections.</p>
<p>When GSSAPI uses Kerberos, it uses a standard principal in the format <code>servicename/hostname@realm</code>. The SynxDB server will accept any principal that is included in the keytab file used by the server, but care needs to be taken to specify the correct principal details when making the connection from the client using the <code>krbsrvname</code> connection parameter. (See <a href="https://www.postgresql.org/docs/9.4/libpq-connect.html#LIBPQ-PARAMKEYWORDS">Connection Parameter Key Words</a> in the PostgreSQL documentation.) In most environments, this parameter never needs to be changed. Some Kerberos implementations might require a different service name, such as Microsoft Active Directory, which requires the service name to be in upper case (POSTGRES).</p>
<p><code>hostname</code> is the fully qualified host name of the server machine. The service principal’s realm is the preferred realm of the server machine.</p>
<p>Client principals must have their SynxDB user name as their first component, for example <code>gpusername@realm</code>. Alternatively, you can use a user name mapping to map from the first component of the principal name to the database user name. By default, SynxDB does not check the realm of the client. If you have cross-realm authentication enabled and need to verify the realm, use the <code>krb_realm</code> parameter, or enable <code>include_realm</code> and use user name mapping to check the realm.</p>
<p>Make sure that your server keytab file is readable (and preferably only readable) by the <code>gpadmin</code> server account. The location of the key file is specified by the <a href="../../ref_guide/config_params/guc-list.html">krb_server_keyfile</a> configuration parameter. For security reasons, it is recommended to use a separate keytab just for the SynxDB server rather than opening up permissions on the system keytab file.</p>
<p>The keytab file is generated by the Kerberos software; see the Kerberos documentation for details. The following example is for MIT-compatible Kerberos 5 implementations:</p>
<pre><code>kadmin% **ank -randkey postgres/server.my.domain.org**
kadmin% **ktadd -k krb5.keytab postgres/server.my.domain.org**
</code></pre>
<p>When connecting to the database make sure you have a ticket for a principal matching the requested database user name. For example, for database user name <code>fred</code>, principal <code>fred@EXAMPLE.COM</code> would be able to connect. To also allow principal <code>fred/users.example.com@EXAMPLE.COM</code>, use a user name map, as described in <a href="https://www.postgresql.org/docs/9.4/auth-username-maps.html">User Name Maps</a> in the PostgreSQL documentation.</p>
<p>The following configuration options are supported for GSSAPI:</p>
<p><code>include_realm</code>
:   If set to 1, the realm name from the authenticated user principal is included in the system user name that is passed through user name mapping. This is the recommended configuration as, otherwise, it is impossible to differentiate users with the same username who are from different realms. The default for this parameter is 0 (meaning to not include the realm in the system user name) but may change to 1 in a future version of SynxDB. You can set it explicitly to avoid any issues when upgrading.</p>
<p><code>map</code>
:   Allows for mapping between system and database user names. For a GSSAPI/Kerberos principal, such as <code>username@EXAMPLE.COM</code> (or, less commonly, <code>username/hostbased@EXAMPLE.COM</code>), the default user name used for mapping is <code>username</code> (or <code>username/hostbased</code>, respectively), unless <code>include_realm</code> has been set to 1 (as recommended, see above), in which case <code>username@EXAMPLE.COM</code> (or <code>username/hostbased@EXAMPLE.COM</code>) is what is seen as the system username when mapping.</p>
<p><code>krb_realm</code>
:   Sets the realm to match user principal names against. If this parameter is set, only users of that realm will be accepted. If it is not set, users of any realm can connect, subject to whatever user name mapping is done.</p>
<h3 id="ldap-authentication"><a class="header" href="#ldap-authentication"><a id="ldap_auth"></a>LDAP Authentication</a></h3>
<p>You can authenticate against an LDAP directory.</p>
<ul>
<li>LDAPS and LDAP over TLS options encrypt the connection to the LDAP server.</li>
<li>The connection from the client to the server is not encrypted unless SSL is enabled. Configure client connections to use SSL to encrypt connections from the client.</li>
<li>To configure or customize LDAP settings, set the <code>LDAPCONF</code> environment variable with the path to the <code>ldap.conf</code> file and add this to the <code>synxdb_path.sh</code> script.</li>
</ul>
<p>Following are the recommended steps for configuring your system for LDAP authentication:</p>
<ol>
<li> Set up the LDAP server with the database users/roles to be authenticated via LDAP.</li>
<li>On the database:
<ol>
<li>Verify that the database users to be authenticated via LDAP exist on the database. LDAP is only used for verifying username/password pairs, so the roles should exist in the database.</li>
<li>Update the <code>pg_hba.conf</code> file in the <code>$MASTER_DATA_DIRECTORY</code> to use LDAP as the authentication method for the respective users. Note that the first entry to match the user/role in the <code>pg_hba.conf</code> file will be used as the authentication mechanism, so the position of the entry in the file is important.</li>
<li>Reload the server for the <code>pg_hba.conf</code> configuration settings to take effect (<code>gpstop -u</code>).</li>
</ol>
</li>
</ol>
<p>Specify the following parameter <code>auth-options</code>.</p>
<p>ldapserver
:   Names or IP addresses of LDAP servers to connect to. Multiple servers may be specified, separated by spaces.</p>
<p>ldapprefix
:   String to prepend to the user name when forming the DN to bind as, when doing simple bind authentication.</p>
<p>ldapsuffix
:   String to append to the user name when forming the DN to bind as, when doing simple bind authentication.</p>
<p>ldapport
:   Port number on LDAP server to connect to. If no port is specified, the LDAP library’s default port setting will be used.</p>
<p>ldaptls
:   Set to 1 to make the connection between PostgreSQL and the LDAP server use TLS encryption. Note that this only encrypts the traffic to the LDAP server — the connection to the client will still be unencrypted unless SSL is used.</p>
<p>ldapbasedn
:   Root DN to begin the search for the user in, when doing search+bind authentication.</p>
<p>ldapbinddn
:   DN of user to bind to the directory with to perform the search when doing search+bind authentication.</p>
<p>ldapbindpasswd
:   Password for user to bind to the directory with to perform the search when doing search+bind authentication.</p>
<p>ldapsearchattribute
:   Attribute to match against the user name in the search when doing search+bind authentication.</p>
<p>ldapsearchfilter
:   This attribute enables you to provide a search filter to use when doing search+bind authentication. Occurrences of <code>$username</code> will be replaced with the user name. This allows for more flexible search filters than <code>ldapsearchattribute</code>. Note that you can specify <em>either</em> <code>ldapsearchattribute</code> or <code>ldapsearchattribute</code>, but not both.</p>
<p>When using search+bind mode, the search can be performed using a single attribute specified with <code>ldapsearchattribute</code>, or using a custom search filter specified with <code>ldapsearchfilter</code>. Specifying <code>ldapsearchattribute=foo</code> is equivalent to specifying <code>ldapsearchfilter="(foo=$username)"</code>. If neither option is specified the default is <code>ldapsearchattribute=uid</code>.</p>
<p>Here is an example for a search+bind configuration that uses <code>ldapsearchfilter</code> instead of <code>ldapsearchattribute</code> to allow authentication by user ID or email address:</p>
<pre><code>host ... ldap ldapserver=ldap.example.net ldapbasedn="dc=example, dc=net" ldapsearchfilter="(|(uid=$username)(mail=$username))"
</code></pre>
<p>Following are additional sample <code>pg_hba.conf</code> file entries for LDAP authentication:</p>
<pre><code>host all testuser 0.0.0.0/0 ldap ldap
ldapserver=ldapserver.greenplum.com ldapport=389 ldapprefix="cn=" ldapsuffix=",ou=people,dc=greenplum,dc=com"
hostssl   all   ldaprole   0.0.0.0/0   ldap
ldapserver=ldapserver.greenplum.com ldaptls=1 ldapprefix="cn=" ldapsuffix=",ou=people,dc=greenplum,dc=com"
</code></pre>
<h2 id="ssl-client-authentication"><a class="header" href="#ssl-client-authentication"><a id="topic_fzv_wb2_jr"></a>SSL Client Authentication</a></h2>
<p>SSL authentication compares the Common Name (cn) attribute of an SSL certificate provided by the connecting client during the SSL handshake to the requested database user name. The database user should exist in the database. A map file can be used for mapping between system and database user names.</p>
<h3 id="ssl-authentication-parameters"><a class="header" href="#ssl-authentication-parameters"><a id="sslauth"></a>SSL Authentication Parameters</a></h3>
<p>Authentication method:</p>
<ul>
<li>
<p>Cert</p>
<p>Authentication options:</p>
<p>Hostssl
:   Connection type must be hostssl.</p>
<p>map=mapping
:   mapping.</p>
<p>:   This is specified in the <code>pg_ident.conf</code>, or in the file specified in the <code>ident_file</code> server setting.</p>
<p>Following are sample <code>pg_hba.conf</code> entries for SSL client authentication:</p>
<pre><code>Hostssl testdb certuser 192.168.0.0/16 cert
Hostssl testdb all 192.168.0.0/16 cert map=gpuser

</code></pre>
</li>
</ul>
<h3 id="openssl-configuration"><a class="header" href="#openssl-configuration"><a id="openssl_config"></a>OpenSSL Configuration</a></h3>
<p>You can make changes to the OpenSSL configuration by updating the <code>openssl.cnf</code> file under your OpenSSL installation directory, or the file referenced by <code>$OPENSSL_CONF</code>, if present, and then restarting the SynxDB server.</p>
<h3 id="creating-a-self-signed-certificate"><a class="header" href="#creating-a-self-signed-certificate"><a id="create_a_cert"></a>Creating a Self-Signed Certificate</a></h3>
<p>A self-signed certificate can be used for testing, but a certificate signed by a certificate authority (CA) (either one of the global CAs or a local one) should be used in production so that clients can verify the server’s identity. If all the clients are local to the organization, using a local CA is recommended.</p>
<p>To create a self-signed certificate for the server:</p>
<ol>
<li>
<p>Enter the following <code>openssl</code> command:</p>
<pre><code>openssl req -new -text -out server.req
</code></pre>
</li>
<li>
<p>Enter the requested information at the prompts.</p>
<p>Make sure you enter the local host name for the Common Name. The challenge password can be left blank.</p>
</li>
<li>
<p>The program generates a key that is passphrase-protected; it does not accept a passphrase that is less than four characters long. To remove the passphrase (and you must if you want automatic start-up of the server), run the following command:</p>
<pre><code>openssl rsa -in privkey.pem -out server.key
rm privkey.pem
</code></pre>
</li>
<li>
<p>Enter the old passphrase to unlock the existing key. Then run the following command:</p>
<pre><code>openssl req -x509 -in server.req -text -key server.key -out server.crt
</code></pre>
<p>This turns the certificate into a self-signed certificate and copies the key and certificate to where the server will look for them.</p>
</li>
<li>
<p>Finally, run the following command:</p>
<pre><code>chmod og-rwx server.key
</code></pre>
</li>
</ol>
<p>For more details on how to create your server private key and certificate, refer to the OpenSSL documentation.</p>
<h3 id="configuring-postgresqlconf-for-ssl-authentication"><a class="header" href="#configuring-postgresqlconf-for-ssl-authentication"><a id="ssl_postgresql"></a>Configuring postgresql.conf for SSL Authentication</a></h3>
<p>The following Server settings need to be specified in the <code>postgresql.conf</code> configuration file:</p>
<ul>
<li>
<p><code>ssl</code> <em>boolean</em>. Enables SSL connections.</p>
</li>
<li>
<p><code>ssl_ciphers</code> <em>string</em>. Configures the list SSL ciphers that are allowed. <code>ssl_ciphers</code> <em>overrides</em> any ciphers string specified in <code>/etc/openssl.cnf</code>. The default value <code>ALL:!ADH:!LOW:!EXP:!MD5:@STRENGTH</code> enables all ciphers except for ADH, LOW, EXP, and MD5 ciphers, and prioritizes ciphers by their strength.</p>
<p><br/>&gt; <strong>Note</strong> With TLS 1.2 some ciphers in MEDIUM and HIGH strength still use NULL encryption (no encryption for transport), which the default <code>ssl_ciphers</code> string allows. To bypass NULL ciphers with TLS 1.2 use a string such as <code>TLSv1.2:!eNULL:!aNULL</code>.</p>
<p>It is possible to have authentication without encryption overhead by using <code>NULL-SHA</code> or <code>NULL-MD5</code> ciphers. However, a man-in-the-middle could read and pass communications between client and server. Also, encryption overhead is minimal compared to the overhead of authentication. For these reasons, NULL ciphers should not be used.</p>
</li>
</ul>
<p>The default location for the following SSL server files is the SynxDB master data directory (<code>$MASTER_DATA_DIRECTORY</code>):</p>
<ul>
<li><code>server.crt</code> - Server certificate.</li>
<li><code>server.key</code> - Server private key.</li>
<li><code>root.crt</code> - Trusted certificate authorities.</li>
<li><code>root.crl</code> - Certificates revoked by certificate authorities.</li>
</ul>
<p>If SynxDB master mirroring is enabled with SSL client authentication, the SSL server files <em>should not be placed</em> in the default directory <code>$MASTER_DATA_DIRECTORY</code>. If a <code>gpinitstandby</code> operation is performed, the contents of <code>$MASTER_DATA_DIRECTORY</code> is copied from the master to the standby master and the incorrect SSL key, and cert files (the master files, and not the standby master files) will prevent standby master start up.</p>
<p>You can specify a different directory for the location of the SSL server files with the <code>postgresql.conf</code> parameters <code>sslcert</code>, <code>sslkey</code>, <code>sslrootcert</code>, and <code>sslcrl</code>.</p>
<h3 id="configuring-the-ssl-client-connection"><a class="header" href="#configuring-the-ssl-client-connection"><a id="config_ssl_client_conn"></a>Configuring the SSL Client Connection</a></h3>
<p>SSL options:</p>
<p>sslmode
:   Specifies the level of protection.</p>
<p><code>require</code>
:   Only use an SSL connection. If a root CA file is present, verify the certificate in the same way as if <code>verify-ca</code> was specified.</p>
<p><code>verify-ca</code>
:   Only use an SSL connection. Verify that the server certificate is issued by a trusted CA.</p>
<p><code>verify-full</code>
:   Only use an SSL connection. Verify that the server certificate is issued by a trusted CA and that the server host name matches that in the certificate.</p>
<p>sslcert
:   The file name of the client SSL certificate. The default is <code>$MASTER_DATA_DIRECTORY/postgresql.crt</code>.</p>
<p>sslkey
:   The secret key used for the client certificate. The default is <code>$MASTER_DATA_DIRECTORY/postgresql.key</code>.</p>
<p>sslrootcert
:   The name of a file containing SSL Certificate Authority certificate(s). The default is <code>$MASTER_DATA_DIRECTORY/root.crt</code>.</p>
<p>sslcrl
:   The name of the SSL certificate revocation list. The default is <code>$MASTER_DATA_DIRECTORY/root.crl</code>.</p>
<p>The client connection parameters can be set using the following environment variables:</p>
<ul>
<li><code>sslmode</code> – <code>PGSSLMODE</code></li>
<li><code>sslcert</code> – <code>PGSSLCERT</code></li>
<li><code>sslkey</code> – <code>PGSSLKEY</code></li>
<li><code>sslrootcert</code> – <code>PGSSLROOTCERT</code></li>
<li><code>sslcrl</code> – <code>PGSSLCRL</code> </li>
</ul>
<p>For example, run the following command to connect to the <code>postgres</code> database from <code>localhost</code> and verify the certificate present in the default location under <code>$MASTER_DATA_DIRECTORY</code>:</p>
<pre><code>psql "sslmode=verify-ca host=localhost dbname=postgres"
</code></pre>
<h2 id="pam-based-authentication"><a class="header" href="#pam-based-authentication"><a id="topic_yxp_5h2_jr"></a>PAM-Based Authentication</a></h2>
<p>The “PAM” (Pluggable Authentication Modules) authentication method validates username/password pairs, similar to basic authentication. To use PAM authentication, the user must already exist as a SynxDB role name.</p>
<p>SynxDB uses the <code>pamservice</code> authentication parameter to identify the service from which to obtain the PAM configuration.</p>
<blockquote>
<p><strong>Note</strong> If PAM is set up to read <code>/etc/shadow</code>, authentication will fail because the PostgreSQL server is started by a non-root user. This is not an issue when PAM is configured to use LDAP or another authentication method.</p>
</blockquote>
<p>SynxDB does not install a PAM configuration file. If you choose to use PAM authentication with SynxDB, you must identify the PAM service name for SynxDB and create the associated PAM service configuration file and configure SynxDB to use PAM authentication as described below:</p>
<ol>
<li>
<p>Log in to the SynxDB master host and set up your environment. For example:</p>
<pre><code>$ ssh gpadmin@&lt;gpmaster&gt;
gpadmin@gpmaster$ . /usr/local/synxdb/synxdb_path.sh
</code></pre>
</li>
<li>
<p>Identify the <code>pamservice</code> name for SynxDB. In this procedure, we choose the name <code>synxdb</code>.</p>
</li>
<li>
<p>Create the PAM service configuration file, <code>/etc/pam.d/synxdb</code>, and add the text below. You must have operating system superuser privileges to create the <code>/etc/pam.d</code> directory (if necessary) and the <code>synxdb</code> PAM configuration file.</p>
<pre><code>#%PAM-1.0
auth		include		password-auth
account		include		password-auth

</code></pre>
<p>This configuration instructs PAM to authenticate the local operating system user.</p>
</li>
<li>
<p>Ensure that the <code>/etc/pam.d/synxdb</code> file is readable by all users:</p>
<pre><code>sudo chmod 644 /etc/pam.d/synxdb
</code></pre>
</li>
<li>
<p>Add one or more entries to the <code>pg_hba.conf</code> configuration file to enable PAM authentication in SynxDB. These entries must specify the <code>pam</code> <em>auth-method</em>. You must also specify the <code>pamservice=synxdb</code> <em>auth-option</em>. For example:</p>
<pre><code>
host     &lt;user-name&gt;     &lt;db-name&gt;     &lt;address&gt;     pam     pamservice=synxdb

</code></pre>
</li>
<li>
<p>Reload the SynxDB configuration:</p>
<pre><code>$ gpstop -u
</code></pre>
</li>
</ol>
<h2 id="radius-authentication"><a class="header" href="#radius-authentication"><a id="topic_ed4_d32_jr"></a>Radius Authentication</a></h2>
<p>RADIUS (Remote Authentication Dial In User Service) authentication works by sending an Access Request message of type ‘Authenticate Only’ to a configured RADIUS server. It includes parameters for user name, password (encrypted), and the Network Access Server (NAS) Identifier. The request is encrypted using the shared secret specified in the <code>radiussecret</code> option. The RADIUS server responds with either <code>Access Accept</code> or <code>Access Reject</code>.</p>
<blockquote>
<p><strong>Note</strong> RADIUS accounting is not supported.</p>
</blockquote>
<p>RADIUS authentication only works if the users already exist in the database.</p>
<p>The RADIUS encryption vector requires SSL to be enabled in order to be cryptographically strong.</p>
<h3 id="radius-authentication-options"><a class="header" href="#radius-authentication-options"><a id="radius"></a>RADIUS Authentication Options</a></h3>
<p>radiusserver
:   The name of the RADIUS server.</p>
<p>radiussecret
:   The RADIUS shared secret.</p>
<p>radiusport
:   The port to connect to on the RADIUS server.</p>
<p>radiusidentifier
:   NAS identifier in RADIUS requests.</p>
<p>Following are sample <code>pg_hba.conf</code> entries for RADIUS client authentication:</p>
<pre><code>hostssl  all all 0.0.0.0/0 radius radiusserver=servername radiussecret=sharedsecret
</code></pre>
<h2 id="limiting-concurrent-connections"><a class="header" href="#limiting-concurrent-connections"><a id="topic_hwn_bk2_jr"></a>Limiting Concurrent Connections</a></h2>
<p>To limit the number of active concurrent sessions to your SynxDB system, you can configure the <code>max_connections</code> server configuration parameter. This is a local parameter, meaning that you must set it in the <code>postgresql.conf</code> file of the master, the standby master, and each segment instance (primary and mirror). The value of <code>max_connections</code> on segments must be 5-10 times the value on the master.</p>
<p>When you set <code>max_connections</code>, you must also set the dependent parameter <code>max_prepared_transactions</code>. This value must be at least as large as the value of <code>max_connections</code> on the master, and segment instances should be set to the same value as the master.</p>
<p>In <code>$MASTER_DATA_DIRECTORY/postgresql.conf</code> (including standby master):</p>
<pre><code>max_connections=100
max_prepared_transactions=100
</code></pre>
<p>In <code>SEGMENT_DATA_DIRECTORY/postgresql.conf</code> for all segment instances:</p>
<pre><code>max_connections=500
max_prepared_transactions=100
</code></pre>
<blockquote>
<p><strong>Note</strong> Raising the values of these parameters may cause SynxDB to request more shared memory. To mitigate this effect, consider decreasing other memory-related parameters such as <code>gp_cached_segworkers_threshold</code>.</p>
</blockquote>
<p>To change the number of allowed connections:</p>
<ol>
<li>
<p>Stop your SynxDB system:</p>
<pre><code>$ gpstop
</code></pre>
</li>
<li>
<p>On the master host, edit <code>$MASTER_DATA_DIRECTORY/postgresql.conf</code> and change the following two parameters:</p>
<ul>
<li><code>max_connections</code> – the number of active user sessions you want to allow plus the number of <code>superuser_reserved_connections</code>.</li>
<li><code>max_prepared_transactions</code> – must be greater than or equal to <code>max_connections</code>.</li>
</ul>
</li>
<li>
<p>On each segment instance, edit <code>SEGMENT_DATA_DIRECTORY/postgresql.conf</code> and change the following two parameters:</p>
<ul>
<li><code>max_connections</code> – must be 5-10 times the value on the master.</li>
<li><code>max_prepared_transactions</code> – must be equal to the value on the master.</li>
</ul>
</li>
<li>
<p>Restart your SynxDB system:</p>
<pre><code>$ gpstart
</code></pre>
</li>
</ol>
<h2 id="encrypting-clientserver-connections"><a class="header" href="#encrypting-clientserver-connections"><a id="topic_ibc_nl2_jr"></a>Encrypting Client/Server Connections</a></h2>
<p>SynxDB has native support for SSL connections between the client and the master server. SSL connections prevent third parties from snooping on the packets, and also prevent man-in-the-middle attacks. SSL should be used whenever the client connection goes through an insecure link, and must be used whenever client certificate authentication is used.</p>
<blockquote>
<p><strong>Note</strong> For information about encrypting data between the <code>gpfdist</code> server and SynxDB segment hosts, see <a href="Encryption.html">Encrypting gpfdist Connections</a>.</p>
</blockquote>
<p>To enable SSL requires that OpenSSL be installed on both the client and the master server systems. SynxDB can be started with SSL enabled by setting the server configuration parameter <code>ssl=on</code> in the master <code>postgresql.conf</code>. When starting in SSL mode, the server will look for the files <code>server.key</code> (server private key) and <code>server.crt</code> (server certificate) in the master data directory. These files must be set up correctly before an SSL-enabled SynxDB system can start.</p>
<blockquote>
<p><strong>Important</strong> Do not protect the private key with a passphrase. The server does not prompt for a passphrase for the private key, and the database startup fails with an error if one is required.</p>
</blockquote>
<p>A self-signed certificate can be used for testing, but a certificate signed by a certificate authority (CA) should be used in production, so the client can verify the identity of the server. Either a global or local CA can be used. If all the clients are local to the organization, a local CA is recommended. See <a href="#create_a_cert">Creating a Self-Signed Certificate</a> for steps to create a self-signed certificate.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../security-guide/topics/ports_and_protocols.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../security-guide/topics/Authorization.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../security-guide/topics/ports_and_protocols.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../security-guide/topics/Authorization.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
