<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Restoring Master Mirroring After a Recovery - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="restoring-master-mirroring-after-a-recovery"><a class="header" href="#restoring-master-mirroring-after-a-recovery">Restoring Master Mirroring After a Recovery</a></h1>
<p>After you activate a standby master for recovery, the standby master becomes the primary master. You can continue running that instance as the primary master if it has the same capabilities and dependability as the original master host.</p>
<p>You must initialize a new standby master to continue providing master mirroring unless you have already done so while activating the prior standby master. Run <a href="../../../utility_guide/ref/gpinitstandby.html">gpinitstandby</a> on the active master host to configure a new standby master. See <a href="g-enabling-master-mirroring.html">Enabling Master Mirroring</a>.</p>
<p>You can restore the primary and standby master instances on the original hosts. This process swaps the roles of the primary and standby master hosts, and it should be performed only if you strongly prefer to run the master instances on the same hosts they occupied prior to the recovery scenario.</p>
<blockquote>
<p><strong>Important</strong> Restoring the primary and standby master instances to their original hosts is not an online operation. The master host must be stopped to perform the operation.</p>
</blockquote>
<p>For information about the SynxDB utilities, see the <em>SynxDB Utility Guide</em>.</p>
<h2 id="to-restore-the-master-mirroring-after-a-recovery"><a class="header" href="#to-restore-the-master-mirroring-after-a-recovery"><a id="topic_us3_md4_npb"></a>To restore the master mirroring after a recovery</a></h2>
<ol>
<li>
<p>Ensure the original master host is in dependable running condition; ensure the cause of the original failure is fixed.</p>
</li>
<li>
<p>On the original master host, move or remove the data directory, <code>gpseg-1</code>. This example moves the directory to <code>backup_gpseg-1</code>:</p>
<pre><code>$ mv /data/master/gpseg-1 /data/master/backup_gpseg-1
</code></pre>
<p>You can remove the backup directory once the standby is successfully configured.</p>
</li>
<li>
<p>Initialize a standby master on the original master host. For example, run this command from the current master host, smdw:</p>
<pre><code>$ gpinitstandby -s mdw
</code></pre>
</li>
<li>
<p>After the initialization completes, check the status of standby master, mdw. Run <a href="../../../utility_guide/ref/gpstate.html">gpstate</a> with the <code>-f</code> option to check the standby master status:</p>
<pre><code>$ gpstate -f
</code></pre>
<p>The standby master status should be <code>passive</code>, and the WAL sender state should be <code>streaming</code>.</p>
</li>
</ol>
<h2 id="to-restore-the-master-and-standby-instances-on-original-hosts-optional"><a class="header" href="#to-restore-the-master-and-standby-instances-on-original-hosts-optional"><a id="topic_dr3_ld4_npb"></a>To restore the master and standby instances on original hosts (optional)</a></h2>
<blockquote>
<p><strong>Note</strong> Before performing the steps in this section, be sure you have followed the steps to restore master mirroring after a recovery, as described in the <a href="#topic_us3_md4_npb">To restore the master mirroring after a recovery</a>previous section.</p>
</blockquote>
<ol>
<li>
<p>Stop the SynxDB master instance on the standby master. For example:</p>
<pre><code>$ gpstop -m
</code></pre>
</li>
<li>
<p>Run the <code>gpactivatestandby</code> utility from the original master host, mdw, that is currently a standby master. For example:</p>
<pre><code>$ gpactivatestandby -d $MASTER_DATA_DIRECTORY
</code></pre>
<p>Where the <code>-d</code> option specifies the data directory of the host you are activating.</p>
</li>
<li>
<p>After the utility completes, run <code>gpstate</code> with the <code>-b</code> option to display a summary of the system status:</p>
<pre><code>$ gpstate -b
</code></pre>
<p>The master instance status should be <code>Active</code>. When a standby master is not configured, the command displays <code>No master standby configured</code> for the standby master state.</p>
</li>
<li>
<p>On the standby master host, move or remove the data directory, <code>gpseg-1</code>. This example moves the directory:</p>
<pre><code>$ mv /data/master/gpseg-1 /data/master/backup_gpseg-1
</code></pre>
<p>You can remove the backup directory once the standby is successfully configured.</p>
</li>
<li>
<p>After the original master host runs the primary SynxDB master, you can initialize a standby master on the original standby master host. For example:</p>
<pre><code>$ gpinitstandby -s smdw
</code></pre>
<p>After the command completes, you can run the <code>gpstate -f</code> command on the primary master host, to check the standby master status.</p>
</li>
</ol>
<h2 id="to-check-the-status-of-the-master-mirroring-process-optional"><a class="header" href="#to-check-the-status-of-the-master-mirroring-process-optional"><a id="topic_i1h_kd4_npb"></a>To check the status of the master mirroring process (optional)</a></h2>
<p>You can run the <code>gpstate</code> utility with the <code>-f</code> option to display details of the standby master host.</p>
<pre><code>$ gpstate -f
</code></pre>
<p>The standby master status should be <code>passive</code>, and the WAL sender state should be <code>streaming</code>.</p>
<p>For information about the <a href="../../../utility_guide/ref/gpstate.html">gpstate</a> utility, see the <em>SynxDB Utility Guide</em>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../admin_guide/highavail/topics/g-recovering-a-failed-master.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../admin_guide/managing/backup-main.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../admin_guide/highavail/topics/g-recovering-a-failed-master.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../admin_guide/managing/backup-main.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
