<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Using LDAP Authentication with TLS/SSL - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="using-ldap-authentication-with-tlsssl"><a class="header" href="#using-ldap-authentication-with-tlsssl">Using LDAP Authentication with TLS/SSL</a></h1>
<p>You can control access to SynxDB with an LDAP server and, optionally, secure the connection with encryption by adding parameters to pg_hba.conf file entries.</p>
<p>SynxDB supports LDAP authentication with the TLS/SSL protocol to encrypt communication with an LDAP server:</p>
<ul>
<li>LDAP authentication with STARTTLS and TLS protocol – STARTTLS starts with a clear text connection (no encryption) and upgrades it to a secure connection (with encryption).</li>
<li>LDAP authentication with a secure connection and TLS/SSL (LDAPS) – SynxDB uses the TLS or SSL protocol based on the protocol that is used by the LDAP server.</li>
</ul>
<p>If no protocol is specified, SynxDB communicates with the LDAP server with a clear text connection.</p>
<p>To use LDAP authentication, the SynxDB master host must be configured as an LDAP client. See your LDAP documentation for information about configuring LDAP clients.</p>
<h2 id="enabling-ldap-authentication-with-starttls-and-tls"><a class="header" href="#enabling-ldap-authentication-with-starttls-and-tls"><a id="enldap"></a>Enabling LDAP Authentication with STARTTLS and TLS</a></h2>
<p>To enable STARTTLS with the TLS protocol, in the pg_hba.conf file, add an <code>ldap</code> line and specify the <code>ldaptls</code> parameter with the value 1. The default port is 389. In this example, the authentication method parameters include the <code>ldaptls</code> parameter.</p>
<pre><code>ldap ldapserver=myldap.com ldaptls=1 ldapprefix="uid=" ldapsuffix=",ou=People,dc=example,dc=com"
</code></pre>
<p>Specify a non-default port with the <code>ldapport</code> parameter. In this example, the authentication method includes the <code>ldaptls</code> parameter and the <code>ldapport</code> parameter to specify the port 550.</p>
<pre><code>ldap ldapserver=myldap.com ldaptls=1 ldapport=500 ldapprefix="uid=" ldapsuffix=",ou=People,dc=example,dc=com"
</code></pre>
<h2 id="enabling-ldap-authentication-with-a-secure-connection-and-tlsssl"><a class="header" href="#enabling-ldap-authentication-with-a-secure-connection-and-tlsssl"><a id="enldapauth"></a>Enabling LDAP Authentication with a Secure Connection and TLS/SSL</a></h2>
<p>To enable a secure connection with TLS/SSL, add <code>ldaps://</code> as the prefix to the LDAP server name specified in the <code>ldapserver</code> parameter. The default port is 636.</p>
<p>This example <code>ldapserver</code> parameter specifies a secure connection and the TLS/SSL protocol for the LDAP server <code>myldap.com</code>.</p>
<pre><code>ldapserver=ldaps://myldap.com
</code></pre>
<p>To specify a non-default port, add a colon (:) and the port number after the LDAP server name. This example <code>ldapserver</code> parameter includes the <code>ldaps://</code> prefix and the non-default port 550.</p>
<pre><code>ldapserver=ldaps://myldap.com:550
</code></pre>
<h2 id="configuring-authentication-with-a-system-wide-openldap-system"><a class="header" href="#configuring-authentication-with-a-system-wide-openldap-system"><a id="conauth"></a>Configuring Authentication with a System-wide OpenLDAP System</a></h2>
<p>If you have a system-wide OpenLDAP system and logins are configured to use LDAP with TLS or SSL in the pg_hba.conf file, logins may fail with the following message:</p>
<pre><code>could not start LDAP TLS session: error code '-11'
</code></pre>
<p>To use an existing OpenLDAP system for authentication, SynxDB must be set up to use the LDAP server’s CA certificate to validate user certificates. Follow these steps on both the master and standby hosts to configure SynxDB:</p>
<ol>
<li>
<p>Copy the base64-encoded root CA chain file from the Active Directory or LDAP server to the SynxDB master and standby master hosts. This example uses the directory <code>/etc/pki/tls/certs</code>.</p>
</li>
<li>
<p>Change to the directory where you copied the CA certificate file and, as the root user, generate the hash for OpenLDAP:</p>
<pre><code># cd /etc/pki/tls/certs  
# openssl x509 -noout -hash -in &lt;ca-certificate-file&gt;  
# ln -s &lt;ca-certificate-file&gt; &lt;ca-certificate-file&gt;.0
</code></pre>
</li>
<li>
<p>Configure an OpenLDAP configuration file for SynxDB with the CA certificate directory and certificate file specified.</p>
<p>As the root user, edit the OpenLDAP configuration file <code>/etc/openldap/ldap.conf</code>:</p>
<pre><code>SASL_NOCANON on
 URI ldaps://ldapA.example.priv ldaps://ldapB.example.priv ldaps://ldapC.example.priv
 BASE dc=example,dc=priv
 TLS_CACERTDIR /etc/pki/tls/certs
 TLS_CACERT /etc/pki/tls/certs/&lt;ca-certificate-file&gt;
</code></pre>
<blockquote>
<p><strong>Note</strong> For certificate validation to succeed, the hostname in the certificate must match a hostname in the URI property. Otherwise, you must also add <code>TLS_REQCERT allow</code> to the file.</p>
</blockquote>
</li>
<li>
<p>As the gpadmin user, edit <code>/usr/local/synxdb/synxdb_path.sh</code> and add the following line.</p>
<pre><code>export LDAPCONF=/etc/openldap/ldap.conf
</code></pre>
</li>
</ol>
<h2 id="notes"><a class="header" href="#notes"><a id="notes2"></a>Notes</a></h2>
<p>SynxDB logs an error if the following are specified in an pg_hba.conf file entry:</p>
<ul>
<li>If both the <code>ldaps://</code> prefix and the <code>ldaptls=1</code> parameter are specified.</li>
<li>If both the <code>ldaps://</code> prefix and the <code>ldapport</code> parameter are specified.</li>
</ul>
<p>Enabling encrypted communication for LDAP authentication only encrypts the communication between SynxDB and the LDAP server.</p>
<p>See <a href="client_auth.html">Encrypting Client/Server Connections</a> for information about encrypting client connections.</p>
<h2 id="examples"><a class="header" href="#examples"><a id="exams"></a>Examples</a></h2>
<p>These are example entries from an pg_hba.conf file.</p>
<p>This example specifies LDAP authentication with no encryption between SynxDB and the LDAP server.</p>
<pre><code>host all plainuser 0.0.0.0/0 ldap ldapserver=myldap.com ldapprefix="uid=" ldapsuffix=",ou=People,dc=example,dc=com"
</code></pre>
<p>This example specifies LDAP authentication with the STARTTLS and TLS protocol between SynxDB and the LDAP server.</p>
<pre><code>host all tlsuser 0.0.0.0/0 ldap ldapserver=myldap.com ldaptls=1 ldapprefix="uid=" ldapsuffix=",ou=People,dc=example,dc=com" 
</code></pre>
<p>This example specifies LDAP authentication with a secure connection and TLS/SSL protocol between SynxDB and the LDAP server.</p>
<pre><code>host all ldapsuser 0.0.0.0/0 ldap ldapserver=ldaps://myldap.com ldapprefix="uid=" ldapsuffix=",ou=People,dc=example,dc=com"
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../admin_guide/client_auth.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../admin_guide/kerberos.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../admin_guide/client_auth.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../admin_guide/kerberos.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
