<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Working with JSON Data - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="working-with-json-data"><a class="header" href="#working-with-json-data">Working with JSON Data</a></h1>
<p>SynxDB supports the <code>json</code> and <code>jsonb</code> data types that store JSON (JavaScript Object Notation) data.</p>
<p>SynxDB supports JSON as specified in the <a href="https://tools.ietf.org/html/rfc7159">RFC 7159</a> document and enforces data validity according to the JSON rules. There are also JSON-specific functions and operators available for the <code>json</code> and <code>jsonb</code> data types. See <a href="#topic_gn4_x3w_mq">JSON Functions and Operators</a>.</p>
<p>This section contains the following topics:</p>
<ul>
<li><a href="#topic_upc_tcs_fz">About JSON Data</a></li>
<li><a href="#topic_isn_ltw_mq">JSON Input and Output Syntax</a></li>
<li><a href="#topic_eyt_3tw_mq">Designing JSON documents</a></li>
<li><a href="#topic_isx_2tw_mq">jsonb Containment and Existence</a></li>
<li><a href="#topic_aqt_1tw_mq">jsonb Indexing</a></li>
<li><a href="#topic_gn4_x3w_mq">JSON Functions and Operators</a></li>
</ul>
<h2 id="about-json-data"><a class="header" href="#about-json-data"><a id="topic_upc_tcs_fz"></a>About JSON Data</a></h2>
<p>SynxDB supports two JSON data types: <code>json</code> and <code>jsonb</code>. They accept almost identical sets of values as input. The major difference is one of efficiency.</p>
<ul>
<li>
<p>The <code>json</code> data type stores an exact copy of the input text. This requires JSON processing functions to reparse <code>json</code> data on each execution. The <code>json</code> data type does not alter the input text.</p>
<ul>
<li>Semantically-insignificant white space between tokens is retained, as well as the order of keys within JSON objects.</li>
<li>All key/value pairs are kept even if a JSON object contains duplicate keys. For duplicate keys, JSON processing functions consider the last value as the operative one.</li>
</ul>
</li>
<li>
<p>The <code>jsonb</code> data type stores a decomposed binary format of the input text. The conversion overhead makes data input slightly slower than the <code>json</code> data type. However, The JSON processing functions are significantly faster because reparsing <code>jsonb</code> data is not required. The <code>jsonb</code> data type alters the input text.</p>
<ul>
<li>White space is not preserved.</li>
<li>The order of object keys is not preserved.</li>
<li>Duplicate object keys are not kept. If the input includes duplicate keys, only the last value is kept.
The <code>jsonb</code> data type supports indexing. See <a href="#topic_aqt_1tw_mq">jsonb Indexing</a>.</li>
</ul>
</li>
</ul>
<p>In general, JSON data should be stored as the <code>jsonb</code> data type unless there are specialized needs, such as legacy assumptions about ordering of object keys.</p>
<h3 id="about-unicode-characters-in-json-data"><a class="header" href="#about-unicode-characters-in-json-data"><a id="abuni"></a>About Unicode Characters in JSON Data</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc7159">RFC 7159</a> document permits JSON strings to contain Unicode escape sequences denoted by <code>\uXXXX</code>. However, SynxDB allows only one character set encoding per database. It is not possible for the <code>json</code> data type to conform rigidly to the JSON specification unless the database encoding is UTF8. Attempts to include characters that cannot be represented in the database encoding will fail. Characters that can be represented in the database encoding, but not in UTF8, are allowed.</p>
<ul>
<li>The SynxDB input function for the <code>json</code> data type allows Unicode escapes regardless of the database encoding and checks Unicode escapes only for syntactic correctness (a <code>\u</code> followed by four hex digits).</li>
<li>The SynxDB input function for the <code>jsonb</code> data type is more strict. It does not allow Unicode escapes for non-ASCII characters (those above <code>U+007F</code>) unless the database encoding is UTF8. It also rejects <code>\u0000</code>, which cannot be represented in the SynxDB <code>text</code> type, and it requires that any use of Unicode surrogate pairs to designate characters outside the Unicode Basic Multilingual Plane be correct. Valid Unicode escapes, except for <code>\u0000</code>, are converted to the equivalent ASCII or UTF8 character for storage; this includes folding surrogate pairs into a single character.</li>
</ul>
<blockquote>
<p><strong>Note</strong> Many of the JSON processing functions described in <a href="#topic_gn4_x3w_mq">JSON Functions and Operators</a> convert Unicode escapes to regular characters. The functions throw an error for characters that cannot be represented in the database encoding. You should avoid mixing Unicode escapes in JSON with a non-UTF8 database encoding, if possible.</p>
</blockquote>
<h3 id="mapping-json-data-types-to-synxdb-data-types"><a class="header" href="#mapping-json-data-types-to-synxdb-data-types"><a id="mapjson"></a>Mapping JSON Data Types to SynxDB Data Types</a></h3>
<p>When converting JSON text input into <code>jsonb</code> data, the primitive data types described by RFC 7159 are effectively mapped onto native SynxDB data types, as shown in the following table.</p>
<div class="table-wrapper"><table><thead><tr><th>JSON primitive data type</th><th>SynxDB data type</th><th>Notes</th></tr></thead><tbody>
<tr><td><code>string</code></td><td><code>text</code></td><td><code>\u0000</code> is not allowed. Non-ASCII Unicode escapes are allowed only if database encoding is UTF8</td></tr>
<tr><td><code>number</code></td><td><code>numeric</code></td><td><code>NaN</code> and <code>infinity</code> values are disallowed</td></tr>
<tr><td><code>boolean</code></td><td><code>boolean</code></td><td>Only lowercase <code>true</code> and <code>false</code> spellings are accepted</td></tr>
<tr><td><code>null</code></td><td>(none)</td><td>The JSON <code>null</code> primitive type is different than the SQL <code>NULL</code>.</td></tr>
</tbody></table>
</div>
<p>There are some minor constraints on what constitutes valid <code>jsonb</code> data that do not apply to the <code>json</code> data type, nor to JSON in the abstract, corresponding to limits on what can be represented by the underlying data type. Notably, when converting data to the <code>jsonb</code> data type, numbers that are outside the range of the SynxDB <code>numeric</code> data type are rejected, while the <code>json</code> data type does not reject such numbers.</p>
<p>Such implementation-defined restrictions are permitted by RFC 7159. However, in practice such problems might occur in other implementations, as it is common to represent the JSON <code>number</code> primitive type as IEEE 754 double precision floating point (which RFC 7159 explicitly anticipates and allows for).</p>
<p>When using JSON as an interchange format with other systems, be aware of the possibility of losing numeric precision compared to data originally stored by SynxDB.</p>
<p>Also, as noted in the previous table, there are some minor restrictions on the input format of JSON primitive types that do not apply to the corresponding SynxDB data types.</p>
<h2 id="json-input-and-output-syntax"><a class="header" href="#json-input-and-output-syntax"><a id="topic_isn_ltw_mq"></a>JSON Input and Output Syntax</a></h2>
<p>The input and output syntax for the <code>json</code> data type is as specified in RFC 7159.</p>
<p>The following are all valid <code>json</code> expressions:</p>
<pre><code>-- Simple scalar/primitive value
-- Primitive values can be numbers, quoted strings, true, false, or null
SELECT '5'::json;

-- Array of zero or more elements (elements need not be of same type)
SELECT '[1, 2, "foo", null]'::json;

-- Object containing pairs of keys and values
-- Note that object keys must always be quoted strings
SELECT '{"bar": "baz", "balance": 7.77, "active": false}'::json;

-- Arrays and objects can be nested arbitrarily
SELECT '{"foo": [true, "bar"], "tags": {"a": 1, "b": null}}'::json;
</code></pre>
<p>As previously stated, when a JSON value is input and then printed without any additional processing, the <code>json</code> data type outputs the same text that was input, while the <code>jsonb</code> data type does not preserve semantically-insignificant details such as whitespace. For example, note the differences here:</p>
<pre><code>SELECT '{"bar": "baz", "balance": 7.77, "active":false}'::json;
                      json                       
-------------------------------------------------
 {"bar": "baz", "balance": 7.77, "active":false}
(1 row)

SELECT '{"bar": "baz", "balance": 7.77, "active":false}'::jsonb;
                      jsonb                       
--------------------------------------------------
 {"bar": "baz", "active": false, "balance": 7.77}
(1 row)
</code></pre>
<p>One semantically-insignificant detail worth noting is that with the <code>jsonb</code> data type, numbers will be printed according to the behavior of the underlying numeric type. In practice, this means that numbers entered with E notation will be printed without it, for example:</p>
<pre><code>SELECT '{"reading": 1.230e-5}'::json, '{"reading": 1.230e-5}'::jsonb;
         json          |          jsonb          
-----------------------+-------------------------
 {"reading": 1.230e-5} | {"reading": 0.00001230}
(1 row)
</code></pre>
<p>However, the <code>jsonb</code> data type preserves trailing fractional zeroes, as seen in previous example, even though those are semantically insignificant for purposes such as equality checks.</p>
<h2 id="designing-json-documents"><a class="header" href="#designing-json-documents"><a id="topic_eyt_3tw_mq"></a>Designing JSON documents</a></h2>
<p>Representing data as JSON can be considerably more flexible than the traditional relational data model, which is compelling in environments where requirements are fluid. It is quite possible for both approaches to co-exist and complement each other within the same application. However, even for applications where maximal flexibility is desired, it is still recommended that JSON documents have a somewhat fixed structure. The structure is typically unenforced (though enforcing some business rules declaratively is possible), but having a predictable structure makes it easier to write queries that usefully summarize a set of JSON documents (datums) in a table.</p>
<p>JSON data is subject to the same concurrency-control considerations as any other data type when stored in a table. Although storing large documents is practicable, keep in mind that any update acquires a row-level lock on the whole row. Consider limiting JSON documents to a manageable size in order to decrease lock contention among updating transactions. Ideally, JSON documents should each represent an atomic datum that business rules dictate cannot reasonably be further subdivided into smaller datums that could be modified independently.</p>
<h2 id="jsonb-containment-and-existence"><a class="header" href="#jsonb-containment-and-existence"><a id="topic_isx_2tw_mq"></a>jsonb Containment and Existence</a></h2>
<p>Testing <em>containment</em> is an important capability of <code>jsonb</code>. There is no parallel set of facilities for the <code>json</code> type. Containment tests whether one <code>jsonb</code> document has contained within it another one. These examples return true except as noted:</p>
<pre><code>-- Simple scalar/primitive values contain only the identical value:
SELECT '"foo"'::jsonb @&gt; '"foo"'::jsonb;

-- The array on the right side is contained within the one on the left:
SELECT '[1, 2, 3]'::jsonb @&gt; '[1, 3]'::jsonb;

-- Order of array elements is not significant, so this is also true:
SELECT '[1, 2, 3]'::jsonb @&gt; '[3, 1]'::jsonb;

-- Duplicate array elements don't matter either:
SELECT '[1, 2, 3]'::jsonb @&gt; '[1, 2, 2]'::jsonb;

-- The object with a single pair on the right side is contained
-- within the object on the left side:
SELECT '{"product": "SynxDB", "version": "6.0.0", "jsonb":true}'::jsonb @&gt; '{"version":"6.0.0"}'::jsonb;

-- The array on the right side is not considered contained within the
-- array on the left, even though a similar array is nested within it:
SELECT '[1, 2, [1, 3]]'::jsonb @&gt; '[1, 3]'::jsonb;  -- yields false

-- But with a layer of nesting, it is contained:
SELECT '[1, 2, [1, 3]]'::jsonb @&gt; '[[1, 3]]'::jsonb;

-- Similarly, containment is not reported here:
SELECT '{"foo": {"bar": "baz", "zig": "zag"}}'::jsonb @&gt; '{"bar": "baz"}'::jsonb; -- yields false

-- But with a layer of nesting, it is contained:
SELECT '{"foo": {"bar": "baz", "zig": "zag"}}'::jsonb @&gt; '{"foo": {"bar": "baz"}}'::jsonb;
</code></pre>
<p>The general principle is that the contained object must match the containing object as to structure and data contents, possibly after discarding some non-matching array elements or object key/value pairs from the containing object. For containment, the order of array elements is not significant when doing a containment match, and duplicate array elements are effectively considered only once.</p>
<p>As an exception to the general principle that the structures must match, an array may contain a primitive value:</p>
<pre><code>-- This array contains the primitive string value:
SELECT '["foo", "bar"]'::jsonb @&gt; '"bar"'::jsonb;

-- This exception is not reciprocal -- non-containment is reported here:
SELECT '"bar"'::jsonb @&gt; '["bar"]'::jsonb;  -- yields false
</code></pre>
<p><code>jsonb</code> also has an <em>existence</em> operator, which is a variation on the theme of containment: it tests whether a string (given as a text value) appears as an object key or array element at the top level of the <code>jsonb</code> value. These examples return true except as noted:</p>
<pre><code>-- String exists as array element:
SELECT '["foo", "bar", "baz"]'::jsonb ? 'bar';

-- String exists as object key:
SELECT '{"foo": "bar"}'::jsonb ? 'foo';

-- Object values are not considered:
SELECT '{"foo": "bar"}'::jsonb ? 'bar';  -- yields false

-- As with containment, existence must match at the top level:
SELECT '{"foo": {"bar": "baz"}}'::jsonb ? 'bar'; -- yields false

-- A string is considered to exist if it matches a primitive JSON string:
SELECT '"foo"'::jsonb ? 'foo';
</code></pre>
<p>JSON objects are better suited than arrays for testing containment or existence when there are many keys or elements involved, because unlike arrays they are internally optimized for searching, and do not need to be searched linearly.</p>
<p>The various containment and existence operators, along with all other JSON operators and functions are documented in <a href="#topic_gn4_x3w_mq">JSON Functions and Operators</a>.</p>
<p>Because JSON containment is nested, an appropriate query can skip explicit selection of sub-objects. As an example, suppose that we have a doc column containing objects at the top level, with most objects containing tags fields that contain arrays of sub-objects. This query finds entries in which sub-objects containing both <code>"term":"paris"</code> and <code>"term":"food"</code> appear, while ignoring any such keys outside the tags array:</p>
<pre><code>SELECT doc-&gt;'site_name' FROM websites
  WHERE doc @&gt; '{"tags":[{"term":"paris"}, {"term":"food"}]}';
</code></pre>
<p>The query with this predicate could accomplish the same thing.</p>
<pre><code>SELECT doc-&gt;'site_name' FROM websites
  WHERE doc-&gt;'tags' @&gt; '[{"term":"paris"}, {"term":"food"}]';
</code></pre>
<p>However, the second approach is less flexible and is often less efficient as well.</p>
<p>On the other hand, the JSON existence operator is not nested: it will only look for the specified key or array element at top level of the JSON value.</p>
<h2 id="jsonb-indexing"><a class="header" href="#jsonb-indexing"><a id="topic_aqt_1tw_mq"></a>jsonb Indexing</a></h2>
<p>The SynxDB <code>jsonb</code> data type, supports GIN, btree, and hash indexes.</p>
<ul>
<li><a href="#topic_yjx_dq2_rfb">GIN Indexes on jsonb Data</a></li>
<li><a href="#topic_ahb_5ly_wq">Btree and Hash Indexes on jsonb Data</a></li>
</ul>
<h3 id="gin-indexes-on-jsonb-data"><a class="header" href="#gin-indexes-on-jsonb-data"><a id="topic_yjx_dq2_rfb"></a>GIN Indexes on jsonb Data</a></h3>
<p>GIN indexes can be used to efficiently search for keys or key/value pairs occurring within a large number of <code>jsonb</code> documents (datums). Two GIN operator classes are provided, offering different performance and flexibility trade-offs.</p>
<p>The default GIN operator class for jsonb supports queries with the <code>@&gt;</code>, <code>?</code>, <code>?&amp;</code> and <code>?|</code> operators. (For details of the semantics that these operators implement, see the <a href="#topic_o5y_14w_2z">operator table</a>.) An example of creating an index with this operator class is:</p>
<pre><code>CREATE INDEX idxgin ON api USING gin (jdoc);
</code></pre>
<p>The non-default GIN operator class <code>jsonb_path_ops</code> supports indexing the <code>@&gt;</code> operator only. An example of creating an index with this operator class is:</p>
<pre><code>CREATE INDEX idxginp ON api USING gin (jdoc jsonb_path_ops);
</code></pre>
<p>Consider the example of a table that stores JSON documents retrieved from a third-party web service, with a documented schema definition. This is a typical document:</p>
<pre><code>{
    "guid": "9c36adc1-7fb5-4d5b-83b4-90356a46061a",
    "name": "Angela Barton",
    "is_active": true,
    "company": "Magnafone",
    "address": "178 Howard Place, Gulf, Washington, 702",
    "registered": "2009-11-07T08:53:22 +08:00",
    "latitude": 19.793713,
    "longitude": 86.513373,
    "tags": [
        "enim",
        "aliquip",
        "qui"
    ]
}
</code></pre>
<p>The JSON documents are stored a table named <code>api</code>, in a <code>jsonb</code> column named <code>jdoc</code>. If a GIN index is created on this column, queries like the following can make use of the index:</p>
<pre><code>-- Find documents in which the key "company" has value "Magnafone"
SELECT jdoc-&gt;'guid', jdoc-&gt;'name' FROM api WHERE jdoc @&gt; '{"company": "Magnafone"}';
</code></pre>
<p>However, the index could not be used for queries like the following. The operator <code>?</code> is indexable, however, the comparison is not applied directly to the indexed column <code>jdoc</code>:</p>
<pre><code>-- Find documents in which the key "tags" contains key or array element "qui"
SELECT jdoc-&gt;'guid', jdoc-&gt;'name' FROM api WHERE jdoc -&gt; 'tags' ? 'qui';
</code></pre>
<p>With appropriate use of expression indexes, the above query can use an index. If querying for particular items within the <code>tags</code> key is common, defining an index like this might be worthwhile:</p>
<pre><code>CREATE INDEX idxgintags ON api USING gin ((jdoc -&gt; 'tags'));
</code></pre>
<p>Now, the <code>WHERE</code> clause <code>jdoc -&gt; 'tags' ? 'qui'</code> is recognized as an application of the indexable operator <code>?</code> to the indexed expression <code>jdoc -&gt; 'tags'</code>. For information about expression indexes, see <a href="../../ddl/ddl-index.html">Indexes on Expressions</a>.</p>
<p>Another approach to querying JSON documents is to exploit containment, for example:</p>
<pre><code>-- Find documents in which the key "tags" contains array element "qui"
SELECT jdoc-&gt;'guid', jdoc-&gt;'name' FROM api WHERE jdoc @&gt; '{"tags": ["qui"]}';

</code></pre>
<p>A simple GIN index on the <code>jdoc</code> column can support this query. However, the index will store copies of every key and value in the <code>jdoc</code> column, whereas the expression index of the previous example stores only data found under the tags key. While the simple-index approach is far more flexible (since it supports queries about any key), targeted expression indexes are likely to be smaller and faster to search than a simple index.</p>
<p>Although the <code>jsonb_path_ops</code> operator class supports only queries with the <code>@&gt;</code> operator, it has performance advantages over the default operator class <code>jsonb_ops</code>. A <code>jsonb_path_ops</code> index is usually much smaller than a <code>jsonb_ops</code> index over the same data, and the specificity of searches is better, particularly when queries contain keys that appear frequently in the data. Therefore search operations typically perform better than with the default operator class.</p>
<p>The technical difference between a <code>jsonb_ops</code> and a <code>jsonb_path_ops</code> GIN index is that the former creates independent index items for each key and value in the data, while the latter creates index items only for each value in the data.</p>
<blockquote>
<p><strong>Note</strong> For this discussion, the term <em>value</em> includes array elements, though JSON terminology sometimes considers array elements distinct from values within objects.</p>
</blockquote>
<p>Basically, each <code>jsonb_path_ops</code> index item is a hash of the value and the key(s) leading to it; for example to index <code>{"foo": {"bar": "baz"}}</code>, a single index item would be created incorporating all three of <code>foo</code>, <code>bar</code>, and <code>baz</code> into the hash value. Thus a containment query looking for this structure would result in an extremely specific index search; but there is no way at all to find out whether <code>foo</code> appears as a key. On the other hand, a <code>jsonb_ops</code> index would create three index items representing <code>foo</code>, <code>bar</code>, and <code>baz</code> separately; then to do the containment query, it would look for rows containing all three of these items. While GIN indexes can perform such an <code>AND</code> search fairly efficiently, it will still be less specific and slower than the equivalent <code>jsonb_path_ops</code> search, especially if there are a very large number of rows containing any single one of the three index items.</p>
<p>A disadvantage of the <code>jsonb_path_ops</code> approach is that it produces no index entries for JSON structures not containing any values, such as <code>{"a": {}}</code>. If a search for documents containing such a structure is requested, it will require a full-index scan, which is quite slow. <code>jsonb_path_ops</code> is ill-suited for applications that often perform such searches.</p>
<h3 id="btree-and-hash-indexes-on-jsonb-data"><a class="header" href="#btree-and-hash-indexes-on-jsonb-data"><a id="topic_ahb_5ly_wq"></a>Btree and Hash Indexes on jsonb Data</a></h3>
<p><code>jsonb</code> also supports <code>btree</code> and <code>hash</code> indexes. These are usually useful only when it is important to check the equality of complete JSON documents.</p>
<p>For completeness the <code>btree</code> ordering for <code>jsonb</code> datums is:</p>
<pre><code>Object &gt; Array &gt; Boolean &gt; Number &gt; String &gt; Null

Object with n pairs &gt; object with n - 1 pairs

Array with n elements &gt; array with n - 1 elements
</code></pre>
<p>Objects with equal numbers of pairs are compared in the order:</p>
<pre><code>key-1, value-1, key-2 ...
</code></pre>
<p>Object keys are compared in their storage order. In particular, since shorter keys are stored before longer keys, this can lead to orderings that might not be intuitive, such as:</p>
<pre><code>{ "aa": 1, "c": 1} &gt; {"b": 1, "d": 1}
</code></pre>
<p>Similarly, arrays with equal numbers of elements are compared in the order:</p>
<pre><code>element-1, element-2 ...
</code></pre>
<p>Primitive JSON values are compared using the same comparison rules as for the underlying SynxDB data type. Strings are compared using the default database collation.</p>
<h2 id="json-functions-and-operators"><a class="header" href="#json-functions-and-operators"><a id="topic_gn4_x3w_mq"></a>JSON Functions and Operators</a></h2>
<p>SynxDB includes built-in functions and operators that create and manipulate JSON data.</p>
<ul>
<li><a href="#topic_o5y_14w_2z">JSON Operators</a></li>
<li><a href="#topic_u4s_wnw_2z">JSON Creation Functions</a></li>
<li><a href="#topic_rvp_lk3_sfb">JSON Aggregate Functions</a></li>
<li><a href="#topic_z5d_snw_2z">JSON Processing Functions</a></li>
</ul>
<blockquote>
<p><strong>Note</strong> For <code>json</code> data type values, all key/value pairs are kept even if a JSON object contains duplicate keys. For duplicate keys, JSON processing functions consider the last value as the operative one. For the <code>jsonb</code> data type, duplicate object keys are not kept. If the input includes duplicate keys, only the last value is kept. See <a href="#topic_upc_tcs_fz">About JSON Data</a>.</p>
</blockquote>
<h3 id="json-operators"><a class="header" href="#json-operators"><a id="topic_o5y_14w_2z"></a>JSON Operators</a></h3>
<p>This table describes the operators that are available for use with the <code>json</code> and <code>jsonb</code> data types.</p>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Right Operand Type</th><th>Description</th><th>Example</th><th>Example Result</th></tr></thead><tbody>
<tr><td><code>-&gt;</code></td><td><code>int</code></td><td>Get the JSON array element (indexed from zero).</td><td><code>'[{"a":"foo"},{"b":"bar"},{"c":"baz"}]'::json-&gt;2</code></td><td><code>{"c":"baz"}</code></td></tr>
<tr><td><code>-&gt;</code></td><td><code>text</code></td><td>Get the JSON object field by key.</td><td><code>'{"a": {"b":"foo"}}'::json-&gt;'a'</code></td><td><code>{"b":"foo"}</code></td></tr>
<tr><td><code>-&gt;&gt;</code></td><td><code>int</code></td><td>Get the JSON array element as <code>text</code>.</td><td><code>'[1,2,3]'::json-&gt;&gt;2</code></td><td><code>3</code></td></tr>
<tr><td><code>-&gt;&gt;</code></td><td><code>text</code></td><td>Get the JSON object field as <code>text</code>.</td><td><code>'{"a":1,"b":2}'::json-&gt;&gt;'b'</code></td><td><code>2</code></td></tr>
<tr><td><code>#&gt;</code></td><td><code>text[]</code></td><td>Get the JSON object at specified path.</td><td><code>'{"a": {"b":{"c": "foo"}}}'::json#&gt;'{a,b}</code>â€™</td><td><code>{"c": "foo"}</code></td></tr>
<tr><td><code>#&gt;&gt;</code></td><td><code>text[]</code></td><td>Get the JSON object at specified path as <code>text</code>.</td><td><code>'{"a":[1,2,3],"b":[4,5,6]}'::json#&gt;&gt;'{a,2}'</code></td><td><code>3</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>Note</strong> There are parallel variants of these operators for both the <code>json</code> and <code>jsonb</code> data types. The field, element, and path extraction operators return the same data type as their left-hand input (either <code>json</code> or <code>jsonb</code>), except for those specified as returning <code>text</code>, which coerce the value to <code>text</code>. The field, element, and path extraction operators return <code>NULL</code>, rather than failing, if the JSON input does not have the right structure to match the request; for example if no such element exists.</p>
</blockquote>
<p>Operators that require the <code>jsonb</code> data type as the left operand are described in the following table. Many of these operators can be indexed by <code>jsonb</code> operator classes. For a full description of <code>jsonb</code> containment and existence semantics, see <a href="#topic_isx_2tw_mq">jsonb Containment and Existence</a>. For information about how these operators can be used to effectively index <code>jsonb</code> data, see <a href="#topic_aqt_1tw_mq">jsonb Indexing</a>.</p>
<table class="table" id="topic_o5y_14w_2z__table_dcb_y3w_mq"><caption><span class="table--title-label">Table 3. </span><span class="title">jsonb Operators</span></caption><colgroup><col style="width:9.970089730807578%"><col style="width:19.3419740777667%"><col style="width:45.76271186440678%"><col style="width:24.925224327018945%"></colgroup><thead class="thead">
              <tr class="row">
                <th class="entry" id="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__1">Operator</th>
                <th class="entry" id="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__2">Right Operand Type</th>
                <th class="entry" id="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__3">Description</th>
                <th class="entry" id="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__4">Example</th>
              </tr>
            </thead><tbody class="tbody">
              <tr class="row">
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__1">
                  <code class="ph codeph">@&gt;</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__2">
                  <code class="ph codeph">jsonb</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__3">Does the left JSON value contain within it the right value?</td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__4">
                  <code class="ph codeph">'{"a":1, "b":2}'::jsonb @&gt; '{"b":2}'::jsonb</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__1">
                  <code class="ph codeph">&lt;@</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__2">
                  <code class="ph codeph">jsonb</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__3">Is the left JSON value contained within the right value?</td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__4">
                  <code class="ph codeph">'{"b":2}'::jsonb &lt;@ '{"a":1, "b":2}'::jsonb</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__1">
                  <code class="ph codeph">?</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__2">
                  <code class="ph codeph">text</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__3">Does the key/element string exist within the JSON value?</td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__4">
                  <code class="ph codeph">'{"a":1, "b":2}'::jsonb ? 'b'</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__1">
                  <code class="ph codeph">?|</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__2">
                  <code class="ph codeph">text[]</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__3">Do any of these key/element strings exist?</td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__4">
                  <code class="ph codeph">'{"a":1, "b":2, "c":3}'::jsonb ?| array['b', 'c']</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__1">
                  <code class="ph codeph">?&amp;</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__2">
                  <code class="ph codeph">text[]</code>
                </td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__3">Do all of these key/element strings exist?</td>
                <td class="entry" headers="topic_o5y_14w_2z__table_dcb_y3w_mq__entry__4">
                  <code class="ph codeph">'["a", "b"]'::jsonb ?&amp; array['a', 'b']</code>
                </td>
              </tr>
            </tbody></table>
<p>The standard comparison operators in the following table are available only for the <code>jsonb</code> data type, not for the <code>json</code> data type. They follow the ordering rules for B-tree operations described in <a href="#topic_aqt_1tw_mq">jsonb Indexing</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;</code></td><td>less than</td></tr>
<tr><td><code>&gt;</code></td><td>greater than</td></tr>
<tr><td><code>&lt;=</code></td><td>less than or equal to</td></tr>
<tr><td><code>&gt;=</code></td><td>greater than or equal to</td></tr>
<tr><td><code>=</code></td><td>equal</td></tr>
<tr><td><code>&lt;&gt;</code> or <code>!=</code></td><td>not equal</td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>Note</strong> The <code>!=</code> operator is converted to <code>&lt;&gt;</code> in the parser stage. It is not possible to implement <code>!=</code> and <code>&lt;&gt;</code> operators that do different things.</p>
</blockquote>
<h3 id="json-creation-functions"><a class="header" href="#json-creation-functions"><a id="topic_u4s_wnw_2z"></a>JSON Creation Functions</a></h3>
<p>This table describes the functions that create <code>json</code> data type values. (Currently, there are no equivalent functions for <code>jsonb</code>, but you can cast the result of one of these functions to <code>jsonb</code>.)</p>
<table class="table" id="topic_u4s_wnw_2z__table_sqb_y3w_mb"><caption><span class="table--title-label">Table 5. </span><span class="title">JSON Creation Functions </span></caption><colgroup><col><col><col><col></colgroup><thead class="thead">
              <tr class="row">
                <th class="entry" id="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">Function</th>
                <th class="entry" id="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Description</th>
                <th class="entry" id="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">Example</th>
                <th class="entry" id="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">Example Result</th>
              </tr>
            </thead><tbody class="tbody">
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">
                  <code class="ph codeph">to_json(anyelement)</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Returns the value as a JSON object. Arrays and composites are processed
                  recursively and are converted to arrays and objects. If the input contains a cast
                  from the type to <code class="ph codeph">json</code>, the cast function is used to perform the
                  conversion; otherwise, a JSON scalar value is produced. For any scalar type other
                  than a number, a Boolean, or a null value, the text representation will be used,
                  properly quoted and escaped so that it is a valid JSON string.</td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <code class="ph codeph">to_json('Fred said "Hi."'::text)</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">"Fred said \"Hi.\""</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">
                  <code class="ph codeph">array_to_json(anyarray [, pretty_bool])</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Returns the array as a JSON array. A multidimensional array becomes a JSON
                  array of arrays. <p class="p">Line feeds will be added between dimension-1 elements if
                      <code class="ph codeph">pretty_bool</code> is true.</p></td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <code class="ph codeph">array_to_json('{{1,5},{99,100}}'::int[])</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">[[1,5],[99,100]]</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">
                  <code class="ph codeph">row_to_json(record [, pretty_bool])</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Returns the row as a JSON object. <p class="p">Line feeds will be added between level-1
                    elements if <code class="ph codeph">pretty_bool</code> is true.</p></td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <code class="ph codeph">row_to_json(row(1,'foo'))</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">{"f1":1,"f2":"foo"}</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1"><code class="ph codeph">json_build_array(VARIADIC "any"</code>)</td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Builds a possibly-heterogeneously-typed JSON array out of a
                    <code class="ph codeph">VARIADIC</code> argument list.</td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <code class="ph codeph">json_build_array(1,2,'3',4,5)</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">[1, 2, "3", 4, 5]</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">
                  <code class="ph codeph">json_build_object(VARIADIC "any")</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Builds a JSON object out of a <code class="ph codeph">VARIADIC</code> argument list. The
                  argument list is taken in order and converted to a set of key/value pairs.</td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <code class="ph codeph">json_build_object('foo',1,'bar',2)</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">{"foo": 1, "bar": 2}</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">
                  <code class="ph codeph">json_object(text[])</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Builds a JSON object out of a text array. The array must be either a one or a
                  two dimensional array.<p class="p">The one dimensional array must have an even number of
                    elements. The elements are taken as key/value pairs. </p><p class="p">For a two
                    dimensional array, each inner array must have exactly two elements, which are
                    taken as a key/value pair.</p></td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <p class="p">
                    <code class="ph codeph">json_object('{a, 1, b, "def", c, 3.5}')</code>
                  </p>
                  <p class="p">
                    <code class="ph codeph">json_object('{{a, 1},{b, "def"},{c, 3.5}}')</code>
                  </p>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">{"a": "1", "b": "def", "c": "3.5"}</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__1">
                  <code class="ph codeph">json_object(keys text[], values text[])</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__2">Builds a JSON object out of a text array. This form of
                    <code class="ph codeph">json_object</code> takes keys and values pairwise from two separate
                  arrays. In all other respects it is identical to the one-argument form.</td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__3">
                  <code class="ph codeph">json_object('{a, b}', '{1,2}')</code>
                </td>
                <td class="entry" headers="topic_u4s_wnw_2z__table_sqb_y3w_mb__entry__4">
                  <code class="ph codeph">{"a": "1", "b": "2"}</code>
                </td>
              </tr>
            </tbody></table>
<blockquote>
<p><strong>Note</strong> <code>array_to_json</code> and <code>row_to_json</code> have the same behavior as <code>to_json</code> except for offering a pretty-printing option. The behavior described for <code>to_json</code> likewise applies to each individual value converted by the other JSON creation functions.</p>
</blockquote>
<blockquote>
<p><strong>Note</strong> The <a href="../../../ref_guide/modules/hstore.html">hstore module</a> contains functions that cast from <code>hstore</code> to <code>json</code>, so that <code>hstore</code> values converted via the JSON creation functions will be represented as JSON objects, not as primitive string values.</p>
</blockquote>
<h3 id="json-aggregate-functions"><a class="header" href="#json-aggregate-functions"><a id="topic_rvp_lk3_sfb"></a>JSON Aggregate Functions</a></h3>
<p>This table shows the functions aggregate records to an array of JSON objects and pairs of values to a JSON object</p>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Argument Types</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>json_agg(record)</code></td><td><code>record</code></td><td><code>json</code></td><td>Aggregates records as a JSON array of objects.</td></tr>
<tr><td><code>json_object_agg(name, value)</code></td><td><code>("any", "any")</code></td><td><code>json</code></td><td>Aggregates name/value pairs as a JSON object.</td></tr>
</tbody></table>
</div>
<h3 id="json-processing-functions"><a class="header" href="#json-processing-functions"><a id="topic_z5d_snw_2z"></a>JSON Processing Functions</a></h3>
<p>This table shows the functions that are available for processing <code>json</code> and <code>jsonb</code> values.</p>
<p>Many of these processing functions and operators convert Unicode escapes in JSON strings to the appropriate single character. This is a not an issue if the input data type is <code>jsonb</code>, because the conversion was already done. However, for <code>json</code> data type input, this might result in an error being thrown. See <a href="#topic_upc_tcs_fz">About JSON Data</a>.</p>
<table class="table" id="topic_z5d_snw_2z__table_wfc_y3w_mb"><caption><span class="table--title-label">Table 7. </span><span class="title">JSON Processing Functions</span></caption><colgroup><col style="width:20.224719101123597%"><col style="width:18.726591760299627%"><col style="width:18.913857677902623%"><col style="width:23.220973782771537%"><col style="width:18.913857677902623%"></colgroup><thead class="thead">
              <tr class="row">
                <th class="entry" id="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1">Function</th>
                <th class="entry" id="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2">Return Type</th>
                <th class="entry" id="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Description</th>
                <th class="entry" id="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4">Example</th>
                <th class="entry" id="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">Example Result</th>
              </tr>
            </thead><tbody class="tbody">
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1">
                  <code class="ph codeph">json_array_length(json)</code>
                  <p class="p">
                    <code class="ph codeph">jsonb_array_length(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">int</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Returns the number of elements in the outermost JSON array.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">json_array_length('[1,2,3,{"f1":1,"f2":[5,6]},4]')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <code class="ph codeph">5</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_each(json)</code>
                  <p class="p"><code class="ph codeph">jsonb_each(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">setof key text, value json</code>
                  <p class="p"><code class="ph codeph">setof key text, value jsonb</code>
                  </p>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Expands the outermost JSON object into a set of key/value pairs.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_each('{"a":"foo", "b":"bar"}')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> key | value
-----+-------
 a   | "foo"
 b   | "bar"
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_each_text(json)</code>
                  <p class="p"><code class="ph codeph">jsonb_each_text(jsonb)</code>
                  </p>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">setof key text, value text</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Expands the outermost JSON object into a set of key/value pairs. The returned
                  values will be of type <code class="ph codeph">text</code>.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_each_text('{"a":"foo", "b":"bar"}')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> key | value
-----+-------
 a   | foo
 b   | bar
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_extract_path(from_json json, VARIADIC path_elems
                    text[])</code>
                  <p class="p"><code class="ph codeph">jsonb_extract_path(from_json jsonb, VARIADIC path_elems
                      text[])</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2">
                  <p class="p"><code class="ph codeph">json</code>
                  </p>
                  <p class="p"><code class="ph codeph">jsonb</code>
                  </p>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Returns the JSON value pointed to by <code class="ph codeph">path_elems</code> (equivalent
                  to <code class="ph codeph">#&gt;</code> operator).</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">json_extract_path('{"f2":{"f3":1},"f4":{"f5":99,"f6":"foo"}}','f4')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <code class="ph codeph">{"f5":99,"f6":"foo"}</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_extract_path_text(from_json json, VARIADIC path_elems
                    text[])</code>
                  <p class="p"><code class="ph codeph">jsonb_extract_path_text(from_json jsonb, VARIADIC path_elems
                      text[])</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">text</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Returns the JSON value pointed to by <code class="ph codeph">path_elems</code> as text.
                  Equivalent to <code class="ph codeph">#&gt;&gt;</code> operator.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">json_extract_path_text('{"f2":{"f3":1},"f4":{"f5":99,"f6":"foo"}}','f4',
                    'f6')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <code class="ph codeph">foo</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_object_keys(json)</code>
                  <p class="p"><code class="ph codeph">jsonb_object_keys(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">setof text</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Returns set of keys in the outermost JSON object.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">json_object_keys('{"f1":"abc","f2":{"f3":"a", "f4":"b"}}')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> json_object_keys
------------------
 f1
 f2
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_populate_record(base anyelement, from_json
                      json)</code><p class="p"><code class="ph codeph">jsonb_populate_record(base anyelement, from_json
                      jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">anyelement</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Expands the object in <code class="ph codeph">from_json</code> to a row whose columns match
                  the record type defined by base. See <a class="xref" href="#tablenotes">Note 1</a>.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_populate_record(null::myrowtype,
                    '{"a":1,"b":2}')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> a | b
---+---
 1 | 2
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_populate_recordset(base anyelement, from_json json)</code>
                  <p class="p"><code class="ph codeph">jsonb_populate_recordset(base anyelement, from_json jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">setof anyelement</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Expands the outermost array of objects in <code class="ph codeph">from_json</code> to a set
                  of rows whose columns match the record type defined by base. See <a class="xref" href="#tablenotes">Note 1</a>.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_populate_recordset(null::myrowtype,
                    '[{"a":1,"b":2},{"a":3,"b":4}]')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> a | b
---+---
 1 | 2
 3 | 4
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_array_elements(json)</code>
                  <p class="p"><code class="ph codeph">jsonb_array_elements(jsonb</code>)</p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2">
                  <p class="p"><code class="ph codeph">setof json</code>
                  </p>
                  <p class="p"><code class="ph codeph">setof jsonb</code>
                  </p>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Expands a JSON array to a set of JSON values.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_array_elements('[1,true, [2,false]]')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre">   value
-----------
 1
 true
 [2,false]
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_array_elements_text(json)</code>
                  <p class="p"><code class="ph codeph">jsonb_array_elements_text(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">setof text</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Expands a JSON array to a set of <code class="ph codeph">text</code> values.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_array_elements_text('["foo", "bar"]')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre">   value
-----------
 foo
 bar
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_typeof(json)</code><p class="p"><code class="ph codeph">jsonb_typeof(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">text</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Returns the type of the outermost JSON value as a text string. Possible types
                  are <code class="ph codeph">object</code>, <code class="ph codeph">array</code>, <code class="ph codeph">string</code>,
                    <code class="ph codeph">number</code>, <code class="ph codeph">boolean</code>, and <code class="ph codeph">null</code>.
                  See <a class="xref" href="#tablenotes">Note
                  2</a>.</td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">json_typeof('-123.4')</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <code class="ph codeph">number</code>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_to_record(json)</code><p class="p"><code class="ph codeph">jsonb_to_record(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">record</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Builds an arbitrary record from a JSON object. See <a class="xref" href="#tablenotes">Note 1</a>. <p class="p">As with all
                    functions returning record, the caller must explicitly define the structure of
                    the record with an <code class="ph codeph">AS</code> clause.</p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from json_to_record('{"a":1,"b":[1,2,3],"c":"bar"}') as x(a
                    int, b text, d text)</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> a |    b    | d
---+---------+---
 1 | [1,2,3] |
</pre>
                </td>
              </tr>
              <tr class="row">
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__1"><code class="ph codeph">json_to_recordset(json)</code>
                  <p class="p"><code class="ph codeph">jsonb_to_recordset(jsonb)</code>
                  </p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__2"><code class="ph codeph">setof record</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__3">Builds an arbitrary set of records from a JSON array of objects See <a class="xref" href="#tablenotes">Note 1</a>. <p class="p">As with all
                    functions returning record, the caller must explicitly define the structure of
                    the record with an <code class="ph codeph">AS</code> clause.</p></td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__4"><code class="ph codeph">select * from
                    json_to_recordset('[{"a":1,"b":"foo"},{"a":"2","c":"bar"}]') as x(a int, b
                    text);</code>
                </td>
                <td class="entry" headers="topic_z5d_snw_2z__table_wfc_y3w_mb__entry__5">
                  <pre class="pre"> a |  b
---+-----
 1 | foo
 2 |
</pre>
                </td>
              </tr>
            </tbody></table>
<p><a id="tablenotes"></a></p>
<blockquote>
<p><strong>Note</strong> The examples for the functions <code>json_populate_record()</code>, <code>json_populate_recordset()</code>, <code>json_to_record()</code> and <code>json_to_recordset()</code> use constants. However, the typical use would be to reference a table in the <code>FROM</code> clause and use one of its <code>json</code> or <code>jsonb</code> columns as an argument to the function. The extracted key values can then be referenced in other parts of the query. For example the value can be referenced in <code>WHERE</code> clauses and target lists. Extracting multiple values in this way can improve performance over extracting them separately with per-key operators.</p>
</blockquote>
<blockquote>
<p>JSON keys are matched to identical column names in the target row type. JSON type coercion for these functions might not result in desired values for some types. JSON fields that do not appear in the target row type will be omitted from the output, and target columns that do not match any JSON field will be <code>NULL</code>.</p>
</blockquote>
<blockquote>
<p>The <code>json_typeof</code> function null return value of <code>null</code> should not be confused with a SQL <code>NULL</code>. While calling <code>json_typeof('null'::json)</code> will return <code>null</code>, calling <code>json_typeof(NULL::json)</code> will return a SQL <code>NULL</code>.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../admin_guide/query/topics/functions-operators.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../admin_guide/query/topics/xml-data.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../admin_guide/query/topics/functions-operators.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../admin_guide/query/topics/xml-data.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
