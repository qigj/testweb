<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Collecting Root Partition Statistics - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="collecting-root-partition-statistics"><a class="header" href="#collecting-root-partition-statistics">Collecting Root Partition Statistics</a></h1>
<p>For a partitioned table, GPORCA uses statistics of the table root partition to generate query plans. These statistics are used for determining the join order, for splitting and joining aggregate nodes, and for costing the query steps. In contrast, the Postgres Planner uses the statistics of each leaf partition.</p>
<p>If you run queries on partitioned tables, you should collect statistics on the root partition and periodically update those statistics to ensure that GPORCA can generate optimal query plans. If the root partition statistics are not up-to-date or do not exist, GPORCA still performs dynamic partition elimination for queries against the table. However, the query plan might not be optimal.</p>
<h2 id="running-analyze"><a class="header" href="#running-analyze"><a id="topic_w1y_srn_wbb"></a>Running ANALYZE</a></h2>
<p>By default, running the <code>ANALYZE</code> command on the root partition of a partitioned table samples the leaf partition data in the table, and stores the statistics for the root partition. <code>ANALYZE</code> collects statistics on the root and leaf partitions, including HyperLogLog (HLL) statistics on the leaf partitions. <code>ANALYZE ROOTPARTITION</code> collects statistics only on the root partition. The server configuration parameter <a href="../../../ref_guide/config_params/guc-list.html">optimizer_analyze_root_partition</a> controls whether the <code>ROOTPARTITION</code> keyword is required to collect root statistics for the root partition of a partitioned table. See the <a href="../../../ref_guide/sql_commands/ANALYZE.html">ANALYZE</a> command for information about collecting statistics on partitioned tables.</p>
<p>Keep in mind that <code>ANALYZE</code> always scans the entire table before updating the root partition statistics. If your table is very large, this operation can take a significant amount of time. <code>ANALYZE ROOTPARTITION</code> also uses an <code>ACCESS SHARE</code> lock that prevents certain operations, such as <code>TRUNCATE</code> and <code>VACUUM</code> operations, during runtime. For these reasons, you should schedule <code>ANALYZE</code> operations periodically, or when there are significant changes to leaf partition data.</p>
<p>Follow these best practices for running <code>ANALYZE</code> or <code>ANALYZE ROOTPARTITION</code> on partitioned tables in your system:</p>
<ul>
<li>Run <code>ANALYZE &lt;root_partition_table_name&gt;</code> on a new partitioned table after adding initial data. Run <code>ANALYZE &lt;leaf_partition_table_name&gt;</code> on a new leaf partition or a leaf partition where data has changed. By default, running the command on a leaf partition updates the root partition statistics if the other leaf partitions have statistics.</li>
<li>Update root partition statistics when you observe query performance regression in <code>EXPLAIN</code> plans against the table, or after significant changes to leaf partition data. For example, if you add a new leaf partition at some point after generating root partition statistics, consider running <code>ANALYZE</code> or <code>ANALYZE ROOTPARTITION</code> to update root partition statistics with the new tuples inserted from the new leaf partition.</li>
<li>For very large tables, run <code>ANALYZE</code> or <code>ANALYZE ROOTPARTITION</code> only weekly, or at some interval longer than daily.</li>
<li>Avoid running <code>ANALYZE</code> with no arguments, because doing so runs the command on all database tables including partitioned tables. With large databases, these global <code>ANALYZE</code> operations are difficult to monitor, and it can be difficult to predict the time needed for completion.</li>
<li>Consider running multiple <code>ANALYZE &lt;table_name&gt;</code> or <code>ANALYZE ROOTPARTITION &lt;table_name&gt;</code> operations in parallel to speed the operation of statistics collection, if your I/O throughput can support the load.</li>
<li>You can also use the SynxDB utility <code>analyzedb</code> to update table statistics. Using <code>analyzedb</code> ensures that tables that were previously analyzed are not re-analyzed if no modifications were made to the leaf partition.</li>
</ul>
<h2 id="gporca-and-leaf-partition-statistics"><a class="header" href="#gporca-and-leaf-partition-statistics"><a id="topic_h2x_hks_wbb"></a>GPORCA and Leaf Partition Statistics</a></h2>
<p>Although creating and maintaining root partition statistics is crucial for GPORCA query performance with partitioned tables, maintaining leaf partition statistics is also important. If GPORCA cannot generate a plan for a query against a partitioned table, then the Postgres Planner is used and leaf partition statistics are needed to produce the optimal plan for that query.</p>
<p>GPORCA itself also uses leaf partition statistics for any queries that access leaf partitions directly, instead of using the root partition with predicates to eliminate partitions. For example, if you know which partitions hold necessary tuples for a query, you can directly query the leaf partition table itself; in this case GPORCA uses the leaf partition statistics.</p>
<h2 id="deactivating-automatic-root-partition-statistics-collection"><a class="header" href="#deactivating-automatic-root-partition-statistics-collection"><a id="topic_r5d_hv1_kr"></a>Deactivating Automatic Root Partition Statistics Collection</a></h2>
<p>If you do not intend to run queries on partitioned tables with GPORCA (setting the server configuration parameter <a href="../../../ref_guide/config_params/guc-list.html">optimizer</a> to <code>off</code>), then you can deactivate the automatic collection of statistics on the root partition of the partitioned table. The server configuration parameter <a href="../../../ref_guide/config_params/guc-list.html">optimizer_analyze_root_partition</a> controls whether the <code>ROOTPARTITION</code> keyword is required to collect root statistics for the root partition of a partitioned table. The default setting for the parameter is <code>on</code>, the <code>ANALYZE</code> command can collect root partition statistics without the <code>ROOTPARTITION</code> keyword. You can deactivate automatic collection of root partition statistics by setting the parameter to <code>off</code>. When the value is <code>off</code>, you must run <code>ANALZYE ROOTPARTITION</code> to collect root partition statistics.</p>
<ol>
<li>
<p>Log into the SynxDB master host as <code>gpadmin</code>, the SynxDB administrator.</p>
</li>
<li>
<p>Set the values of the server configuration parameters. These SynxDB <code>gpconfig</code> utility commands sets the value of the parameters to <code>off</code>:</p>
<pre><code>$ gpconfig -c optimizer_analyze_root_partition -v off --masteronly
</code></pre>
</li>
<li>
<p>Restart SynxDB. This SynxDB <code>gpstop</code> utility command reloads the <code>postgresql.conf</code> files of the master and segments without shutting down SynxDB.</p>
<pre><code>gpstop -u
</code></pre>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../admin_guide/query/topics/query-piv-opt-enable.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../admin_guide/query/topics/query-piv-opt-notes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../admin_guide/query/topics/query-piv-opt-enable.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../admin_guide/query/topics/query-piv-opt-notes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
