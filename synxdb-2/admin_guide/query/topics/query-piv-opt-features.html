<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>GPORCA Features and Enhancements - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="gporca-features-and-enhancements"><a class="header" href="#gporca-features-and-enhancements">GPORCA Features and Enhancements</a></h1>
<p>GPORCA, the SynxDB next generation query optimizer, includes enhancements for specific types of queries and operations:</p>
<ul>
<li><a href="#topic_dwy_zml_gr">Queries Against Partitioned Tables</a></li>
<li><a href="#topic_vph_wml_gr">Queries that Contain Subqueries</a></li>
<li><a href="#topic_c3v_rml_gr">Queries that Contain Common Table Expressions</a></li>
<li><a href="#topic_plx_mml_gr">DML Operation Enhancements with GPORCA</a></li>
</ul>
<p>GPORCA also includes these optimization enhancements:</p>
<ul>
<li>Improved join ordering</li>
<li>Join-Aggregate reordering</li>
<li>Sort order optimization</li>
<li>Data skew estimates included in query optimization</li>
</ul>
<h2 id="queries-against-partitioned-tables"><a class="header" href="#queries-against-partitioned-tables"><a id="topic_dwy_zml_gr"></a>Queries Against Partitioned Tables</a></h2>
<p>GPORCA includes these enhancements for queries against partitioned tables:</p>
<ul>
<li>
<p>Partition elimination is improved.</p>
</li>
<li>
<p>Uniform multi-level partitioned tables are supported. For information about uniform multi-level partitioned tables, see <a href="query-piv-uniform-part-tbl.html">About Uniform Multi-level Partitioned Tables</a></p>
</li>
<li>
<p>Query plan can contain the Partition selector operator.</p>
</li>
<li>
<p>Partitions are not enumerated in EXPLAIN plans.</p>
<p>For queries that involve static partition selection where the partitioning key is compared to a constant, GPORCA lists the number of partitions to be scanned in the <code>EXPLAIN</code> output under the Partition Selector operator. This example Partition Selector operator shows the filter and number of partitions selected:</p>
<pre><code>Partition Selector for Part_Table (dynamic scan id: 1) 
       Filter: a &gt; 10
       Partitions selected:  1 (out of 3)
</code></pre>
<p>For queries that involve dynamic partition selection where the partitioning key is compared to a variable, the number of partitions that are scanned will be known only during query execution. The partitions selected are not shown in the <code>EXPLAIN</code> output.</p>
</li>
<li>
<p>Plan size is independent of number of partitions.</p>
</li>
<li>
<p>Out of memory errors caused by number of partitions are reduced.</p>
</li>
</ul>
<p>This example CREATE TABLE command creates a range partitioned table.</p>
<pre><code>CREATE TABLE sales(order_id int, item_id int, amount numeric(15,2), 
      date date, yr_qtr int)
   PARTITION BY RANGE (yr_qtr) (start (201501) INCLUSIVE end (201504) INCLUSIVE, 
   start (201601) INCLUSIVE end (201604) INCLUSIVE,
   start (201701) INCLUSIVE end (201704) INCLUSIVE,     
   start (201801) INCLUSIVE end (201804) INCLUSIVE,
   start (201901) INCLUSIVE end (201904) INCLUSIVE,
   start (202001) INCLUSIVE end (202004) INCLUSIVE);
</code></pre>
<p>GPORCA improves on these types of queries against partitioned tables:</p>
<ul>
<li>
<p>Full table scan. Partitions are not enumerated in plans.</p>
<pre><code>SELECT * FROM sales;
</code></pre>
</li>
<li>
<p>Query with a constant filter predicate. Partition elimination is performed.</p>
<pre><code>SELECT * FROM sales WHERE yr_qtr = 201501;
</code></pre>
</li>
<li>
<p>Range selection. Partition elimination is performed.</p>
<pre><code>SELECT * FROM sales WHERE yr_qtr BETWEEN 201601 AND 201704 ;
</code></pre>
</li>
<li>
<p>Joins involving partitioned tables. In this example, the partitioned dimension table <em>date_dim</em> is joined with fact table <em>catalog_sales</em>:</p>
<pre><code>SELECT * FROM catalog_sales
   WHERE date_id IN (SELECT id FROM date_dim WHERE month=12);
</code></pre>
</li>
</ul>
<h2 id="queries-that-contain-subqueries"><a class="header" href="#queries-that-contain-subqueries"><a id="topic_vph_wml_gr"></a>Queries that Contain Subqueries</a></h2>
<p>GPORCA handles subqueries more efficiently. A subquery is query that is nested inside an outer query block. In the following query, the SELECT in the WHERE clause is a subquery.</p>
<pre><code>SELECT * FROM part
  WHERE price &gt; (SELECT avg(price) FROM part);
</code></pre>
<p>GPORCA also handles queries that contain a correlated subquery (CSQ) more efficiently. A correlated subquery is a subquery that uses values from the outer query. In the following query, the <code>price</code> column is used in both the outer query and the subquery.</p>
<pre><code>SELECT * FROM part p1 WHERE price &gt; (SELECT avg(price) FROM part p2 WHERE p2.brand = p1.brand);
</code></pre>
<p>GPORCA generates more efficient plans for the following types of subqueries:</p>
<ul>
<li>
<p>CSQ in the SELECT list.</p>
<pre><code>SELECT *,
 (SELECT min(price) FROM part p2 WHERE p1.brand = p2.brand)
 AS foo
FROM part p1;
</code></pre>
</li>
<li>
<p>CSQ in disjunctive (OR) filters.</p>
<pre><code>SELECT FROM part p1 WHERE p_size &gt; 40 OR 
      p_retailprice &gt; 
      (SELECT avg(p_retailprice) 
          FROM part p2 
          WHERE p2.p_brand = p1.p_brand)
</code></pre>
</li>
<li>
<p>Nested CSQ with skip level correlations</p>
<pre><code>SELECT * FROM part p1 WHERE p1.p_partkey 
IN (SELECT p_partkey FROM part p2 WHERE p2.p_retailprice = 
     (SELECT min(p_retailprice)
       FROM part p3 
       WHERE p3.p_brand = p1.p_brand)
);
</code></pre>
<blockquote>
<p><strong>Note</strong> Nested CSQ with skip level correlations are not supported by the Postgres Planner.</p>
</blockquote>
</li>
<li>
<p>CSQ with aggregate and inequality. This example contains a CSQ with an inequality.</p>
<pre><code>SELECT * FROM part p1 WHERE p1.p_retailprice =
 (SELECT min(p_retailprice) FROM part p2 WHERE p2.p_brand &lt;&gt; p1.p_brand);
</code></pre>
</li>
<li>
<p>CSQ that must return one row.</p>
<pre><code>SELECT p_partkey, 
  (SELECT p_retailprice FROM part p2 WHERE p2.p_brand = p1.p_brand )
FROM part p1;
</code></pre>
</li>
</ul>
<h2 id="queries-that-contain-common-table-expressions"><a class="header" href="#queries-that-contain-common-table-expressions"><a id="topic_c3v_rml_gr"></a>Queries that Contain Common Table Expressions</a></h2>
<p>GPORCA handles queries that contain the WITH clause. The WITH clause, also known as a common table expression (CTE), generates temporary tables that exist only for the query. This example query contains a CTE.</p>
<pre><code>WITH v AS (SELECT a, sum(b) as s FROM T where c &lt; 10 GROUP BY a)
  SELECT *FROM  v AS v1 ,  v AS v2
  WHERE v1.a &lt;&gt; v2.a AND v1.s &lt; v2.s;
</code></pre>
<p>As part of query optimization, GPORCA can push down predicates into a CTE. For example query, GPORCA pushes the equality predicates to the CTE.</p>
<pre><code>WITH v AS (SELECT a, sum(b) as s FROM T GROUP BY a)
  SELECT *
  FROM v as v1, v as v2, v as v3
  WHERE v1.a &lt; v2.a
    AND v1.s &lt; v3.s
    AND v1.a = 10
    AND v2.a = 20
    AND v3.a = 30;
</code></pre>
<p>GPORCA can handle these types of CTEs:</p>
<ul>
<li>
<p>CTE that defines one or multiple tables. In this query, the CTE defines two tables.</p>
<pre><code>WITH cte1 AS (SELECT a, sum(b) as s FROM T 
               where c &lt; 10 GROUP BY a),
      cte2 AS (SELECT a, s FROM cte1 where s &gt; 1000)
  SELECT *
  FROM cte1 as v1, cte2 as v2, cte2 as v3
  WHERE v1.a &lt; v2.a AND v1.s &lt; v3.s;
</code></pre>
</li>
<li>
<p>Nested CTEs.</p>
<pre><code>WITH v AS (WITH w AS (SELECT a, b FROM foo 
                      WHERE b &lt; 5) 
           SELECT w1.a, w2.b 
           FROM w AS w1, w AS w2 
           WHERE w1.a = w2.a AND w1.a &gt; 2)
  SELECT v1.a, v2.a, v2.b
  FROM v as v1, v as v2
  WHERE v1.a &lt; v2.a; 
</code></pre>
</li>
</ul>
<h2 id="dml-operation-enhancements-with-gporca"><a class="header" href="#dml-operation-enhancements-with-gporca"><a id="topic_plx_mml_gr"></a>DML Operation Enhancements with GPORCA</a></h2>
<p>GPORCA contains enhancements for DML operations such as INSERT, UPDATE, and DELETE.</p>
<ul>
<li>
<p>A DML node in a query plan is a query plan operator.</p>
<ul>
<li>Can appear anywhere in the plan, as a regular node (top slice only for now)</li>
<li>Can have consumers</li>
</ul>
</li>
<li>
<p>UPDATE operations use the query plan operator Split and supports these operations:</p>
<ul>
<li>UPDATE operations on the table distribution key columns.</li>
<li>UPDATE operations on the table on the partition key column.
This example plan shows the Split operator.</li>
</ul>
<pre><code>QUERY PLAN
--------------------------------------------------------------
Update  (cost=0.00..5.46 rows=1 width=1)
   -&gt;  Redistribute Motion 2:2  (slice1; segments: 2)
         Hash Key: a
         -&gt;  Result  (cost=0.00..3.23 rows=1 width=48)
               -&gt;  Split  (cost=0.00..2.13 rows=1 width=40)
                     -&gt;  Result  (cost=0.00..1.05 rows=1 width=40)
                           -&gt;  Seq Scan on dmltest
</code></pre>
</li>
<li>
<p>New query plan operator Assert is used for constraints checking.</p>
<p>This example plan shows the Assert operator.</p>
<pre><code>QUERY PLAN
------------------------------------------------------------
 Insert  (cost=0.00..4.61 rows=3 width=8)
   -&gt;  Assert  (cost=0.00..3.37 rows=3 width=24)
         Assert Cond: (dmlsource.a &gt; 2) IS DISTINCT FROM 
false
         -&gt;  Assert  (cost=0.00..2.25 rows=3 width=24)
               Assert Cond: NOT dmlsource.b IS NULL
               -&gt;  Result  (cost=0.00..1.14 rows=3 width=24)
                     -&gt;  Seq Scan on dmlsource
</code></pre>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../admin_guide/query/topics/query-piv-opt-notes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../admin_guide/query/topics/query-piv-opt-changed.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../admin_guide/query/topics/query-piv-opt-notes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../admin_guide/query/topics/query-piv-opt-changed.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
