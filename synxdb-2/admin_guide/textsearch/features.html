<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Additional Text Search Features - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="additional-text-search-features"><a class="header" href="#additional-text-search-features">Additional Text Search Features</a></h1>
<p>SynxDB has additional functions and operators you can use to manipulate search and query vectors, and to rewrite search queries.</p>
<p>This section contains the following subtopics:</p>
<ul>
<li><a href="#manipulating-documents">Manipulating Documents</a></li>
<li><a href="#manipulate_queries">Manipulating Queries</a></li>
<li><a href="#rewriting">Rewriting Queries</a></li>
<li><a href="#statistics">Gathering Document Statistics</a></li>
</ul>
<h2 id="manipulating-documents"><a class="header" href="#manipulating-documents"><a id="manipulating-documents"></a>Manipulating Documents</a></h2>
<p><a href="controlling.html#parsing-documents">Parsing Documents</a> showed how raw textual documents can be converted into <code>tsvector</code> values. SynxDB also provides functions and operators that can be used to manipulate documents that are already in <code>tsvector</code> form.</p>
<p><code>tsvector || tsvector</code>
:   The <code>tsvector</code> concatenation operator returns a vector which combines the lexemes and positional information of the two vectors given as arguments. Positions and weight labels are retained during the concatenation. Positions appearing in the right-hand vector are offset by the largest position mentioned in the left-hand vector, so that the result is nearly equivalent to the result of performing <code>to_tsvector</code> on the concatenation of the two original document strings. (The equivalence is not exact, because any stop-words removed from the end of the left-hand argument will not affect the result, whereas they would have affected the positions of the lexemes in the right-hand argument if textual concatenation were used.)</p>
<p>One advantage of using concatenation in the vector form, rather than concatenating text before applying <code>to_tsvector</code>, is that you can use different configurations to parse different sections of the document. Also, because the <code>setweight</code> function marks all lexemes of the given vector the same way, it is necessary to parse the text and do <code>setweight</code> before concatenating if you want to label different parts of the document with different weights.</p>
<p><code>setweight(&lt;vector&gt; tsvector, &lt;weight&gt; "char") returns tsvector</code>
:   <code>setweight</code> returns a copy of the input vector in which every position has been labeled with the given <code>&lt;weight&gt;</code>, either <code>A</code>, <code>B</code>, <code>C</code>, or <code>D</code>. (<code>D</code> is the default for new vectors and as such is not displayed on output.) These labels are retained when vectors are concatenated, allowing words from different parts of a document to be weighted differently by ranking functions.</p>
<p>Note that weight labels apply to <strong>positions</strong>, not <strong>lexemes</strong>. If the input vector has been stripped of positions then <code>setweight</code> does nothing.</p>
<p><code>length(&lt;vector&gt; tsvector) returns integer</code>
:   Returns the number of lexemes stored in the vector.</p>
<p><code>strip(vector tsvector) returns tsvector</code>
:   Returns a vector which lists the same lexemes as the given vector, but which lacks any position or weight information. While the returned vector is much less useful than an unstripped vector for relevance ranking, it will usually be much smaller.</p>
<h2 id="manipulating-queries"><a class="header" href="#manipulating-queries"><a id="manipulate_queries"></a>Manipulating Queries</a></h2>
<p><a href="controlling.html#parsing-queries">Parsing Queries</a> showed how raw textual queries can be converted into <code>tsquery</code> values. SynxDB also provides functions and operators that can be used to manipulate queries that are already in <code>tsquery</code> form.</p>
<p><code>tsquery &amp;&amp; tsquery</code>
:   Returns the AND-combination of the two given queries.</p>
<p><code>tsquery || tsquery</code>
:   Returns the OR-combination of the two given queries.</p>
<p><code>!! tsquery</code>
:   Returns the negation (NOT) of the given query.</p>
<p><code>numnode(&lt;query&gt; tsquery) returns integer</code>
:   Returns the number of nodes (lexemes plus operators) in a tsquery. This function is useful to determine if the <strong>query</strong> is meaningful (returns &gt; 0), or contains only stop words (returns 0). Examples:</p>
<pre><code>SELECT numnode(plainto_tsquery('the any'));
NOTICE:  query contains only stopword(s) or doesn't contain lexeme(s), ignored
 numnode
---------
       0

SELECT numnode('foo &amp; bar'::tsquery);
 numnode
---------
       3
</code></pre>
<p><code>querytree(&lt;query&gt; tsquery) returns text</code>
:   Returns the portion of a tsquery that can be used for searching an index. This function is useful for detecting unindexable queries, for example those containing only stop words or only negated terms. For example:</p>
<pre><code>SELECT querytree(to_tsquery('!defined'));
 querytree
-----------

</code></pre>
<h2 id="rewriting-queries"><a class="header" href="#rewriting-queries"><a id="rewriting"></a>Rewriting Queries</a></h2>
<p>The <code>ts_rewrite</code> family of functions search a given <code>tsquery</code> for occurrences of a target subquery, and replace each occurrence with a substitute subquery. In essence this operation is a <code>tsquery</code>-specific version of substring replacement. A target and substitute combination can be thought of as a <em>query rewrite rule</em>. A collection of such rewrite rules can be a powerful search aid. For example, you can expand the search using synonyms (e.g., <code>new york</code>, <code>big apple</code>, <code>nyc</code>, <code>gotham</code>) or narrow the search to direct the user to some hot topic. There is some overlap in functionality between this feature and thesaurus dictionaries (<a href="dictionaries.html#thesaurus-dictionary">Thesaurus Dictionary</a>). However, you can modify a set of rewrite rules on-the-fly without reindexing, whereas updating a thesaurus requires reindexing to be effective.</p>
<p><code>ts_rewrite(&lt;query&gt; tsquery, &lt;target&gt; tsquery, &lt;substitute&gt; tsquery) returns tsquery</code>
:   This form of <code>ts_rewrite</code> simply applies a single rewrite rule: <code>&lt;target&gt;</code> is replaced by <code>&lt;substitute&gt;</code> wherever it appears in <code>&lt;query&gt;</code>. For example:</p>
<pre><code>SELECT ts_rewrite('a &amp; b'::tsquery, 'a'::tsquery, 'c'::tsquery);
 ts_rewrite
------------
 'b' &amp; 'c'
</code></pre>
<p><code>ts_rewrite(&lt;query&gt; tsquery, &lt;select&gt; text) returns tsquery</code>
:   This form of <code>ts_rewrite</code> accepts a starting <code>&lt;query&gt;</code> and a SQL <code>&lt;select&gt;</code> command, which is given as a text string. The <code>&lt;select&gt;</code> must yield two columns of <code>tsquery</code> type. For each row of the <code>&lt;select&gt;</code> result, occurrences of the first column value (the target) are replaced by the second column value (the substitute) within the current <code>&lt;query&gt;</code> value. For example:</p>
<pre><code>CREATE TABLE aliases (id int, t tsquery, s tsquery);
INSERT INTO aliases VALUES(1, 'a', 'c');

SELECT ts_rewrite('a &amp; b'::tsquery, 'SELECT t,s FROM aliases');
 ts_rewrite
------------
 'b' &amp; 'c'
</code></pre>
<p>Note that when multiple rewrite rules are applied in this way, the order of application can be important; so in practice you will want the source query to <code>ORDER BY</code> some ordering key.</p>
<p>Let’s consider a real-life astronomical example. We’ll expand query <code>supernovae</code> using table-driven rewriting rules:</p>
<pre><code>CREATE TABLE aliases (id int, t tsquery primary key, s tsquery);
INSERT INTO aliases VALUES(1, to_tsquery('supernovae'), to_tsquery('supernovae|sn'));

SELECT ts_rewrite(to_tsquery('supernovae &amp; crab'), 'SELECT t, s FROM aliases');
           ts_rewrite            
---------------------------------
 'crab' &amp; ( 'supernova' | 'sn' )
</code></pre>
<p>We can change the rewriting rules just by updating the table:</p>
<pre><code>UPDATE aliases
SET s = to_tsquery('supernovae|sn &amp; !nebulae')
WHERE t = to_tsquery('supernovae');

SELECT ts_rewrite(to_tsquery('supernovae &amp; crab'), 'SELECT t, s FROM aliases');
                 ts_rewrite                  
---------------------------------------------
 'crab' &amp; ( 'supernova' | 'sn' &amp; !'nebula' )
</code></pre>
<p>Rewriting can be slow when there are many rewriting rules, since it checks every rule for a possible match. To filter out obvious non-candidate rules we can use the containment operators for the <code>tsquery</code> type. In the example below, we select only those rules which might match the original query:</p>
<pre><code>SELECT ts_rewrite('a &amp; b'::tsquery,
                  'SELECT t,s FROM aliases WHERE ''a &amp; b''::tsquery @&gt; t');
 ts_rewrite
------------
 'b' &amp; 'c'
</code></pre>
<h2 id="gathering-document-statistics"><a class="header" href="#gathering-document-statistics"><a id="statistics"></a>Gathering Document Statistics</a></h2>
<p>The function <code>ts_stat</code> is useful for checking your configuration and for finding stop-word candidates.</p>
<pre><code>ts_stat(&lt;sqlquery&gt; text, [ &lt;weights&gt; text, ]
        OUT &lt;word&gt; text, OUT &lt;ndoc&gt; integer,
        OUT &lt;nentry&gt; integer) returns setof record
</code></pre>
<p><code>&lt;sqlquery&gt;</code> is a text value containing an SQL query which must return a single <code>tsvector</code> column. <code>ts_stat</code> runs the query and returns statistics about each distinct lexeme (word) contained in the <code>tsvector</code> data. The columns returned are</p>
<ul>
<li><code>&lt;word&gt; text</code> — the value of a lexeme</li>
<li><code>&lt;ndoc&gt; integer</code> — number of documents (<code>tsvector</code>s) the word occurred in</li>
<li><code>&lt;nentry&gt; integer</code> — total number of occurrences of the word</li>
</ul>
<p>If weights is supplied, only occurrences having one of those weights are counted.</p>
<p>For example, to find the ten most frequent words in a document collection:</p>
<pre><code>SELECT * FROM ts_stat('SELECT vector FROM apod')
ORDER BY nentry DESC, ndoc DESC, word
LIMIT 10;
</code></pre>
<p>The same, but counting only word occurrences with weight <code>A</code> or <code>B</code>:</p>
<pre><code>SELECT * FROM ts_stat('SELECT vector FROM apod', 'ab')
ORDER BY nentry DESC, ndoc DESC, word
LIMIT 10;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../admin_guide/textsearch/controlling.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../admin_guide/textsearch/parsers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../admin_guide/textsearch/controlling.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../admin_guide/textsearch/parsers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
