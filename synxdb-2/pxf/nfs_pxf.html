<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Accessing Files on a Network File System - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="accessing-files-on-a-network-file-system"><a class="header" href="#accessing-files-on-a-network-file-system">Accessing Files on a Network File System</a></h1>
<p>You can use PXF to read data that resides on a network file system mounted on your SynxDB hosts. PXF supports reading and writing the following file types from a network file system:</p>
<div class="table-wrapper"><table><thead><tr><th>File Type</th><th>Profile Name</th><th>Operations Supported</th></tr></thead><tbody>
<tr><td>delimited single line text</td><td>file:text</td><td>read, write</td></tr>
<tr><td>delimited single line comma-separated values of text</td><td>file:csv</td><td>read, write</td></tr>
<tr><td>delimited text with quoted linefeeds</td><td>file:text:multi</td><td>read</td></tr>
<tr><td>fixed width single line text</td><td>file:fixedwidth</td><td>read, write</td></tr>
<tr><td>Avro</td><td>file:avro</td><td>read, write</td></tr>
<tr><td>JSON</td><td>file:json</td><td>read, write</td></tr>
<tr><td>ORC</td><td>file:orc</td><td>read, write</td></tr>
<tr><td>Parquet</td><td>file:parquet</td><td>read, write</td></tr>
</tbody></table>
</div>
<p>PXF does not support user impersonation when you access a network file system. PXF accesses a file as the operating system user that started the PXF process, usually <code>gpadmin</code>.</p>
<div class="note"><b>Note:</b> Reading from, and writing to (where supported), a file of these types on a network file system is similar to reading/writing the file type on Hadoop.</div>
<h2 id="prerequisites"><a class="header" href="#prerequisites"><a id="prereq"></a>Prerequisites</a></h2>
<p>Before you use PXF to access files on a network file system, ensure that:</p>
<ul>
<li>You can identify the PXF runtime configuration directory (<code>$PXF_BASE</code>).</li>
<li>You have configured PXF, and PXF is running on each SynxDB host. See <a href="instcfg_pxf.html">Configuring PXF</a> for additional information.</li>
<li>All files are accessible by <code>gpadmin</code> or by the operating system user that started the PXF process.</li>
<li>The network file system is correctly mounted at the same local mount point on every SynxDB host.</li>
<li>You can identify the mount or share point of the network file system.</li>
<li>You have created one or more named PXF server configurations as described in <a href="#ex_fscfg">Configuring a PXF Network File System Server</a>.</li>
</ul>
<h2 id="configuring-a-pxf-network-file-system-server"><a class="header" href="#configuring-a-pxf-network-file-system-server"><a id="ex_fscfg"></a>Configuring a PXF Network File System Server</a></h2>
<p>Before you use PXF to access a file on a network file system, you must create a server configuration and then synchronize the PXF configuration to all SynxDB hosts.  This procedure will typically be performed by the SynxDB administrator.</p>
<p>Use the server template configuration file <code>&lt;PXF_INSTALL_DIR&gt;/templates/pxf-site.xml</code> when you configure a network file system server for PXF. This template file includes the mandatory property <code>pxf.fs.basePath</code> that you configure to identify the network file system share path. PXF considers the file path that you specify in a <code>CREATE EXTERNAL TABLE</code> <code>LOCATION</code> clause that uses this server to be relative to this share path.</p>
<p>PXF does not support user impersonation when you access a network file system; you must explicitly turn off user impersonation in a network file system server configuration.</p>
<ol>
<li>
<p>Log in to the SynxDB coordinator host:</p>
<pre><code class="language-shell">$ ssh gpadmin@&lt;coordinator&gt;
</code></pre>
</li>
<li>
<p>Choose a name for the file system server. You will provide the name to SynxDB users that you choose to allow to read from or write to files on the network file system.</p>
<p><strong>Note</strong>: The server name <code>default</code> is reserved.</p>
</li>
<li>
<p>Create the <code>$PXF_BASE/servers/&lt;server_name&gt;</code> directory. For example, use the following command to create a file system server configuration named <code>nfssrvcfg</code>:</p>
<pre><code class="language-shell">gpadmin@coordinator$ mkdir $PXF_BASE/servers/nfssrvcfg
</code></pre>
</li>
<li>
<p>Copy the PXF <code>pxf-site.xml</code> template file to the <code>nfssrvcfg</code> server configuration directory. For example:</p>
<pre><code class="language-shell">gpadmin@coordinator$ cp &lt;PXF_INSTALL_DIR&gt;/templates/pxf-site.xml $PXF_BASE/servers/nfssrvcfg/
</code></pre>
</li>
<li>
<p>Open the template server configuration file in the editor of your choice, and uncomment and provide property values appropriate for your environment. For example, if the file system share point is the directory named <code>/mnt/extdata/pxffs</code>, uncomment and set these server properties:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;
...
    &lt;property&gt;
        &lt;name&gt;pxf.service.user.impersonation&lt;/name&gt;
        &lt;value&gt;false&lt;/value&gt;
    &lt;/property&gt;

    &lt;property&gt;
        &lt;name&gt;pxf.fs.basePath&lt;/name&gt;
        &lt;value&gt;/mnt/extdata/pxffs&lt;/value&gt;
    &lt;/property&gt;
...
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>Save your changes and exit the editor.</p>
</li>
<li>
<p>Synchronize the PXF server configuration to the SynxDB cluster:</p>
<pre><code class="language-shell">gpadmin@coordinator$ pxf cluster sync
</code></pre>
</li>
</ol>
<h2 id="creating-the-external-table"><a class="header" href="#creating-the-external-table"><a id="queryextdata"></a>Creating the External Table</a></h2>
<p>The following syntax creates a SynxDB external table that references a file on a network file system. Use the appropriate <code>file:*</code> profile for the file type that you want to access.</p>
<pre>
CREATE [READABLE | WRITABLE] EXTERNAL TABLE &lt;table_name>
    ( &lt;column_name> &lt;data_type> [, ...] | LIKE &lt;other_table> )
LOCATION ('pxf://&lt;file-path>?PROFILE=file:&lt;file-type>[&SERVER=&lt;server_name>][&&lt;custom-option>=&lt;value>[...]]')
FORMAT '[TEXT|CSV|CUSTOM]' (&lt;formatting-properties>);
</pre>
<p>The specific keywords and values used in the SynxDB <a href="../ref_guide/sql_commands/CREATE_EXTERNAL_TABLE.html">CREATE EXTERNAL TABLE</a> command are described in the table below.</p>
<div class="table-wrapper"><table><thead><tr><th>Keyword</th><th>Value</th></tr></thead><tbody>
<tr><td>&lt;file‑path&gt;</td><td>The path to a directory or file on the network file system. PXF considers this file or path as being relative to the <a href="cfg_server.html#pxf-fs-basepath"><code>pxf.fs.basePath</code></a> property value specified in &lt;server_name&gt;’s server configuration.  &lt;file‑path&gt; must not specify a relative path nor include the dollar sign (<code>$</code>) character.</td></tr>
<tr><td>PROFILE</td><td>The <code>PROFILE</code> keyword value must specify a <code>file:&lt;file-type&gt;</code> identified in the table above.</td></tr>
<tr><td>SERVER=&lt;server_name&gt;</td><td>The named server configuration that PXF uses to access the network file system. PXF uses the <code>default</code> server if not specified.</td></tr>
<tr><td>&lt;custom‑option&gt;=&lt;value&gt;</td><td>&lt;custom-option&gt; is profile-specific.</td></tr>
<tr><td>FORMAT &lt;value&gt;</td><td>PXF profiles support the <code>TEXT</code>, <code>CSV</code>, and <code>CUSTOM</code> formats.</td></tr>
<tr><td>&lt;formatting‑properties&gt;</td><td>Formatting properties supported by the profile; for example, the <code>FORMATTER</code> or <code>delimiter</code>.</td></tr>
</tbody></table>
</div><div class="note"><b>Note:</b> The &lt;custom-option>s, FORMAT, and &lt;formatting&#8209;properties> that you specify when accessing a file on a network file system are dependent on the &lt;file-type>. Refer to the <a href="access_hdfs.html#hadoop_connectors">Hadoop documentation</a> for the &lt;file-type> of interest for these settings.</div>
<h2 id="example-reading-from-and-writing-to-a-csv-file-on-a-network-file-system"><a class="header" href="#example-reading-from-and-writing-to-a-csv-file-on-a-network-file-system"><a id="example_nfscsv"></a>Example: Reading From and Writing to a CSV File on a Network File System</a></h2>
<p>This example assumes that you have configured and mounted a network file system with the share point <code>/mnt/extdata/pxffs</code> on the SynxDB coordinator host, the standby coordinator host, and on each segment host.</p>
<p>In this example, you:</p>
<ul>
<li>Create a CSV file on the network file system and add data to the file.</li>
<li>Configure a network file system server for the share point.</li>
<li>Create a PXF readable external table that references the directory containing the CSV file, and read the data.</li>
<li>Create a PXF writable external table that references the directory containing the CSV file, and write some data.</li>
<li>Read from the original readable external table again.</li>
</ul>
<h3 id="create-a-csv-file"><a class="header" href="#create-a-csv-file"><a id="ex_create_csvfile"></a>Create a CSV File</a></h3>
<ol>
<li>
<p>Create a directory (relative to the network file system share point) named <code>/mnt/extdata/pxffs/ex1</code>:</p>
<pre><code class="language-shell">gpadmin@coordinator$ mkdir -p /mnt/extdata/pxffs/ex1
</code></pre>
</li>
<li>
<p>Create a CSV file named <code>somedata.csv</code> in the directory:</p>
<pre><code class="language-shell">$ echo 'Prague,Jan,101,4875.33
Rome,Mar,87,1557.39
Bangalore,May,317,8936.99
Beijing,Jul,411,11600.67' &gt; /mnt/extdata/pxffs/ex1/somedata.csv
</code></pre>
</li>
</ol>
<h3 id="create-the-network-file-system-server"><a class="header" href="#create-the-network-file-system-server"><a id="ex_create_server"></a>Create the Network File System Server</a></h3>
<p>Create a server configuration named <code>nfssrvcfg</code> with share point <code>/mnt/extdata/pxffs</code> as described in <a href="#ex_fscfg">Configuring a PXF Network File System Server</a>.</p>
<h3 id="read-data"><a class="header" href="#read-data"><a id="ex_read"></a>Read Data</a></h3>
<p>Perform the following procedure to create a PXF external table that references the <code>ex1</code> directory that you created in a previous section, and then read the data in the <code>somedata.csv</code> file in that directory:</p>
<ol>
<li>
<p>Create a PXF external table that references <code>ex1</code> and that specifies the <code>file:text</code> profile. For example:</p>
<pre><code class="language-sql">gpadmin=# CREATE EXTERNAL TABLE pxf_read_nfs(location text, month text, num_orders int, total_sales float8)
            LOCATION ('pxf://ex1/?PROFILE=file:text&amp;SERVER=nfssrvcfg')
            FORMAT 'CSV';
</code></pre>
<p>Because the <code>nfssrvcfg</code> server configuration <code>pxf.fs.basePath</code> property value is <code>/mnt/exdata/pxffs</code>, PXF constructs the path <code>/mnt/extdata/pxffs/ex1</code> to read the file.</p>
</li>
<li>
<p>Display all rows of the <code>pxf_read_nfs</code> table:</p>
<pre><code class="language-sql">gpadmin=# SELECT * FROM pxf_read_nfs ORDER BY num_orders DESC;
 location  | month | num_orders | total_sales 
-----------+-------+------------+-------------
 Beijing   | Jul   |        411 |    11600.67
 Bangalore | May   |        317 |     8936.99
 Prague    | Jan   |        101 |     4875.33
 Rome      | Mar   |         87 |     1557.39
(4 rows)
</code></pre>
</li>
</ol>
<h3 id="write-data-and-read-again"><a class="header" href="#write-data-and-read-again"><a id="ex_write"></a>Write Data and Read Again</a></h3>
<p>Perform the following procedure to insert some data into the <code>ex1</code> directory and then read the data again. You must create a new external table for the write operation.</p>
<ol>
<li>
<p>Create a writable PXF external table that references <code>ex1</code> and that specifies the <code>file:text</code> profile. For example:</p>
<pre><code class="language-sql">gpadmin=# CREATE WRITABLE EXTERNAL TABLE pxf_write_nfs(location text, month text, num_orders int, total_sales float8)
            LOCATION ('pxf://ex1/?PROFILE=file:text&amp;SERVER=nfssrvcfg')
          FORMAT 'CSV' (delimiter=',');
</code></pre>
</li>
<li>
<p>Insert some data into the <code>pxf_write_nfs</code> table. For example:</p>
<pre><code class="language-sql">gpadmin=# INSERT INTO pxf_write_nfs VALUES ( 'Frankfurt', 'Mar', 777, 3956.98 );
INSERT 0 1
gpadmin=# INSERT INTO pxf_write_nfs VALUES ( 'Cleveland', 'Oct', 3812, 96645.37 );
INSERT 0 1
</code></pre>
<p>PXF writes one or more files to the <code>ex1/</code> directory when you insert into the <code>pxf_write_nfs</code> table.</p>
</li>
<li>
<p>Use the <code>pxf_read_nfs</code> readable external table that you created in the previous section to view the new data you inserted into the <code>pxf_write_nfs</code> table:</p>
<pre><code class="language-sql">gpadmin=# SELECT * FROM pxf_read_nfs ORDER BY num_orders DESC;
 location  | month | num_orders | total_sales 
-----------+-------+------------+-------------
 Cleveland | Oct   |       3812 |    96645.37
 Frankfurt | Mar   |        777 |     3956.98
 Beijing   | Jul   |        411 |    11600.67
 Bangalore | May   |        317 |     8936.99
 Prague    | Jan   |        101 |     4875.33
 Rome      | Mar   |         87 |     1557.39
(6 rows)
</code></pre>
<p>When you select from the <code>pxf_read_nfs</code> table here, PXF reads the <code>somedata.csv</code> file and the new files that it added to the <code>ex1/</code> directory in the previous step.</p>
</li>
</ol>
<h2 id="about-specifying-a-parquet-schema-file-location"><a class="header" href="#about-specifying-a-parquet-schema-file-location"><a id="about_schema"></a>About Specifying a Parquet Schema File Location</a></h2>
<p>If you use the <code>file:parquet</code> profile to write to an external table that references a Parquet file and you want to provide the Parquet schema, specify the <code>SCHEMA</code> custom option in the <code>LOCATION</code> clause when you create the writable external table. Refer to the <a href="hdfs_parquet.html#profile_cet">Creating the External Table</a> discussion in the PXF HDFS Parquet documentation for more information on the options available when you create an external table.</p>
<p>You must set <code>SCHEMA</code> to the location of the Parquet schema file on the file system of the specified <code>SERVER=&lt;server_name&gt;</code>. When the <code>&lt;server_name&gt;</code> configuration includes a <a href="cfg_server.html#pxf-fs-basepath"><code>pxf.fs.basePath</code></a> property setting, PXF considers the schema file that you specify to be relative to the mount point specified.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pxf/jdbc_pxf_named.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pxf/troubleshooting_pxf.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pxf/jdbc_pxf_named.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pxf/troubleshooting_pxf.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
