<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>gpcheckcat - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="gpcheckcat"><a class="header" href="#gpcheckcat">gpcheckcat</a></h1>
<p>The <code>gpcheckcat</code> utility tests SynxDB catalog tables for inconsistencies.</p>
<p>The utility is in <code>$GPHOME/bin/lib</code>.</p>
<h2 id="synopsis"><a class="header" href="#synopsis"><a id="section2"></a>Synopsis</a></h2>
<pre><code>gpcheckcat [ &lt;options&lt;] [ &lt;dbname&gt;] 

  Options:
     -g &lt;dir&gt;
     -p &lt;port&gt;
     -s &lt;test_name | 'test_name1, test_name2 [, ...]'&gt;  
     -P &lt;password&gt;
     -U &lt;user_name&gt;
     -S {none | only}
     -O
     -R &lt;test_name | 'test_name1, test_name2 [, ...]'&gt;
     -C &lt;catalog_name&gt;
     -B &lt;parallel_processes&gt;
     -v
     -A
     -x "&lt;parameter_name&gt;=&lt;value&gt;"

gpcheckcat  -l 

gpcheckcat -? | --help 

</code></pre>
<h2 id="description"><a class="header" href="#description"><a id="section3"></a>Description</a></h2>
<p>The <code>gpcheckcat</code> utility runs multiple tests that check for database catalog inconsistencies. Some of the tests cannot be run concurrently with other workload statements or the results will not be usable. Restart the database in restricted mode when running <code>gpcheckcat</code>, otherwise <code>gpcheckcat</code> might report inconsistencies due to ongoing database operations rather than the actual number of inconsistencies. If you run <code>gpcheckcat</code> without stopping database activity, run it with <code>-O</code> option.</p>
<blockquote>
<p><strong>Note</strong> Any time you run the utility, it checks for and deletes orphaned, temporary database schemas (temporary schemas without a session ID) in the specified databases. The utility displays the results of the orphaned, temporary schema check on the command line and also logs the results.</p>
</blockquote>
<p>Catalog inconsistencies are inconsistencies that occur between SynxDB system tables. In general, there are three types of inconsistencies:</p>
<ul>
<li>
<p>Inconsistencies in system tables at the segment level. For example, an inconsistency between a system table that contains table data and a system table that contains column data. As another, a system table that contains duplicates in a column that should to be unique.</p>
</li>
<li>
<p>Inconsistencies between same system table across segments. For example, a system table is missing row on one segment, but other segments have this row. As another example, the values of specific row column data are different across segments, such as table owner or table access privileges.</p>
</li>
<li>
<p>Inconsistency between a catalog table and the filesystem. For example, a file exists in database directory, but there is no entry for it in the pg_class table.</p>
</li>
</ul>
<h2 id="options"><a class="header" href="#options"><a id="section4"></a>Options</a></h2>
<h3 id="-a"><a class="header" href="#-a">-A</a></h3>
<p>Run <code>gpcheckcat</code> on all databases in the SynxDB installation.</p>
<h3 id="-b-parallel_processes"><a class="header" href="#-b-parallel_processes">-B &lt;parallel_processes&gt;</a></h3>
<p>The number of processes to run in parallel.</p>
<p>The <code>gpcheckcat</code> utility attempts to determine the number of simultaneous processes (the batch size) to use. The utility assumes it can use a buffer with a minimum of 20MB for each process. The maximum number of parallel processes is the number of SynxDB segment instances. The utility displays the number of parallel processes that it uses when it starts checking the catalog.
&gt; <strong>Note</strong> The utility might run out of memory if the number of errors returned exceeds the buffer size. If an out of memory error occurs, you can lower the batch size with the <code>-B</code> option. For example, if the utility displays a batch size of 936 and runs out of memory, you can specify <code>-B 468</code> to run 468 processes in parallel.</p>
<h3 id="-c-catalog_table"><a class="header" href="#-c-catalog_table">-C catalog_table</a></h3>
<p>Run cross consistency, foreign key, and ACL tests for the specified catalog table.</p>
<h3 id="-g-data_directory"><a class="header" href="#-g-data_directory">-g data_directory</a></h3>
<p>Generate SQL scripts to fix catalog inconsistencies. The scripts are placed in data_directory.</p>
<h3 id="-l"><a class="header" href="#-l">-l</a></h3>
<p>List the <code>gpcheckcat</code> tests.</p>
<h3 id="-o"><a class="header" href="#-o">-O</a></h3>
<p>Run only the <code>gpcheckcat</code> tests that can be run in online (not restricted) mode.</p>
<h3 id="-p-port"><a class="header" href="#-p-port">-p port</a></h3>
<p>This option specifies the port that is used by the SynxDB.</p>
<h3 id="-p-password"><a class="header" href="#-p-password">-P password</a></h3>
<p>The password of the user connecting to SynxDB.</p>
<h3 id="-r-test_name--test_name1test_name2--"><a class="header" href="#-r-test_name--test_name1test_name2--">-R test_name | ‘test_name1,test_name2 [, …]’</a></h3>
<p>Specify one or more tests to run. Specify multiple tests as a comma-delimited list of test names enclosed in quotes.</p>
<p>Some tests can be run only when SynxDB is in restricted mode.</p>
<p>These are the tests that can be performed:</p>
<ul>
<li>
<p><code>acl</code> - Cross consistency check for access control privileges</p>
</li>
<li>
<p><code>aoseg_table</code> - Check that the vertical partition information (vpinfo) on segment instances is consistent with <code>pg_attribute</code> (checks only append-optimized, column storage tables in the database)</p>
</li>
<li>
<p><code>duplicate</code> - Check for duplicate entries</p>
</li>
<li>
<p><code>foreign_key</code> - Check foreign keys</p>
</li>
<li>
<p><code>inconsistent</code> - Cross consistency check for master segment inconsistency</p>
</li>
<li>
<p><code>missing_extraneous</code> - Cross consistency check for missing or extraneous entries</p>
</li>
<li>
<p><code>mix_distribution_policy</code> - Check <code>pg_opclass</code> and <code>pg_amproc</code> to identify tables using a mix of legacy and non-legacy hashops in their distribution policies.</p>
</li>
<li>
<p><code>owner</code> - Check table ownership that is inconsistent with the master database</p>
</li>
<li>
<p><code>orphaned_toast_tables</code> - Check for orphaned TOAST tables.</p>
<blockquote>
<p><strong>Note</strong> There are several ways a TOAST table can become orphaned where a repair script cannot be generated and a manual catalog change is required. One way is if the <code>reltoastrelid</code> entry in <em>pg_class</em> points to an incorrect TOAST table (a TOAST table mismatch). Another way is if both the <code>reltoastrelid</code> in <em>pg_class</em> is missing and the <code>pg_depend</code> entry is missing (a double orphan TOAST table). If a manual catalog change is needed, <code>gpcheckcat</code> will display detailed steps you can follow to update the catalog. Contact Support if you need help with the catalog change.</p>
</blockquote>
</li>
<li>
<p><code>part_integrity</code> - Check <em>pg_partition</em> branch integrity, partition with OIDs, partition distribution policy</p>
</li>
<li>
<p><code>part_constraint</code> - Check constraints on partitioned tables</p>
</li>
<li>
<p><code>unique_index_violation</code> - Check tables that have columns with the unique index constraint for duplicate entries</p>
</li>
<li>
<p><code>dependency</code> - Check for dependency on non-existent objects (restricted mode only)</p>
</li>
<li>
<p><code>distribution_policy</code> - Check constraints on randomly distributed tables (restricted mode only)</p>
</li>
<li>
<p><code>namespace</code> - Check for schemas with a missing schema definition (restricted mode only)</p>
</li>
<li>
<p><code>pgclass</code> - Check <em>pg_class</em> entry that does not have any corresponding <em>pg_attribute</em> entry (restricted mode only)</p>
</li>
</ul>
<h3 id="-s-test_name--test_name1-test_name2--"><a class="header" href="#-s-test_name--test_name1-test_name2--">-s <code>test_name | 'test_name1, test_name2 [, ...]'</code></a></h3>
<p>Specify one ore more tests to skip. Specify multiple tests as a comma-delimited list of test names enclosed in quotes.</p>
<h3 id="-s-none--only"><a class="header" href="#-s-none--only">-S {none | only}</a></h3>
<p>Specify this option to control the testing of catalog tables that are shared across all databases in the SynxDB installation, such as <em>pg_database</em>.</p>
<p>The value <code>none</code> deactivates testing of shared catalog tables. The value <code>only</code> tests only the shared catalog tables.</p>
<h3 id="-u-user_name"><a class="header" href="#-u-user_name">-U user_name</a></h3>
<p>The user connecting to SynxDB.</p>
<h3 id="---help"><a class="header" href="#---help">-? | –help</a></h3>
<p>Displays the online help.</p>
<h3 id="-v-verbose"><a class="header" href="#-v-verbose">-v (verbose)</a></h3>
<p>Displays detailed information about the tests that are performed.</p>
<h3 id="-x-parameter_name"><a class="header" href="#-x-parameter_name">-x “&lt;parameter_name&gt;=<value>”</a></h3>
<p>Set a server configuration parameter, such as <code>log_min_messages</code>, at a session level. To set multiple configuration parameters, use the <code>-x</code> option multiple times.</p>
<h2 id="notes"><a class="header" href="#notes"><a id="notes"></a>Notes</a></h2>
<p>The utility identifies tables with missing attributes and displays them in various locations in the output and in a non-standardized format. The utility also displays a summary list of tables with missing attributes in the format <code>&lt;database&gt;. &lt;schema&gt;. &lt;table&gt;. &lt;segment_id&gt;</code> after the output information is displayed.</p>
<p>If <code>gpcheckcat</code> detects inconsistent OID (Object ID) information, it generates one or more verification files that contain an SQL query. You can run the SQL query to see details about the OID inconsistencies and investigate the inconsistencies. The files are generated in the directory where <code>gpcheckcat</code> is invoked.</p>
<p>This is the format of the file:</p>
<pre><code>gpcheckcat.verify.dbname.catalog\_table\_name.test\_name.TIMESTAMP.sql
</code></pre>
<p>This is an example verification filename created by <code>gpcheckcat</code> when it detects inconsistent OID (Object ID) information in the catalog table <em>pg_type</em> in the database <code>mydb</code>:</p>
<pre><code>gpcheckcat.verify.mydb.pg_type.missing_extraneous.20150420102715.sql
</code></pre>
<p>This is an example query from a verification file:</p>
<pre><code>SELECT *
  FROM (
       SELECT relname, oid FROM pg_class WHERE reltype 
         IN (1305822,1301043,1301069,1301095)
       UNION ALL
       SELECT relname, oid FROM gp_dist_random('pg_class') WHERE reltype 
         IN (1305822,1301043,1301069,1301095)
       ) alltyprelids
  GROUP BY relname, oid ORDER BY count(*) desc ;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../utility_guide/ref/gpbackup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../utility_guide/ref/gpcheckperf.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../utility_guide/ref/gpbackup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../utility_guide/ref/gpcheckperf.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
