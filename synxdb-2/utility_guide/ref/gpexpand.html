<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>gpexpand - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="gpexpand"><a class="header" href="#gpexpand">gpexpand</a></h1>
<p>Expands an existing SynxDB across new hosts in the system.</p>
<h2 id="synopsis"><a class="header" href="#synopsis"><a id="section2"></a>Synopsis</a></h2>
<pre><code>gpexpand [{-f|--hosts-file} &lt;hosts_file&gt;]
        | {-i|--input} &lt;input_file&gt; [-B &lt;batch_size&gt;]
        | [{-d | --duration} &lt;hh:mm:ss&gt; | {-e|--end} '&lt;YYYY-MM-DD hh:mm:ss&gt;'] 
          [-a|-analyze] 
          [-n  &lt;parallel_processes&gt;]
        | {-r|--rollback}
        | {-c|--clean}
        [-v|--verbose] [-s|--silent]
        [{-t|--tardir} &lt;directory&gt; ]
        [-S|--simple-progress ]

gpexpand -? | -h | --help 

gpexpand --version
</code></pre>
<h2 id="prerequisites"><a class="header" href="#prerequisites"><a id="section3"></a>Prerequisites</a></h2>
<ul>
<li>You are logged in as the SynxDB superuser (<code>gpadmin</code>).</li>
<li>The new segment hosts have been installed and configured as per the existing segment hosts. This involves:
<ul>
<li>Configuring the hardware and OS</li>
<li>Installing the SynxDB software</li>
<li>Creating the <code>gpadmin</code> user account</li>
<li>Exchanging SSH keys.</li>
</ul>
</li>
<li>Enough disk space on your segment hosts to temporarily hold a copy of your largest table.</li>
<li>When redistributing data, SynxDB must be running in production mode. SynxDB cannot be running in restricted mode or in master mode. The <code>gpstart</code> options <code>-R</code> or <code>-m</code> cannot be specified to start SynxDB.</li>
</ul>
<blockquote>
<p><strong>Note</strong> These utilities cannot be run while <code>gpexpand</code> is performing segment initialization.</p>
</blockquote>
<ul>
<li><code>gpbackup</code></li>
<li><code>gpcheckcat</code></li>
<li><code>gpconfig</code></li>
<li><code>gppkg</code></li>
<li><code>gprestore</code></li>
</ul>
<blockquote>
<p><strong>Important</strong> When expanding a SynxDB system, you must deactivate SynxDB interconnect proxies before adding new hosts and segment instances to the system, and you must update the <code>gp_interconnect_proxy_addresses</code> parameter with the newly-added segment instances before you re-enable interconnect proxies. For information about SynxDB interconnect proxies, see <a href="../../admin_guide/managing/proxy-ic.html">Configuring Proxies for the SynxDB Interconnect</a>.</p>
</blockquote>
<p>For information about preparing a system for expansion, see <a href="../../admin_guide/expand/expand-main.html">Expanding a SynxDB System</a>in the <em>SynxDB Administrator Guide</em>.</p>
<h2 id="description"><a class="header" href="#description"><a id="section4"></a>Description</a></h2>
<p>The <code>gpexpand</code> utility performs system expansion in two phases: segment instance initialization and then table data redistribution.</p>
<p>In the initialization phase, <code>gpexpand</code> runs with an input file that specifies data directories, dbid values, and other characteristics of the new segment instances. You can create the input file manually, or by following the prompts in an interactive interview.</p>
<p>If you choose to create the input file using the interactive interview, you can optionally specify a file containing a list of expansion system hosts. If your platform or command shell limits the length of the list of hostnames that you can type when prompted in the interview, specifying the hosts with <code>-f</code> may be mandatory.</p>
<p>In addition to initializing the segment instances, the initialization phase performs these actions:</p>
<ul>
<li>Creates an expansion schema named <em>gpexpand</em> in the postgres database to store the status of the expansion operation, including detailed status for tables.</li>
</ul>
<p>In the table data redistribution phase, <code>gpexpand</code> redistributes table data to rebalance the data across the old and new segment instances.</p>
<blockquote>
<p><strong>Note</strong> Data redistribution should be performed during low-use hours. Redistribution can be divided into batches over an extended period.</p>
</blockquote>
<p>To begin the redistribution phase, run <code>gpexpand</code> with no options or with the <code>-d</code> (duration), <code>-e</code> (end time), or <code>-i</code> options. If you specify an end time or duration, then the utility redistributes tables in the expansion schema until the specified end time or duration is reached. If you specify <code>-i</code> or no options, then the utility redistribution phase continues until all tables in the expansion schema are reorganized. Each table is reorganized using <code>ALTER TABLE</code> commands to rebalance the tables across new segments, and to set tables to their original distribution policy. If <code>gpexpand</code> completes the reorganization of all tables, it displays a success message and ends.</p>
<blockquote>
<p><strong>Note</strong> This utility uses secure shell (SSH) connections between systems to perform its tasks. In large SynxDB deployments, cloud deployments, or deployments with a large number of segments per host, this utility may exceed the host’s maximum threshold for unauthenticated connections. Consider updating the SSH <code>MaxStartups</code> and <code>MaxSessions</code> configuration parameters to increase this threshold. For more information about SSH configuration options, refer to the SSH documentation for your Linux distribution.</p>
</blockquote>
<h2 id="options"><a class="header" href="#options"><a id="section5"></a>Options</a></h2>
<h3 id="-a--analyze"><a class="header" href="#-a--analyze">-a | –analyze</a></h3>
<p>Run <code>ANALYZE</code> to update the table statistics after expansion. The default is to not run <code>ANALYZE</code>.</p>
<h3 id="-b-batch_size"><a class="header" href="#-b-batch_size">-B batch_size</a></h3>
<p>Batch size of remote commands to send to a given host before making a one-second pause. Default is <code>16</code>. Valid values are 1-128.</p>
<p>The <code>gpexpand</code> utility issues a number of setup commands that may exceed the host’s maximum threshold for unauthenticated connections as defined by <code>MaxStartups</code> in the SSH daemon configuration. The one-second pause allows authentications to be completed before <code>gpexpand</code> issues any more commands.</p>
<p>The default value does not normally need to be changed. However, it may be necessary to reduce the maximum number of commands if <code>gpexpand</code> fails with connection errors such as <code>'ssh_exchange_identification: Connection closed by remote host.'</code></p>
<h3 id="-c--clean"><a class="header" href="#-c--clean">-c | –clean</a></h3>
<p>Remove the expansion schema.</p>
<h3 id="-d--duration-hhmmss"><a class="header" href="#-d--duration-hhmmss">-d | –duration hh:mm:ss</a></h3>
<p>Duration of the expansion session from beginning to end.</p>
<h3 id="-e--end-yyyy-mm-dd-hhmmss"><a class="header" href="#-e--end-yyyy-mm-dd-hhmmss">-e | –end ‘YYYY-MM-DD hh:mm:ss’</a></h3>
<p>Ending date and time for the expansion session.</p>
<h3 id="-f--hosts-file-filename"><a class="header" href="#-f--hosts-file-filename">-f | –hosts-file filename</a></h3>
<p>Specifies the name of a file that contains a list of new hosts for system expansion. Each line of the file must contain a single host name.</p>
<p>This file can contain hostnames with or without network interfaces specified. The <code>gpexpand</code> utility handles either case, adding interface numbers to end of the hostname if the original nodes are configured with multiple network interfaces.</p>
<pre><code>&gt; **Note** The SynxDB segment host naming convention is `sdwN` where `sdw` is a prefix and `N` is an integer. For example, `sdw1`, `sdw2` and so on. For hosts with multiple interfaces, the convention is to append a dash \(`-`\) and number to the host name. For example, `sdw1-1` and `sdw1-2` are the two interface names for host `sdw1`.
</code></pre>
<p>For information about using a hostname or IP address, see <a href="#host_ip">Specifying Hosts using Hostnames or IP Addresses</a>. Also, see <a href="#multi_nic">Using Host Systems with Multiple NICs</a>.</p>
<h3 id="-i--input-input_file"><a class="header" href="#-i--input-input_file">-i | –input input_file</a></h3>
<p>Specifies the name of the expansion configuration file, which contains one line for each segment to be added in the format of:</p>
<p>hostname|address|port|datadir|dbid|content|preferred_role</p>
<h3 id="-n-parallel_processes"><a class="header" href="#-n-parallel_processes">-n parallel_processes</a></h3>
<p>The number of tables to redistribute simultaneously. Valid values are 1 - 96.</p>
<p>Each table redistribution process requires two database connections: one to alter the table, and another to update the table’s status in the expansion schema. Before increasing <code>-n</code>, check the current value of the server configuration parameter <code>max_connections</code> and make sure the maximum connection limit is not exceeded.</p>
<h3 id="-r--rollback"><a class="header" href="#-r--rollback">-r | –rollback</a></h3>
<p>Roll back a failed expansion setup operation.</p>
<h3 id="-s--silent"><a class="header" href="#-s--silent">-s | –silent</a></h3>
<p>Runs in silent mode. Does not prompt for confirmation to proceed on warnings.</p>
<h3 id="-s--simple-progress"><a class="header" href="#-s--simple-progress">-S | –simple-progress</a></h3>
<p>If specified, the <code>gpexpand</code> utility records only the minimum progress information in the SynxDB table <em>gpexpand.expansion_progress</em>. The utility does not record the relation size information and status information in the table <em>gpexpand.status_detail</em>.</p>
<p>Specifying this option can improve performance by reducing the amount of progress information written to the <em>gpexpand</em> tables.</p>
<p>[-t | –tardir] directory
The fully qualified path to a directory on segment hosts where the <code>gpexpand</code> utility copies a temporary tar file. The file contains SynxDB files that are used to create segment instances. The default directory is the user home directory.</p>
<h3 id="-v--verbose"><a class="header" href="#-v--verbose">-v | –verbose</a></h3>
<p>Verbose debugging output. With this option, the utility will output all DDL and DML used to expand the database.</p>
<h3 id="version"><a class="header" href="#version">–version</a></h3>
<p>Display the utility’s version number and exit.</p>
<h3 id="----h--help"><a class="header" href="#----h--help">-? | -h | –help</a></h3>
<p>Displays the online help.</p>
<h2 id="specifying-hosts-using-hostnames-or-ip-addresses"><a class="header" href="#specifying-hosts-using-hostnames-or-ip-addresses"><a id="host_ip"></a>Specifying Hosts using Hostnames or IP Addresses</a></h2>
<p>When expanding a SynxDB system, you can specify either a hostname or an IP address for the value.</p>
<ul>
<li>If you specify a hostname, the resolution of the hostname to an IP address should be done locally for security. For example, you should use entries in a local <code>/etc/hosts</code> file to map a hostname to an IP address. The resolution of a hostname to an IP address should not be performed by an external service such as a public DNS server. You must stop the SynxDB system before you change the mapping of a hostname to a different IP address.</li>
<li>If you specify an IP address, the address should not be changed after the initial configuration. When segment mirroring is enabled, replication from the primary to the mirror segment will fail if the IP address changes from the configured value. For this reason, you should use a hostname when expanding a SynxDB system unless you have a specific requirement to use IP addresses.</li>
</ul>
<p>When expanding a SynxDB system, <code>gpexpand</code> populates <a href="../../ref_guide/system_catalogs/gp_segment_configuration.html">gp_segment_configuration</a> catalog table with the new segment instance information. SynxDB uses the <code>address</code> value of the <code>gp_segment_configuration</code> catalog table when looking up host systems for SynxDB interconnect (internal) communication between the master and segment instances and between segment instances, and for other internal communication.</p>
<h2 id="using-host-systems-with-multiple-nics"><a class="header" href="#using-host-systems-with-multiple-nics"><a id="multi_nic"></a>Using Host Systems with Multiple NICs</a></h2>
<p>If host systems are configured with multiple NICs, you can expand a SynxDB system to use each NIC as a SynxDB host system. You must ensure that the host systems are configured with sufficient resources to support all the segment instances being added to the host. Also, if you enable segment mirroring, you must ensure that the expanded SynxDB system configuration supports failover if a host system fails. For information about SynxDB mirroring schemes, see <a href="../../best_practices/ha.html#topic_ngz_qf4_tt">../../best_practices/ha.html#topic_ngz_qf4_tt</a>.</p>
<p>For example, this is a <code>gpexpand</code> configuration file for a simple SynxDB system. The segment host <code>gp6s1</code> and <code>gp6s2</code> are configured with two NICs, <code>-s1</code> and <code>-s2</code>, where the SynxDB system uses each NIC as a host system.</p>
<pre><code>gp6s1-s2|gp6s1-s2|40001|/data/data1/gpseg2|6|2|p
gp6s2-s1|gp6s2-s1|50000|/data/mirror1/gpseg2|9|2|m
gp6s2-s1|gp6s2-s1|40000|/data/data1/gpseg3|7|3|p
gp6s1-s2|gp6s1-s2|50001|/data/mirror1/gpseg3|8|3|m
</code></pre>
<h2 id="examples"><a class="header" href="#examples"><a id="section6"></a>Examples</a></h2>
<p>Run <code>gpexpand</code> with an input file to initialize new segments and create the expansion schema in the postgres database:</p>
<pre><code>$ gpexpand -i input_file
</code></pre>
<p>Run <code>gpexpand</code> for sixty hours maximum duration to redistribute tables to new segments:</p>
<pre><code>$ gpexpand -d 60:00:00
</code></pre>
<h2 id="see-also"><a class="header" href="#see-also"><a id="section7"></a>See Also</a></h2>
<p><a href="gpssh-exkeys.html">gpssh-exkeys</a>, <a href="../../admin_guide/expand/expand-main.html">Expanding a SynxDB System</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../utility_guide/ref/gpdeletesystem.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../utility_guide/ref/gpfdist.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../utility_guide/ref/gpdeletesystem.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../utility_guide/ref/gpfdist.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
