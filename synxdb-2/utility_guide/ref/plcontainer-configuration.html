<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>plcontainer Configuration File - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="plcontainer-configuration-file"><a class="header" href="#plcontainer-configuration-file">plcontainer Configuration File</a></h1>
<p>The SynxDB utility <code>plcontainer</code> manages the PL/Container configuration files in a SynxDB system. The utility ensures that the configuration files are consistent across the SynxDB master and segment instances.</p>
<blockquote>
<p><strong>Caution</strong> Modifying the configuration files on the segment instances without using the utility might create different, incompatible configurations on different SynxDB segments that could cause unexpected behavior.</p>
</blockquote>
<h2 id="plcontainer-configuration-file-1"><a class="header" href="#plcontainer-configuration-file-1"><a id="topic_ojn_r2s_dw"></a>PL/Container Configuration File</a></h2>
<p>PL/Container maintains a configuration file <code>plcontainer_configuration.xml</code> in the data directory of all SynxDB segments. This query lists the SynxDB system data directories:</p>
<pre><code>SELECT hostname, datadir FROM gp_segment_configuration;
</code></pre>
<p>A sample PL/Container configuration file is in <code>$GPHOME/share/postgresql/plcontainer</code>.</p>
<p>In an XML file, names, such as element and attribute names, and values are case sensitive.</p>
<p>In this XML file, the root element <code>configuration</code> contains one or more <code>runtime</code> elements. You specify the <code>id</code> of the <code>runtime</code> element in the <code># container:</code> line of a PL/Container function definition.</p>
<p>This is an example file. Note that all XML elements, names, and attributes are case sensitive.</p>
<pre><code>&lt;?xml version="1.0" ?&gt;
&lt;configuration&gt;
    &lt;runtime&gt;
        &lt;id&gt;plc_python_example1&lt;/id&gt;
        &lt;image&gt;synxdata/plcontainer_python_with_clients:0.1&lt;/image&gt;
        &lt;command&gt;./pyclient&lt;/command&gt;
    &lt;/runtime&gt;
    &lt;runtime&gt;
        &lt;id&gt;plc_python_example2&lt;/id&gt;
        &lt;image&gt;synxdata/plcontainer_python_without_clients:0.1&lt;/image&gt;
        &lt;command&gt;/clientdir/pyclient.sh&lt;/command&gt;
        &lt;shared_directory access="ro" container="/clientdir" host="/usr/local/synxdb/bin/plcontainer_clients"/&gt;
        &lt;setting memory_mb="512"/&gt;
        &lt;setting use_container_logging="yes"/&gt;
        &lt;setting cpu_share="1024"/&gt;
        &lt;setting resource_group_id="16391"/&gt;
    &lt;/runtime&gt;
    &lt;runtime&gt;
        &lt;id&gt;plc_r_example&lt;/id&gt;
        &lt;image&gt;synxdata/plcontainer_r_without_clients:0.2&lt;/image&gt;
        &lt;command&gt;/clientdir/rclient.sh&lt;/command&gt;
        &lt;shared_directory access="ro" container="/clientdir" host="/usr/local/synxdb/bin/plcontainer_clients"/&gt;
        &lt;setting use_container_logging="yes"/&gt;
        &lt;setting enable_network="no"/&gt;
        &lt;setting roles="gpadmin,user1"/&gt;
    &lt;/runtime&gt;
    &lt;runtime&gt;
&lt;/configuration&gt;
</code></pre>
<p>These are the XML elements and attributes in a PL/Container configuration file.</p>
<h3 id="configuration"><a class="header" href="#configuration">configuration</a></h3>
<p>Root element for the XML file.</p>
<h3 id="runtime"><a class="header" href="#runtime">runtime</a></h3>
<p>One element for each specific container available in the system. These are child elements of the <code>configuration</code> element.</p>
<h3 id="id"><a class="header" href="#id">id</a></h3>
<p>Required. The value is used to reference a Docker container from a PL/Container user-defined function. The <code>id</code> value must be unique in the configuration. The <code>id</code> must start with a character or digit (a-z, A-Z, or 0-9) and can contain characters, digits, or the characters <code>_</code> (underscore), <code>.</code> (period), or <code>-</code> (dash). Maximum length is 63 Bytes.</p>
<p>The <code>id</code> specifies which Docker image to use when PL/Container creates a Docker container to run a user-defined function.</p>
<h3 id="image"><a class="header" href="#image">image</a></h3>
<p>Required. The value is the full Docker image name, including image tag. The same way you specify them for starting this container in Docker. Configuration allows to have many container objects referencing the same image name, this way in Docker they would be represented by identical containers.</p>
<p>For example, you might have two <code>runtime</code> elements, with different <code>id</code> elements, <code>plc_python_128</code> and <code>plc_python_256</code>, both referencing the Docker image <code>synxdata/plcontainer_python:1.0.0</code>. The first <code>runtime</code> specifies a 128MB RAM limit and the second one specifies a 256MB limit that is specified by the <code>memory_mb</code> attribute of a <code>setting</code> element.</p>
<h3 id="command"><a class="header" href="#command">command</a></h3>
<p>Required. The value is the command to be run inside of container to start the client process inside in the container. When creating a <code>runtime</code> element, the <code>plcontainer</code> utility adds a <code>command</code> element based on the language (the <code>-l</code> option).</p>
<p><code>command</code> element for the Python 2 language.</p>
<pre><code>&lt;command&gt;/clientdir/pyclient.sh&lt;/command&gt;
</code></pre>
<p><code>command</code> element for the Python 3 language.</p>
<pre><code>&lt;command&gt;/clientdir/pyclient3.sh&lt;/command&gt;
</code></pre>
<p><code>command</code> element for the R language.</p>
<pre><code>&lt;command&gt;/clientdir/rclient.sh&lt;/command&gt;
</code></pre>
<p>You should modify the value only if you build a custom container and want to implement some additional initialization logic before the container starts.</p>
<blockquote>
<p><strong>Note</strong> This element cannot be set with the <code>plcontainer</code> utility. You can update the configuration file with the <code>plcontainer runtime-edit</code> command.</p>
</blockquote>
<h3 id="shared_directory"><a class="header" href="#shared_directory">shared_directory</a></h3>
<p>Optional. This element specifies a shared Docker shared volume for a container with access information. Multiple <code>shared_directory</code> elements are allowed. Each <code>shared_directory</code> element specifies a single shared volume. XML attributes for the <code>shared_directory</code> element:</p>
<ul>
<li><code>host</code> - a directory location on the host system.</li>
<li><code>container</code> - a directory location inside of container.</li>
<li><code>access</code> - access level to the host directory, which can be either <code>ro</code> (read-only) or <code>rw</code> (read-write).</li>
</ul>
<p>When creating a <code>runtime</code> element, the <code>plcontainer</code> utility adds a <code>shared_directory</code> element.</p>
<pre><code>&lt;shared_directory access="ro" container="/clientdir" host="/usr/local/synxdb/bin/plcontainer_clients"/&gt;
</code></pre>
<p>For each <code>runtime</code> element, the <code>container</code> attribute of the <code>shared_directory</code> elements must be unique. For example, a <code>runtime</code> element cannot have two <code>shared_directory</code> elements with attribute <code>container="/clientdir"</code>.</p>
<blockquote>
<p><strong>Caution</strong> Allowing read-write access to a host directory requires special consideration.</p>
<ul>
<li>When specifying read-write access to host directory, ensure that the specified host directory has the correct permissions.</li>
<li>When running PL/Container user-defined functions, multiple concurrent Docker containers that are running on a host could change data in the host directory. Ensure that the functions support multiple concurrent access to the data in the host directory.</li>
</ul>
</blockquote>
<h3 id="settings"><a class="header" href="#settings">settings</a></h3>
<p>Optional. This element specifies Docker container configuration information. Each <code>setting</code> element contains one attribute. The element attribute specifies logging, memory, or networking information. For example, this element enables logging.</p>
<pre><code>&lt;setting use_container_logging="yes"/&gt;
</code></pre>
<p>These are the valid attributes.</p>
<h4 id="cpu_share"><a class="header" href="#cpu_share">cpu_share</a></h4>
<p>Optional. Specify the CPU usage for each PL/Container container in the runtime. The value of the element is a positive integer. The default value is 1024. The value is a relative weighting of CPU usage compared to other containers.</p>
<p>For example, a container with a <code>cpu_share</code> of 2048 is allocated double the CPU slice time compared with container with the default value of 1024.</p>
<h4 id="memory_mbsize"><a class="header" href="#memory_mbsize">memory_mb=“size”</a></h4>
<p>Optional. The value specifies the amount of memory, in MB, that each container is allowed to use. Each container starts with this amount of RAM and twice the amount of swap space. The container memory consumption is limited by the host system <code>cgroups</code> configuration, which means in case of memory overcommit, the container is terminated by the system.</p>
<h4 id="resource_group_idrg_groupid"><a class="header" href="#resource_group_idrg_groupid">resource_group_id=“rg_groupid”</a></h4>
<p>Optional. The value specifies the <code>groupid</code> of the resource group to assign to the PL/Container runtime. The resource group limits the total CPU and memory resource usage for all running containers that share this runtime configuration. You must specify the <code>groupid</code> of the resource group. If you do not assign a resource group to a PL/Container runtime configuration, its container instances are limited only by system resources. For information about managing PL/Container resources, see <a href="../../analytics/pl_container_using.html">About PL/Container Resource Management</a>.</p>
<h4 id="roleslist_of_roles"><a class="header" href="#roleslist_of_roles">roles=“list_of_roles”</a></h4>
<p>Optional. The value is a SynxDB role name or a comma-separated list of roles. PL/Container runs a container that uses the PL/Container runtime configuration only for the listed roles. If the attribute is not specified, any SynxDB role can run an instance of this container runtime configuration. For example, you create a UDF that specifies the <code>plcontainer</code> language and identifies a <code># container:</code> runtime configuration that has the <code>roles</code> attribute set. When a role (user) runs the UDF, PL/Container checks the list of roles and runs the container only if the role is on the list.</p>
<h4 id="use_container_loggingyes--no"><a class="header" href="#use_container_loggingyes--no">use_container_logging=“{yes | no}”</a></h4>
<p>Optional.  Activates or deactivates  Docker logging for the container. The attribute value <code>yes</code> enables logging. The attribute value <code>no</code> deactivates logging (the default).</p>
<h4 id="enable_networkyes--no"><a class="header" href="#enable_networkyes--no">enable_network=“{yes | no}”</a></h4>
<p>Optional. Available starting with PL/Container version 2.2, this attribute activates or deactivates network access for the UDF container. The attribute value <code>yes</code> enables UDFs to access the network. The attribute value <code>no</code> deactivates network access (the default).</p>
<p>The SynxDB server configuration parameter <a href="../../ref_guide/config_params/guc-list.html">log_min_messages</a> controls the PL/Container log level. The default log level is <code>warning</code>. For information about PL/Container log information, see <a href="../../analytics/pl_container_using.html">Notes</a>.</p>
<p>By default, the PL/Container log information is sent to a system service. On Red Hat 7 or CentOS 7 systems, the log information is sent to the <code>journald</code> service. On Red Hat 6 or CentOS 6 systems, the log is sent to the <code>syslogd</code> service.</p>
<h2 id="update-the-plcontainer-configuration"><a class="header" href="#update-the-plcontainer-configuration"><a id="topic_v3s_qv3_kw"></a>Update the PL/Container Configuration</a></h2>
<p>You can add a <code>runtime</code> element to the PL/Container configuration file with the <code>plcontainer runtime-add</code> command. The command options specify information such as the runtime ID, Docker image, and language. You can use the <code>plcontainer runtime-replace</code> command to update an existing <code>runtime</code> element. The utility updates the configuration file on the master and all segment instances.</p>
<p>The PL/Container configuration file can contain multiple <code>runtime</code> elements that reference the same Docker image specified by the XML element <code>image</code>. In the example configuration file, the <code>runtime</code> elements contain <code>id</code> elements named <code>plc_python_128</code> and <code>plc_python_256</code>, both referencing the Docker container <code>synxdata/plcontainer_python:1.0.0</code>. The first <code>runtime</code> element is defined with a 128MB RAM limit and the second one with a 256MB RAM limit.</p>
<pre><code>&lt;configuration&gt;
  &lt;runtime&gt;
    &lt;id&gt;plc_python_128&lt;/id&gt;
    &lt;image&gt;synxdata/plcontainer_python:1.0.0&lt;/image&gt;
    &lt;command&gt;./client&lt;/command&gt;
    &lt;shared_directory access="ro" container="/clientdir" host="/usr/local/gpdb/bin/plcontainer_clients"/&gt;
    &lt;setting memory_mb="128"/&gt;
  &lt;/runtime&gt;
  &lt;runtime&gt;
    &lt;id&gt;plc_python_256&lt;/id&gt;
    &lt;image&gt;synxdata/plcontainer_python:1.0.0&lt;/image&gt;
    &lt;command&gt;./client&lt;/command&gt;
    &lt;shared_directory access="ro" container="/clientdir" host="/usr/local/gpdb/bin/plcontainer_clients"/&gt;
    &lt;setting memory_mb="256"/&gt;
    &lt;setting resource_group_id="16391"/&gt;
  &lt;/runtime&gt;
&lt;configuration&gt;
</code></pre>
<p>Configuration changes that are made with the utility are applied to the XML files on all SynxDB segments. However, PL/Container configurations of currently running sessions use the configuration that existed during session start up. To update the PL/Container configuration in a running session, run this command in the session.</p>
<pre><code>SELECT * FROM plcontainer_refresh_config;
</code></pre>
<p>The command runs a PL/Container function that updates the session configuration on the master and segment instances.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../utility_guide/ref/plcontainer.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../utility_guide/ref/psql.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../utility_guide/ref/plcontainer.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../utility_guide/ref/psql.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
