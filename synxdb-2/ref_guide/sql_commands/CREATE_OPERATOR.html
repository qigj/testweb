<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CREATE OPERATOR - SynxDB 2 Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">SynxDB 2 Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <a href="https://www.synxdata.com/"><img id="fa fa-print" src="../../SYNX-Text-and-Circular-Logo-142x28-White-text-Black-background.png" alt="Synx Data Labs Logo"/></a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="create-operator"><a class="header" href="#create-operator">CREATE OPERATOR</a></h1>
<p>Defines a new operator.</p>
<h2 id="synopsis"><a class="header" href="#synopsis"><a id="section2"></a>Synopsis</a></h2>
<pre><code class="language-{#sql_command_synopsis}">CREATE OPERATOR &lt;name&gt; ( 
       PROCEDURE = &lt;funcname&gt;
       [, LEFTARG = &lt;lefttype&gt;] [, RIGHTARG = &lt;righttype&gt;]
       [, COMMUTATOR = &lt;com_op&gt;] [, NEGATOR = &lt;neg_op&gt;]
       [, RESTRICT = &lt;res_proc&gt;] [, JOIN = &lt;join_proc&gt;]
       [, HASHES] [, MERGES] )
</code></pre>
<h2 id="description"><a class="header" href="#description"><a id="section3"></a>Description</a></h2>
<p><code>CREATE OPERATOR</code> defines a new operator. The user who defines an operator becomes its owner.</p>
<p>The operator name is a sequence of up to <code>NAMEDATALEN</code>-1 (63 by default) characters from the following list: <code>+ - * / &lt; &gt; = ~ ! @ # % ^ &amp; | ` ?</code></p>
<p>There are a few restrictions on your choice of name:</p>
<ul>
<li><code>--</code> and <code>/*</code> cannot appear anywhere in an operator name, since they will be taken as the start of a comment.</li>
<li>A multicharacter operator name cannot end in <code>+</code> or <code>-</code>, unless the name also contains at least one of these characters: <code>~ ! @ # % ^ &amp; | ` ?</code></li>
</ul>
<p>For example, <code>@-</code> is an allowed operator name, but <code>*-</code> is not. This restriction allows SynxDB to parse SQL-compliant commands without requiring spaces between tokens.</p>
<p>The use of <code>=&gt;</code> as an operator name is deprecated. It may be disallowed altogether in a future release.</p>
<p>The operator <code>!=</code> is mapped to <code>&lt;&gt;</code> on input, so these two names are always equivalent.</p>
<p>At least one of <code>LEFTARG</code> and <code>RIGHTARG</code> must be defined. For binary operators, both must be defined. For right unary operators, only <code>LEFTARG</code> should be defined, while for left unary operators only <code>RIGHTARG</code> should be defined.</p>
<p>The funcname procedure must have been previously defined using <code>CREATE FUNCTION</code>, must be <code>IMMUTABLE</code>, and must be defined to accept the correct number of arguments (either one or two) of the indicated types.</p>
<p>The other clauses specify optional operator optimization clauses. These clauses should be provided whenever appropriate to speed up queries that use the operator. But if you provide them, you must be sure that they are correct. Incorrect use of an optimization clause can result in server process crashes, subtly wrong output, or other unexpected results. You can always leave out an optimization clause if you are not sure about it.</p>
<p>To be able to create an operator, you must have <code>USAGE</code> privilege on the argument types and the return type, as well as <code>EXECUTE</code> privilege on the underlying function. If a commutator or negator operator is specified, you must own these operators.</p>
<h2 id="parameters"><a class="header" href="#parameters"><a id="section4"></a>Parameters</a></h2>
<h3 id="name"><a class="header" href="#name">name</a></h3>
<p>The (optionally schema-qualified) name of the operator to be defined. Two operators in the same schema can have the same name if they operate on different data types.</p>
<h3 id="funcname"><a class="header" href="#funcname">funcname</a></h3>
<p>The function used to implement this operator (must be an <code>IMMUTABLE</code> function).</p>
<h3 id="lefttype"><a class="header" href="#lefttype">lefttype</a></h3>
<p>The data type of the operator’s left operand, if any. This option would be omitted for a left-unary operator.</p>
<h3 id="righttype"><a class="header" href="#righttype">righttype</a></h3>
<p>The data type of the operator’s right operand, if any. This option would be omitted for a right-unary operator.</p>
<h3 id="com_op"><a class="header" href="#com_op">com_op</a></h3>
<p>The optional <code>COMMUTATOR</code> clause names an operator that is the commutator of the operator being defined. We say that operator A is the commutator of operator B if (x A y) equals (y B x) for all possible input values x, y. Notice that B is also the commutator of A. For example, operators <code>&lt;</code> and <code>&gt;</code> for a particular data type are usually each others commutators, and operator + is usually commutative with itself. But operator <code>-</code> is usually not commutative with anything. The left operand type of a commutable operator is the same as the right operand type of its commutator, and vice versa. So the name of the commutator operator is all that needs to be provided in the <code>COMMUTATOR</code> clause.</p>
<h3 id="neg_op"><a class="header" href="#neg_op">neg_op</a></h3>
<p>The optional <code>NEGATOR</code> clause names an operator that is the negator of the operator being defined. We say that operator A is the negator of operator B if both return Boolean results and (x A y) equals NOT (x B y) for all possible inputs x, y. Notice that B is also the negator of A. For example, <code>&lt;</code> and <code>&gt;=</code> are a negator pair for most data types. An operator’s negator must have the same left and/or right operand types as the operator to be defined, so only the operator name need be given in the <code>NEGATOR</code> clause.</p>
<h3 id="res_proc"><a class="header" href="#res_proc">res_proc</a></h3>
<p>The optional <code>RESTRICT</code> names a restriction selectivity estimation function for the operator. Note that this is a function name, not an operator name. <code>RESTRICT</code> clauses only make sense for binary operators that return <code>boolean</code>. The idea behind a restriction selectivity estimator is to guess what fraction of the rows in a table will satisfy a <code>WHERE</code>-clause condition of the form:</p>
<pre><code>column OP constant
</code></pre>
<p>for the current operator and a particular constant value. This assists the optimizer by giving it some idea of how many rows will be eliminated by <code>WHERE</code> clauses that have this form.</p>
<p>You can usually just use one of the following system standard estimator functions for many of your own operators:</p>
<ul>
<li>
<p><code>eqsel</code> for =</p>
</li>
<li>
<p><code>neqsel</code> for &lt;&gt;</p>
</li>
<li>
<p><code>scalarltsel</code> for &lt; or &lt;=</p>
</li>
<li>
<p><code>scalargtsel</code> for &gt; or &gt;=</p>
</li>
</ul>
<h3 id="join_proc"><a class="header" href="#join_proc">join_proc</a></h3>
<p>The optional <code>JOIN</code> clause names a join selectivity estimation function for the operator. Note that this is a function name, not an operator name. <code>JOIN</code> clauses only make sense for binary operators that return <code>boolean</code>. The idea behind a join selectivity estimator is to guess what fraction of the rows in a pair of tables will satisfy a <code>WHERE</code>-clause condition of the form</p>
<pre><code>table1.column1 OP table2.column2
</code></pre>
<p>for the current operator. This helps the optimizer by letting it figure out which of several possible join sequences is likely to take the least work.</p>
<p>You can usually just use one of the following system standard join selectivity estimator functions for many of your own operators:</p>
<ul>
<li>
<p><code>eqjoinsel</code> for =</p>
</li>
<li>
<p><code>neqjoinsel</code> for &lt;&gt;</p>
</li>
<li>
<p><code>scalarltjoinsel</code> for &lt; or &lt;=</p>
</li>
<li>
<p><code>scalargtjoinsel</code> for &gt; or &gt;=</p>
</li>
<li>
<p><code>areajoinsel</code> for 2D area-based comparisons</p>
</li>
<li>
<p><code>positionjoinsel</code> for 2D position-based comparisons</p>
</li>
<li>
<p><code>contjoinsel</code> for 2D containment-based comparisons</p>
</li>
</ul>
<h3 id="hashes"><a class="header" href="#hashes">HASHES</a></h3>
<p>The optional <code>HASHES</code> clause tells the system that it is permissible to use the hash join method for a join based on this operator. <code>HASHES</code> only makes sense for a binary operator that returns <code>boolean</code>. The hash join operator can only return true for pairs of left and right values that hash to the same hash code. If two values are put in different hash buckets, the join will never compare them, implicitly assuming that the result of the join operator must be false. Because of this, it never makes sense to specify <code>HASHES</code> for operators that do not represent equality.</p>
<p>In most cases, it is only practical to support hashing for operators that take the same data type on both sides. However, you can design compatible hash functions for two or more data types, which are functions that will generate the same hash codes for “equal” values, even if the values are differently represented.</p>
<p>To be marked <code>HASHES</code>, the join operator must appear in a hash index operator class. Attempts to use the operator in hash joins will fail at run time if no such operator class exists. The system needs the operator class to find the data-type-specific hash function for the operator’s input data type. You must also supply a suitable hash function before you can create the operator class. Exercise care when preparing a hash function, as there are machine-dependent ways in which it could fail to function correctly. For example, on machines that meet the IEEE floating-point standard, negative zero and positive zero are different values (different bit patterns) but are defined to compare as equal. If a float value could contain a negative zero, define it to generate the same hash value as positive zero.</p>
<p>A hash-joinable operator must have a commutator (itself, if the two operand data types are the same, or a related equality operator if they are different) that appears in the same operator family. Otherwise, planner errors can occur when the operator is used. For better optimization, a hash operator family that supports multiple data types should provide equality operators for every combination of the data types.</p>
<blockquote>
<p><strong>Note</strong> The function underlying a hash-joinable operator must be marked immutable or stable; an operator marked as volatile will not be used. If a hash-joinable operator has an underlying function that is marked strict, the function must also be complete, returning true or false, and not null, for any two non-null inputs.</p>
</blockquote>
<h3 id="merges"><a class="header" href="#merges">MERGES</a></h3>
<p>The <code>MERGES</code> clause, if present, tells the system that it is permissible to use the merge-join method for a join based on this operator. <code>MERGES</code> only makes sense for a binary operator that returns <code>boolean</code>, and in practice the operator must represent equality for some data type or pair of data types.</p>
<p>Merge join is based on the idea of sorting the left- and right-hand tables into order and then scanning them in parallel. This means both data types must be capable of being fully ordered, and the join operator must be one that can only succeed for pairs of values that fall at equivalent places in the sort order. In practice, this means that the join operator must behave like an equality operator. However, you can merge-join two distinct data types so long as they are logically compatible. For example, the <code>smallint-versus-integer</code> equality operator is merge-joinable. Only sorting operators that bring both data types into a logically compatible sequence are needed.</p>
<p>To be marked <code>MERGES</code>, the join operator must appear as an equality member of a btree index operator family. This is not enforced when you create the operator, because the referencing operator family does not exist until later. However, the operator will not actually be used for merge joins unless a matching operator family can be found. The <code>MERGE</code> flag thus acts as a suggestion to the planner to look for a matching operator family.</p>
<p>A merge-joinable operator must have a commutator that appears in the same operator family. This would be itself, if the two operand data types are the same, or a related equality operator if the data types are different. Without an appropriate commutator, planner errors can occur when the operator is used. Also, although not strictly required, a btree operator family that supports multiple data types should be able to provide equality operators for every combination of the data types; this allows better optimization.</p>
<blockquote>
<p><strong>Note</strong> <code>SORT1</code>, <code>SORT2</code>, <code>LTCMP</code>, and <code>GTCMP</code> were formerly used to specify the names of sort operators associated with a merge-joinable operator. Information about associated operators is now found by looking at B-tree operator families; specifying any of these operators will be ignored, except that it will implicitly set <code>MERGES</code> to true.</p>
</blockquote>
<h2 id="notes"><a class="header" href="#notes"><a id="section5"></a>Notes</a></h2>
<p>Any functions used to implement the operator must be defined as <code>IMMUTABLE</code>.</p>
<p>It is not possible to specify an operator’s lexical precedence in <code>CREATE OPERATOR</code>, because the parser’s precedence behavior is hard-wired. See <a href="https://www.postgresql.org/docs/9.4/sql-syntax-lexical.html#SQL-PRECEDENCE">Operator Precedence</a> in the PostgreSQL documentation for precedence details.</p>
<p>Use <a href="DROP_OPERATOR.html">DROP OPERATOR</a> to delete user-defined operators from a database. Use <a href="ALTER_OPERATOR.html">ALTER OPERATOR</a> to modify operators in a database.</p>
<h2 id="examples"><a class="header" href="#examples"><a id="section6"></a>Examples</a></h2>
<p>Here is an example of creating an operator for adding two complex numbers, assuming we have already created the definition of type <code>complex</code>. First define the function that does the work, then define the operator:</p>
<pre><code>CREATE FUNCTION complex_add(complex, complex)
    RETURNS complex
    AS 'filename', 'complex_add'
    LANGUAGE C IMMUTABLE STRICT;
CREATE OPERATOR + (
    leftarg = complex,
    rightarg = complex,
    procedure = complex_add,
    commutator = +
);
</code></pre>
<p>To use this operator in a query:</p>
<pre><code>SELECT (a + b) AS c FROM test_complex;
</code></pre>
<h2 id="compatibility"><a class="header" href="#compatibility"><a id="section7"></a>Compatibility</a></h2>
<p><code>CREATE OPERATOR</code> is a SynxDB language extension. The SQL standard does not provide for user-defined operators.</p>
<h2 id="see-also"><a class="header" href="#see-also"><a id="section8"></a>See Also</a></h2>
<p><a href="CREATE_FUNCTION.html">CREATE FUNCTION</a>, <a href="CREATE_TYPE.html">CREATE TYPE</a>, <a href="ALTER_OPERATOR.html">ALTER OPERATOR</a>, <a href="DROP_OPERATOR.html">DROP OPERATOR</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ref_guide/sql_commands/CREATE_MATERIALIZED_VIEW.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ref_guide/sql_commands/CREATE_OPERATOR_CLASS.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ref_guide/sql_commands/CREATE_MATERIALIZED_VIEW.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ref_guide/sql_commands/CREATE_OPERATOR_CLASS.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
